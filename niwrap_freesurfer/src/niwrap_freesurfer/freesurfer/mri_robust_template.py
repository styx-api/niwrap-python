# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

MRI_ROBUST_TEMPLATE_METADATA = Metadata(
    id="f043b3273e9985d357cf80355b397d8ee42c3a35.boutiques",
    name="mri_robust_template",
    package="freesurfer",
    container_image_tag="freesurfer/freesurfer:7.4.1",
)


_MriRobustTemplateParamsDictNoTag = typing.TypedDict('_MriRobustTemplateParamsDictNoTag', {
    "mov": list[InputPathType],
    "template": str,
    "sat": typing.NotRequired[float | None],
    "satit": bool,
    "lta": typing.NotRequired[list[str] | None],
    "mapmov": typing.NotRequired[list[str] | None],
    "mapmovhdr": typing.NotRequired[list[str] | None],
    "weights": typing.NotRequired[list[str] | None],
    "oneminusw": bool,
    "average": typing.NotRequired[int | None],
    "inittp": typing.NotRequired[int | None],
    "fixtp": bool,
    "iscale": bool,
    "iscaleonly": bool,
    "iscalein": typing.NotRequired[list[InputPathType] | None],
    "iscaleout": typing.NotRequired[list[str] | None],
    "transonly": bool,
    "affine": bool,
    "ixforms": typing.NotRequired[list[InputPathType] | None],
    "masks": typing.NotRequired[list[InputPathType] | None],
    "vox2vox": bool,
    "leastsquares": bool,
    "noit": bool,
    "maxit": typing.NotRequired[int | None],
    "highit": typing.NotRequired[int | None],
    "epsit": typing.NotRequired[float | None],
    "pairmaxit": typing.NotRequired[int | None],
    "pairepsit": typing.NotRequired[float | None],
    "subsample": typing.NotRequired[int | None],
    "nomulti": bool,
    "floattype": bool,
    "finalnearest": bool,
    "doubleprec": bool,
    "cras": bool,
    "res_thresh": typing.NotRequired[float | None],
    "frobnorm_thresh": typing.NotRequired[float | None],
    "conform": typing.NotRequired[str | None],
    "seed": typing.NotRequired[int | None],
    "allow_diff_vox_size": bool,
    "threads": typing.NotRequired[int | None],
    "debug": bool,
})
MriRobustTemplateParamsDictTagged = typing.TypedDict('MriRobustTemplateParamsDictTagged', {
    "@type": typing.Literal["freesurfer/mri_robust_template"],
    "mov": list[InputPathType],
    "template": str,
    "sat": typing.NotRequired[float | None],
    "satit": bool,
    "lta": typing.NotRequired[list[str] | None],
    "mapmov": typing.NotRequired[list[str] | None],
    "mapmovhdr": typing.NotRequired[list[str] | None],
    "weights": typing.NotRequired[list[str] | None],
    "oneminusw": bool,
    "average": typing.NotRequired[int | None],
    "inittp": typing.NotRequired[int | None],
    "fixtp": bool,
    "iscale": bool,
    "iscaleonly": bool,
    "iscalein": typing.NotRequired[list[InputPathType] | None],
    "iscaleout": typing.NotRequired[list[str] | None],
    "transonly": bool,
    "affine": bool,
    "ixforms": typing.NotRequired[list[InputPathType] | None],
    "masks": typing.NotRequired[list[InputPathType] | None],
    "vox2vox": bool,
    "leastsquares": bool,
    "noit": bool,
    "maxit": typing.NotRequired[int | None],
    "highit": typing.NotRequired[int | None],
    "epsit": typing.NotRequired[float | None],
    "pairmaxit": typing.NotRequired[int | None],
    "pairepsit": typing.NotRequired[float | None],
    "subsample": typing.NotRequired[int | None],
    "nomulti": bool,
    "floattype": bool,
    "finalnearest": bool,
    "doubleprec": bool,
    "cras": bool,
    "res_thresh": typing.NotRequired[float | None],
    "frobnorm_thresh": typing.NotRequired[float | None],
    "conform": typing.NotRequired[str | None],
    "seed": typing.NotRequired[int | None],
    "allow_diff_vox_size": bool,
    "threads": typing.NotRequired[int | None],
    "debug": bool,
})
MriRobustTemplateParamsDict = _MriRobustTemplateParamsDictNoTag | MriRobustTemplateParamsDictTagged


class MriRobustTemplateOutputs(typing.NamedTuple):
    """
    Output object returned when calling `MriRobustTemplateParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    template_output: OutputPathType
    """Output template volume (final mean/median image)."""
    conform_output: OutputPathType | None
    """Output conformed template volume."""


def mri_robust_template_params(
    mov: list[InputPathType],
    template: str,
    sat: float | None = None,
    satit: bool = False,
    lta: list[str] | None = None,
    mapmov: list[str] | None = None,
    mapmovhdr: list[str] | None = None,
    weights: list[str] | None = None,
    oneminusw: bool = False,
    average: int | None = None,
    inittp: int | None = None,
    fixtp: bool = False,
    iscale: bool = False,
    iscaleonly: bool = False,
    iscalein: list[InputPathType] | None = None,
    iscaleout: list[str] | None = None,
    transonly: bool = False,
    affine: bool = False,
    ixforms: list[InputPathType] | None = None,
    masks: list[InputPathType] | None = None,
    vox2vox: bool = False,
    leastsquares: bool = False,
    noit: bool = False,
    maxit: int | None = None,
    highit: int | None = None,
    epsit: float | None = None,
    pairmaxit: int | None = None,
    pairepsit: float | None = None,
    subsample: int | None = None,
    nomulti: bool = False,
    floattype: bool = False,
    finalnearest: bool = False,
    doubleprec: bool = False,
    cras: bool = False,
    res_thresh: float | None = None,
    frobnorm_thresh: float | None = None,
    conform: str | None = None,
    seed: int | None = None,
    allow_diff_vox_size: bool = False,
    threads: int | None = None,
    debug: bool = False,
) -> MriRobustTemplateParamsDictTagged:
    """
    Build parameters.
    
    Args:
        mov: Input movable volumes to be aligned to common mean/median template\
            (at least 2 required).
        template: Output template volume (final mean/median image).
        sat: Set outlier sensitivity manually. Higher values mean less\
            sensitivity.
        satit: Auto-detect good sensitivity (recommended for head or full brain\
            scans).
        lta: Output LTA transforms to template (one per input volume).
        mapmov: Output mapped and resampled images in template space (one per\
            input volume).
        mapmovhdr: Output header-adjusted movable images (no resampling, only\
            vox2ras adjusted).
        weights: Output weight volumes in template space (0=regular,\
            1=outlier).
        oneminusw: Invert outlier weight map (0=outlier), as in earlier\
            versions.
        average: Construct template from: 0=mean, 1=median (default 1).
        inittp: Use timepoint number for spatial initialization (default:\
            random). 0 constructs template from original volumes without\
            initialization.
        fixtp: Map everything to initial timepoint (init TP is not resampled).
        iscale: Enable intensity scaling (default off).
        iscaleonly: Only perform intensity scaling (no spatial transformation).
        iscalein: Input initial intensity scale files.
        iscaleout: Output final intensity scale files (will activate --iscale).
        transonly: Find 3 parameter translation only.
        affine: Find 12 parameter affine transform.
        ixforms: Use initial LTA transforms on source ('id' for identity).
        masks: Input mask volumes applied to movable images.
        vox2vox: Output VOX2VOX LTA file (default is RAS2RAS).
        leastsquares: Use least squares instead of robust M-estimator (for\
            testing only).
        noit: Do not iterate, just create first template.
        maxit: Maximum number of template iterations (default: 6 if >2\
            timepoints, 5 otherwise).
        highit: Maximum number of iterations on highest resolution (default:\
            -1, use maxit).
        epsit: Stop template iterations when all transform updates fall below\
            this value (default: -1.0, disabled).
        pairmaxit: Maximum number of iterations for pairwise registrations\
            (default: 5).
        pairepsit: Stop pairwise registration iterations when transform updates\
            fall below this value (default: 0.01).
        subsample: Subsample if voxel dimension exceeds this value on all axes\
            (default: -1, disabled).
        nomulti: Do not use multi-resolution (process highest resolution only).
        floattype: Convert images to float internally (default: keep input\
            type).
        finalnearest: Use nearest neighbor interpolation when creating the\
            final average.
        doubleprec: Use double precision instead of float internally (large\
            memory usage).
        cras: Center template at average CRAS instead of average barycenter.
        res_thresh: Volume resolution threshold in mm (default: 0.01).
        frobnorm_thresh: Matrix Frobenius norm threshold (default: 0.0001).
        conform: Output conformed template (256^3, 1mm isotropic voxels).
        seed: Set random seed for target selection (default: 0).
        allow_diff_vox_size: Allow input volumes with different voxel sizes.
        threads: Set number of OpenMP threads.
        debug: Show debug output.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "freesurfer/mri_robust_template",
        "mov": mov,
        "template": template,
        "satit": satit,
        "oneminusw": oneminusw,
        "fixtp": fixtp,
        "iscale": iscale,
        "iscaleonly": iscaleonly,
        "transonly": transonly,
        "affine": affine,
        "vox2vox": vox2vox,
        "leastsquares": leastsquares,
        "noit": noit,
        "nomulti": nomulti,
        "floattype": floattype,
        "finalnearest": finalnearest,
        "doubleprec": doubleprec,
        "cras": cras,
        "allow_diff_vox_size": allow_diff_vox_size,
        "debug": debug,
    }
    if sat is not None:
        params["sat"] = sat
    if lta is not None:
        params["lta"] = lta
    if mapmov is not None:
        params["mapmov"] = mapmov
    if mapmovhdr is not None:
        params["mapmovhdr"] = mapmovhdr
    if weights is not None:
        params["weights"] = weights
    if average is not None:
        params["average"] = average
    if inittp is not None:
        params["inittp"] = inittp
    if iscalein is not None:
        params["iscalein"] = iscalein
    if iscaleout is not None:
        params["iscaleout"] = iscaleout
    if ixforms is not None:
        params["ixforms"] = ixforms
    if masks is not None:
        params["masks"] = masks
    if maxit is not None:
        params["maxit"] = maxit
    if highit is not None:
        params["highit"] = highit
    if epsit is not None:
        params["epsit"] = epsit
    if pairmaxit is not None:
        params["pairmaxit"] = pairmaxit
    if pairepsit is not None:
        params["pairepsit"] = pairepsit
    if subsample is not None:
        params["subsample"] = subsample
    if res_thresh is not None:
        params["res_thresh"] = res_thresh
    if frobnorm_thresh is not None:
        params["frobnorm_thresh"] = frobnorm_thresh
    if conform is not None:
        params["conform"] = conform
    if seed is not None:
        params["seed"] = seed
    if threads is not None:
        params["threads"] = threads
    return params


def mri_robust_template_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `MriRobustTemplateParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("mov", None) is None:
        raise StyxValidationError("`mov` must not be None")
    if not isinstance(params["mov"], list):
        raise StyxValidationError(f'`mov` has the wrong type: Received `{type(params.get("mov", None))}` expected `list[InputPathType]`')
    for e in params["mov"]:
        if not isinstance(e, (pathlib.Path, str)):
            raise StyxValidationError(f'`mov` has the wrong type: Received `{type(params.get("mov", None))}` expected `list[InputPathType]`')
    if params.get("template", None) is None:
        raise StyxValidationError("`template` must not be None")
    if not isinstance(params["template"], str):
        raise StyxValidationError(f'`template` has the wrong type: Received `{type(params.get("template", None))}` expected `str`')
    if params.get("sat", None) is not None:
        if not isinstance(params["sat"], (float, int)):
            raise StyxValidationError(f'`sat` has the wrong type: Received `{type(params.get("sat", None))}` expected `float | None`')
    if params.get("satit", False) is None:
        raise StyxValidationError("`satit` must not be None")
    if not isinstance(params["satit"], bool):
        raise StyxValidationError(f'`satit` has the wrong type: Received `{type(params.get("satit", False))}` expected `bool`')
    if params.get("lta", None) is not None:
        if not isinstance(params["lta"], list):
            raise StyxValidationError(f'`lta` has the wrong type: Received `{type(params.get("lta", None))}` expected `list[str] | None`')
        for e in params["lta"]:
            if not isinstance(e, str):
                raise StyxValidationError(f'`lta` has the wrong type: Received `{type(params.get("lta", None))}` expected `list[str] | None`')
    if params.get("mapmov", None) is not None:
        if not isinstance(params["mapmov"], list):
            raise StyxValidationError(f'`mapmov` has the wrong type: Received `{type(params.get("mapmov", None))}` expected `list[str] | None`')
        for e in params["mapmov"]:
            if not isinstance(e, str):
                raise StyxValidationError(f'`mapmov` has the wrong type: Received `{type(params.get("mapmov", None))}` expected `list[str] | None`')
    if params.get("mapmovhdr", None) is not None:
        if not isinstance(params["mapmovhdr"], list):
            raise StyxValidationError(f'`mapmovhdr` has the wrong type: Received `{type(params.get("mapmovhdr", None))}` expected `list[str] | None`')
        for e in params["mapmovhdr"]:
            if not isinstance(e, str):
                raise StyxValidationError(f'`mapmovhdr` has the wrong type: Received `{type(params.get("mapmovhdr", None))}` expected `list[str] | None`')
    if params.get("weights", None) is not None:
        if not isinstance(params["weights"], list):
            raise StyxValidationError(f'`weights` has the wrong type: Received `{type(params.get("weights", None))}` expected `list[str] | None`')
        for e in params["weights"]:
            if not isinstance(e, str):
                raise StyxValidationError(f'`weights` has the wrong type: Received `{type(params.get("weights", None))}` expected `list[str] | None`')
    if params.get("oneminusw", False) is None:
        raise StyxValidationError("`oneminusw` must not be None")
    if not isinstance(params["oneminusw"], bool):
        raise StyxValidationError(f'`oneminusw` has the wrong type: Received `{type(params.get("oneminusw", False))}` expected `bool`')
    if params.get("average", None) is not None:
        if not isinstance(params["average"], int):
            raise StyxValidationError(f'`average` has the wrong type: Received `{type(params.get("average", None))}` expected `int | None`')
    if params.get("inittp", None) is not None:
        if not isinstance(params["inittp"], int):
            raise StyxValidationError(f'`inittp` has the wrong type: Received `{type(params.get("inittp", None))}` expected `int | None`')
    if params.get("fixtp", False) is None:
        raise StyxValidationError("`fixtp` must not be None")
    if not isinstance(params["fixtp"], bool):
        raise StyxValidationError(f'`fixtp` has the wrong type: Received `{type(params.get("fixtp", False))}` expected `bool`')
    if params.get("iscale", False) is None:
        raise StyxValidationError("`iscale` must not be None")
    if not isinstance(params["iscale"], bool):
        raise StyxValidationError(f'`iscale` has the wrong type: Received `{type(params.get("iscale", False))}` expected `bool`')
    if params.get("iscaleonly", False) is None:
        raise StyxValidationError("`iscaleonly` must not be None")
    if not isinstance(params["iscaleonly"], bool):
        raise StyxValidationError(f'`iscaleonly` has the wrong type: Received `{type(params.get("iscaleonly", False))}` expected `bool`')
    if params.get("iscalein", None) is not None:
        if not isinstance(params["iscalein"], list):
            raise StyxValidationError(f'`iscalein` has the wrong type: Received `{type(params.get("iscalein", None))}` expected `list[InputPathType] | None`')
        for e in params["iscalein"]:
            if not isinstance(e, (pathlib.Path, str)):
                raise StyxValidationError(f'`iscalein` has the wrong type: Received `{type(params.get("iscalein", None))}` expected `list[InputPathType] | None`')
    if params.get("iscaleout", None) is not None:
        if not isinstance(params["iscaleout"], list):
            raise StyxValidationError(f'`iscaleout` has the wrong type: Received `{type(params.get("iscaleout", None))}` expected `list[str] | None`')
        for e in params["iscaleout"]:
            if not isinstance(e, str):
                raise StyxValidationError(f'`iscaleout` has the wrong type: Received `{type(params.get("iscaleout", None))}` expected `list[str] | None`')
    if params.get("transonly", False) is None:
        raise StyxValidationError("`transonly` must not be None")
    if not isinstance(params["transonly"], bool):
        raise StyxValidationError(f'`transonly` has the wrong type: Received `{type(params.get("transonly", False))}` expected `bool`')
    if params.get("affine", False) is None:
        raise StyxValidationError("`affine` must not be None")
    if not isinstance(params["affine"], bool):
        raise StyxValidationError(f'`affine` has the wrong type: Received `{type(params.get("affine", False))}` expected `bool`')
    if params.get("ixforms", None) is not None:
        if not isinstance(params["ixforms"], list):
            raise StyxValidationError(f'`ixforms` has the wrong type: Received `{type(params.get("ixforms", None))}` expected `list[InputPathType] | None`')
        for e in params["ixforms"]:
            if not isinstance(e, (pathlib.Path, str)):
                raise StyxValidationError(f'`ixforms` has the wrong type: Received `{type(params.get("ixforms", None))}` expected `list[InputPathType] | None`')
    if params.get("masks", None) is not None:
        if not isinstance(params["masks"], list):
            raise StyxValidationError(f'`masks` has the wrong type: Received `{type(params.get("masks", None))}` expected `list[InputPathType] | None`')
        for e in params["masks"]:
            if not isinstance(e, (pathlib.Path, str)):
                raise StyxValidationError(f'`masks` has the wrong type: Received `{type(params.get("masks", None))}` expected `list[InputPathType] | None`')
    if params.get("vox2vox", False) is None:
        raise StyxValidationError("`vox2vox` must not be None")
    if not isinstance(params["vox2vox"], bool):
        raise StyxValidationError(f'`vox2vox` has the wrong type: Received `{type(params.get("vox2vox", False))}` expected `bool`')
    if params.get("leastsquares", False) is None:
        raise StyxValidationError("`leastsquares` must not be None")
    if not isinstance(params["leastsquares"], bool):
        raise StyxValidationError(f'`leastsquares` has the wrong type: Received `{type(params.get("leastsquares", False))}` expected `bool`')
    if params.get("noit", False) is None:
        raise StyxValidationError("`noit` must not be None")
    if not isinstance(params["noit"], bool):
        raise StyxValidationError(f'`noit` has the wrong type: Received `{type(params.get("noit", False))}` expected `bool`')
    if params.get("maxit", None) is not None:
        if not isinstance(params["maxit"], int):
            raise StyxValidationError(f'`maxit` has the wrong type: Received `{type(params.get("maxit", None))}` expected `int | None`')
    if params.get("highit", None) is not None:
        if not isinstance(params["highit"], int):
            raise StyxValidationError(f'`highit` has the wrong type: Received `{type(params.get("highit", None))}` expected `int | None`')
    if params.get("epsit", None) is not None:
        if not isinstance(params["epsit"], (float, int)):
            raise StyxValidationError(f'`epsit` has the wrong type: Received `{type(params.get("epsit", None))}` expected `float | None`')
    if params.get("pairmaxit", None) is not None:
        if not isinstance(params["pairmaxit"], int):
            raise StyxValidationError(f'`pairmaxit` has the wrong type: Received `{type(params.get("pairmaxit", None))}` expected `int | None`')
    if params.get("pairepsit", None) is not None:
        if not isinstance(params["pairepsit"], (float, int)):
            raise StyxValidationError(f'`pairepsit` has the wrong type: Received `{type(params.get("pairepsit", None))}` expected `float | None`')
    if params.get("subsample", None) is not None:
        if not isinstance(params["subsample"], int):
            raise StyxValidationError(f'`subsample` has the wrong type: Received `{type(params.get("subsample", None))}` expected `int | None`')
    if params.get("nomulti", False) is None:
        raise StyxValidationError("`nomulti` must not be None")
    if not isinstance(params["nomulti"], bool):
        raise StyxValidationError(f'`nomulti` has the wrong type: Received `{type(params.get("nomulti", False))}` expected `bool`')
    if params.get("floattype", False) is None:
        raise StyxValidationError("`floattype` must not be None")
    if not isinstance(params["floattype"], bool):
        raise StyxValidationError(f'`floattype` has the wrong type: Received `{type(params.get("floattype", False))}` expected `bool`')
    if params.get("finalnearest", False) is None:
        raise StyxValidationError("`finalnearest` must not be None")
    if not isinstance(params["finalnearest"], bool):
        raise StyxValidationError(f'`finalnearest` has the wrong type: Received `{type(params.get("finalnearest", False))}` expected `bool`')
    if params.get("doubleprec", False) is None:
        raise StyxValidationError("`doubleprec` must not be None")
    if not isinstance(params["doubleprec"], bool):
        raise StyxValidationError(f'`doubleprec` has the wrong type: Received `{type(params.get("doubleprec", False))}` expected `bool`')
    if params.get("cras", False) is None:
        raise StyxValidationError("`cras` must not be None")
    if not isinstance(params["cras"], bool):
        raise StyxValidationError(f'`cras` has the wrong type: Received `{type(params.get("cras", False))}` expected `bool`')
    if params.get("res_thresh", None) is not None:
        if not isinstance(params["res_thresh"], (float, int)):
            raise StyxValidationError(f'`res_thresh` has the wrong type: Received `{type(params.get("res_thresh", None))}` expected `float | None`')
    if params.get("frobnorm_thresh", None) is not None:
        if not isinstance(params["frobnorm_thresh"], (float, int)):
            raise StyxValidationError(f'`frobnorm_thresh` has the wrong type: Received `{type(params.get("frobnorm_thresh", None))}` expected `float | None`')
    if params.get("conform", None) is not None:
        if not isinstance(params["conform"], str):
            raise StyxValidationError(f'`conform` has the wrong type: Received `{type(params.get("conform", None))}` expected `str | None`')
    if params.get("seed", None) is not None:
        if not isinstance(params["seed"], int):
            raise StyxValidationError(f'`seed` has the wrong type: Received `{type(params.get("seed", None))}` expected `int | None`')
    if params.get("allow_diff_vox_size", False) is None:
        raise StyxValidationError("`allow_diff_vox_size` must not be None")
    if not isinstance(params["allow_diff_vox_size"], bool):
        raise StyxValidationError(f'`allow_diff_vox_size` has the wrong type: Received `{type(params.get("allow_diff_vox_size", False))}` expected `bool`')
    if params.get("threads", None) is not None:
        if not isinstance(params["threads"], int):
            raise StyxValidationError(f'`threads` has the wrong type: Received `{type(params.get("threads", None))}` expected `int | None`')
    if params.get("debug", False) is None:
        raise StyxValidationError("`debug` must not be None")
    if not isinstance(params["debug"], bool):
        raise StyxValidationError(f'`debug` has the wrong type: Received `{type(params.get("debug", False))}` expected `bool`')


def mri_robust_template_cargs(
    params: MriRobustTemplateParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("mri_robust_template")
    cargs.extend([
        "--mov",
        *[execution.input_file(f) for f in params.get("mov", None)]
    ])
    cargs.extend([
        "--template",
        params.get("template", None)
    ])
    if params.get("sat", None) is not None:
        cargs.extend([
            "--sat",
            str(params.get("sat", None))
        ])
    if params.get("satit", False):
        cargs.append("--satit")
    if params.get("lta", None) is not None:
        cargs.extend([
            "--lta",
            *params.get("lta", None)
        ])
    if params.get("mapmov", None) is not None:
        cargs.extend([
            "--mapmov",
            *params.get("mapmov", None)
        ])
    if params.get("mapmovhdr", None) is not None:
        cargs.extend([
            "--mapmovhdr",
            *params.get("mapmovhdr", None)
        ])
    if params.get("weights", None) is not None:
        cargs.extend([
            "--weights",
            *params.get("weights", None)
        ])
    if params.get("oneminusw", False):
        cargs.append("--oneminusw")
    if params.get("average", None) is not None:
        cargs.extend([
            "--average",
            str(params.get("average", None))
        ])
    if params.get("inittp", None) is not None:
        cargs.extend([
            "--inittp",
            str(params.get("inittp", None))
        ])
    if params.get("fixtp", False):
        cargs.append("--fixtp")
    if params.get("iscale", False):
        cargs.append("--iscale")
    if params.get("iscaleonly", False):
        cargs.append("--iscaleonly")
    if params.get("iscalein", None) is not None:
        cargs.extend([
            "--iscalein",
            *[execution.input_file(f) for f in params.get("iscalein", None)]
        ])
    if params.get("iscaleout", None) is not None:
        cargs.extend([
            "--iscaleout",
            *params.get("iscaleout", None)
        ])
    if params.get("transonly", False):
        cargs.append("--transonly")
    if params.get("affine", False):
        cargs.append("--affine")
    if params.get("ixforms", None) is not None:
        cargs.extend([
            "--ixforms",
            *[execution.input_file(f) for f in params.get("ixforms", None)]
        ])
    if params.get("masks", None) is not None:
        cargs.extend([
            "--masks",
            *[execution.input_file(f) for f in params.get("masks", None)]
        ])
    if params.get("vox2vox", False):
        cargs.append("--vox2vox")
    if params.get("leastsquares", False):
        cargs.append("--leastsquares")
    if params.get("noit", False):
        cargs.append("--noit")
    if params.get("maxit", None) is not None:
        cargs.extend([
            "--maxit",
            str(params.get("maxit", None))
        ])
    if params.get("highit", None) is not None:
        cargs.extend([
            "--highit",
            str(params.get("highit", None))
        ])
    if params.get("epsit", None) is not None:
        cargs.extend([
            "--epsit",
            str(params.get("epsit", None))
        ])
    if params.get("pairmaxit", None) is not None:
        cargs.extend([
            "--pairmaxit",
            str(params.get("pairmaxit", None))
        ])
    if params.get("pairepsit", None) is not None:
        cargs.extend([
            "--pairepsit",
            str(params.get("pairepsit", None))
        ])
    if params.get("subsample", None) is not None:
        cargs.extend([
            "--subsample",
            str(params.get("subsample", None))
        ])
    if params.get("nomulti", False):
        cargs.append("--nomulti")
    if params.get("floattype", False):
        cargs.append("--floattype")
    if params.get("finalnearest", False):
        cargs.append("--finalnearest")
    if params.get("doubleprec", False):
        cargs.append("--doubleprec")
    if params.get("cras", False):
        cargs.append("--cras")
    if params.get("res_thresh", None) is not None:
        cargs.extend([
            "--res-thresh",
            str(params.get("res_thresh", None))
        ])
    if params.get("frobnorm_thresh", None) is not None:
        cargs.extend([
            "--frobnorm-thresh",
            str(params.get("frobnorm_thresh", None))
        ])
    if params.get("conform", None) is not None:
        cargs.extend([
            "--conform",
            params.get("conform", None)
        ])
    if params.get("seed", None) is not None:
        cargs.extend([
            "--seed",
            str(params.get("seed", None))
        ])
    if params.get("allow_diff_vox_size", False):
        cargs.append("--allow-diff-vox-size")
    if params.get("threads", None) is not None:
        cargs.extend([
            "--threads",
            str(params.get("threads", None))
        ])
    if params.get("debug", False):
        cargs.append("--debug")
    return cargs


def mri_robust_template_outputs(
    params: MriRobustTemplateParamsDict,
    execution: Execution,
) -> MriRobustTemplateOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = MriRobustTemplateOutputs(
        root=execution.output_file("."),
        template_output=execution.output_file(params.get("template", None)),
        conform_output=execution.output_file(params.get("conform", None)) if (params.get("conform") is not None) else None,
    )
    return ret


def mri_robust_template_execute(
    params: MriRobustTemplateParamsDict,
    runner: Runner | None = None,
) -> MriRobustTemplateOutputs:
    """
    mri_robust_template
    
    Constructs an unbiased robust template for longitudinal volumes using an
    iterative method.
    
    Author: FreeSurfer Developers
    
    URL: https://github.com/freesurfer/freesurfer
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `MriRobustTemplateOutputs`).
    """
    mri_robust_template_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(MRI_ROBUST_TEMPLATE_METADATA)
    params = execution.params(params)
    cargs = mri_robust_template_cargs(params, execution)
    ret = mri_robust_template_outputs(params, execution)
    execution.run(cargs)
    return ret


def mri_robust_template(
    mov: list[InputPathType],
    template: str,
    sat: float | None = None,
    satit: bool = False,
    lta: list[str] | None = None,
    mapmov: list[str] | None = None,
    mapmovhdr: list[str] | None = None,
    weights: list[str] | None = None,
    oneminusw: bool = False,
    average: int | None = None,
    inittp: int | None = None,
    fixtp: bool = False,
    iscale: bool = False,
    iscaleonly: bool = False,
    iscalein: list[InputPathType] | None = None,
    iscaleout: list[str] | None = None,
    transonly: bool = False,
    affine: bool = False,
    ixforms: list[InputPathType] | None = None,
    masks: list[InputPathType] | None = None,
    vox2vox: bool = False,
    leastsquares: bool = False,
    noit: bool = False,
    maxit: int | None = None,
    highit: int | None = None,
    epsit: float | None = None,
    pairmaxit: int | None = None,
    pairepsit: float | None = None,
    subsample: int | None = None,
    nomulti: bool = False,
    floattype: bool = False,
    finalnearest: bool = False,
    doubleprec: bool = False,
    cras: bool = False,
    res_thresh: float | None = None,
    frobnorm_thresh: float | None = None,
    conform: str | None = None,
    seed: int | None = None,
    allow_diff_vox_size: bool = False,
    threads: int | None = None,
    debug: bool = False,
    runner: Runner | None = None,
) -> MriRobustTemplateOutputs:
    """
    mri_robust_template
    
    Constructs an unbiased robust template for longitudinal volumes using an
    iterative method.
    
    Author: FreeSurfer Developers
    
    URL: https://github.com/freesurfer/freesurfer
    
    Args:
        mov: Input movable volumes to be aligned to common mean/median template\
            (at least 2 required).
        template: Output template volume (final mean/median image).
        sat: Set outlier sensitivity manually. Higher values mean less\
            sensitivity.
        satit: Auto-detect good sensitivity (recommended for head or full brain\
            scans).
        lta: Output LTA transforms to template (one per input volume).
        mapmov: Output mapped and resampled images in template space (one per\
            input volume).
        mapmovhdr: Output header-adjusted movable images (no resampling, only\
            vox2ras adjusted).
        weights: Output weight volumes in template space (0=regular,\
            1=outlier).
        oneminusw: Invert outlier weight map (0=outlier), as in earlier\
            versions.
        average: Construct template from: 0=mean, 1=median (default 1).
        inittp: Use timepoint number for spatial initialization (default:\
            random). 0 constructs template from original volumes without\
            initialization.
        fixtp: Map everything to initial timepoint (init TP is not resampled).
        iscale: Enable intensity scaling (default off).
        iscaleonly: Only perform intensity scaling (no spatial transformation).
        iscalein: Input initial intensity scale files.
        iscaleout: Output final intensity scale files (will activate --iscale).
        transonly: Find 3 parameter translation only.
        affine: Find 12 parameter affine transform.
        ixforms: Use initial LTA transforms on source ('id' for identity).
        masks: Input mask volumes applied to movable images.
        vox2vox: Output VOX2VOX LTA file (default is RAS2RAS).
        leastsquares: Use least squares instead of robust M-estimator (for\
            testing only).
        noit: Do not iterate, just create first template.
        maxit: Maximum number of template iterations (default: 6 if >2\
            timepoints, 5 otherwise).
        highit: Maximum number of iterations on highest resolution (default:\
            -1, use maxit).
        epsit: Stop template iterations when all transform updates fall below\
            this value (default: -1.0, disabled).
        pairmaxit: Maximum number of iterations for pairwise registrations\
            (default: 5).
        pairepsit: Stop pairwise registration iterations when transform updates\
            fall below this value (default: 0.01).
        subsample: Subsample if voxel dimension exceeds this value on all axes\
            (default: -1, disabled).
        nomulti: Do not use multi-resolution (process highest resolution only).
        floattype: Convert images to float internally (default: keep input\
            type).
        finalnearest: Use nearest neighbor interpolation when creating the\
            final average.
        doubleprec: Use double precision instead of float internally (large\
            memory usage).
        cras: Center template at average CRAS instead of average barycenter.
        res_thresh: Volume resolution threshold in mm (default: 0.01).
        frobnorm_thresh: Matrix Frobenius norm threshold (default: 0.0001).
        conform: Output conformed template (256^3, 1mm isotropic voxels).
        seed: Set random seed for target selection (default: 0).
        allow_diff_vox_size: Allow input volumes with different voxel sizes.
        threads: Set number of OpenMP threads.
        debug: Show debug output.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `MriRobustTemplateOutputs`).
    """
    params = mri_robust_template_params(
        mov=mov,
        template=template,
        sat=sat,
        satit=satit,
        lta=lta,
        mapmov=mapmov,
        mapmovhdr=mapmovhdr,
        weights=weights,
        oneminusw=oneminusw,
        average=average,
        inittp=inittp,
        fixtp=fixtp,
        iscale=iscale,
        iscaleonly=iscaleonly,
        iscalein=iscalein,
        iscaleout=iscaleout,
        transonly=transonly,
        affine=affine,
        ixforms=ixforms,
        masks=masks,
        vox2vox=vox2vox,
        leastsquares=leastsquares,
        noit=noit,
        maxit=maxit,
        highit=highit,
        epsit=epsit,
        pairmaxit=pairmaxit,
        pairepsit=pairepsit,
        subsample=subsample,
        nomulti=nomulti,
        floattype=floattype,
        finalnearest=finalnearest,
        doubleprec=doubleprec,
        cras=cras,
        res_thresh=res_thresh,
        frobnorm_thresh=frobnorm_thresh,
        conform=conform,
        seed=seed,
        allow_diff_vox_size=allow_diff_vox_size,
        threads=threads,
        debug=debug,
    )
    return mri_robust_template_execute(params, runner)


__all__ = [
    "MRI_ROBUST_TEMPLATE_METADATA",
    "MriRobustTemplateOutputs",
    "MriRobustTemplateParamsDict",
    "MriRobustTemplateParamsDictTagged",
    "mri_robust_template",
    "mri_robust_template_execute",
    "mri_robust_template_params",
]
