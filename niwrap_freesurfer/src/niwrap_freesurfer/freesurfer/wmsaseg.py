# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

WMSASEG_METADATA = Metadata(
    id="dc03aa6f6f16bc8b5912ca6532979e9cc7ed9e4d.boutiques",
    name="wmsaseg",
    package="freesurfer",
    container_image_tag="freesurfer/freesurfer:7.4.1",
)


_WmsasegParamsDictNoTag = typing.TypedDict('_WmsasegParamsDictNoTag', {
    "subject": str,
    "source_orig": typing.NotRequired[str | None],
    "source_long": bool,
    "output_subdir": typing.NotRequired[str | None],
    "gca_file": typing.NotRequired[InputPathType | None],
    "no_reg": bool,
    "no_canorm": bool,
    "init_spm": bool,
    "reg_only": bool,
    "halo1": bool,
    "halo2": bool,
})
WmsasegParamsDictTagged = typing.TypedDict('WmsasegParamsDictTagged', {
    "@type": typing.Literal["freesurfer/wmsaseg"],
    "subject": str,
    "source_orig": typing.NotRequired[str | None],
    "source_long": bool,
    "output_subdir": typing.NotRequired[str | None],
    "gca_file": typing.NotRequired[InputPathType | None],
    "no_reg": bool,
    "no_canorm": bool,
    "init_spm": bool,
    "reg_only": bool,
    "halo1": bool,
    "halo2": bool,
})
WmsasegParamsDict = _WmsasegParamsDictNoTag | WmsasegParamsDictTagged


class WmsasegOutputs(typing.NamedTuple):
    """
    Output object returned when calling `WmsasegParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    t1_canorm: OutputPathType | None
    """CA normalized T1 output"""
    wmsa_lta: OutputPathType | None
    """Linear transform to average space"""


def wmsaseg_params(
    subject: str,
    source_orig: str | None = None,
    source_long: bool = False,
    output_subdir: str | None = None,
    gca_file: InputPathType | None = None,
    no_reg: bool = False,
    no_canorm: bool = False,
    init_spm: bool = False,
    reg_only: bool = False,
    halo1: bool = False,
    halo2: bool = False,
) -> WmsasegParamsDictTagged:
    """
    Build parameters.
    
    Args:
        subject: Subject identifier.
        source_orig: Use T2 and PD images from original subject.
        source_long: Use T2 and PD images from longitudinal subject.
        output_subdir: Output subdirectory name (default is wmsa).
        gca_file: GCA file path.
        no_reg: Do not register mode to anatomical image.
        no_canorm: Do not run mri_ca_normalize.
        init_spm: Initialize SPM (default is FSL).
        reg_only: Only perform registration.
        halo1: Halo 1 option.
        halo2: Halo 2 option.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "freesurfer/wmsaseg",
        "subject": subject,
        "source_long": source_long,
        "no_reg": no_reg,
        "no_canorm": no_canorm,
        "init_spm": init_spm,
        "reg_only": reg_only,
        "halo1": halo1,
        "halo2": halo2,
    }
    if source_orig is not None:
        params["source_orig"] = source_orig
    if output_subdir is not None:
        params["output_subdir"] = output_subdir
    if gca_file is not None:
        params["gca_file"] = gca_file
    return params


def wmsaseg_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `WmsasegParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("subject", None) is None:
        raise StyxValidationError("`subject` must not be None")
    if not isinstance(params["subject"], str):
        raise StyxValidationError(f'`subject` has the wrong type: Received `{type(params.get("subject", None))}` expected `str`')
    if params.get("source_orig", None) is not None:
        if not isinstance(params["source_orig"], str):
            raise StyxValidationError(f'`source_orig` has the wrong type: Received `{type(params.get("source_orig", None))}` expected `str | None`')
    if params.get("source_long", False) is None:
        raise StyxValidationError("`source_long` must not be None")
    if not isinstance(params["source_long"], bool):
        raise StyxValidationError(f'`source_long` has the wrong type: Received `{type(params.get("source_long", False))}` expected `bool`')
    if params.get("output_subdir", None) is not None:
        if not isinstance(params["output_subdir"], str):
            raise StyxValidationError(f'`output_subdir` has the wrong type: Received `{type(params.get("output_subdir", None))}` expected `str | None`')
    if params.get("gca_file", None) is not None:
        if not isinstance(params["gca_file"], (pathlib.Path, str)):
            raise StyxValidationError(f'`gca_file` has the wrong type: Received `{type(params.get("gca_file", None))}` expected `InputPathType | None`')
    if params.get("no_reg", False) is None:
        raise StyxValidationError("`no_reg` must not be None")
    if not isinstance(params["no_reg"], bool):
        raise StyxValidationError(f'`no_reg` has the wrong type: Received `{type(params.get("no_reg", False))}` expected `bool`')
    if params.get("no_canorm", False) is None:
        raise StyxValidationError("`no_canorm` must not be None")
    if not isinstance(params["no_canorm"], bool):
        raise StyxValidationError(f'`no_canorm` has the wrong type: Received `{type(params.get("no_canorm", False))}` expected `bool`')
    if params.get("init_spm", False) is None:
        raise StyxValidationError("`init_spm` must not be None")
    if not isinstance(params["init_spm"], bool):
        raise StyxValidationError(f'`init_spm` has the wrong type: Received `{type(params.get("init_spm", False))}` expected `bool`')
    if params.get("reg_only", False) is None:
        raise StyxValidationError("`reg_only` must not be None")
    if not isinstance(params["reg_only"], bool):
        raise StyxValidationError(f'`reg_only` has the wrong type: Received `{type(params.get("reg_only", False))}` expected `bool`')
    if params.get("halo1", False) is None:
        raise StyxValidationError("`halo1` must not be None")
    if not isinstance(params["halo1"], bool):
        raise StyxValidationError(f'`halo1` has the wrong type: Received `{type(params.get("halo1", False))}` expected `bool`')
    if params.get("halo2", False) is None:
        raise StyxValidationError("`halo2` must not be None")
    if not isinstance(params["halo2"], bool):
        raise StyxValidationError(f'`halo2` has the wrong type: Received `{type(params.get("halo2", False))}` expected `bool`')


def wmsaseg_cargs(
    params: WmsasegParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("wmsaseg")
    cargs.extend([
        "-s",
        params.get("subject", None)
    ])
    if params.get("source_orig", None) is not None:
        cargs.extend([
            "--s+orig",
            params.get("source_orig", None)
        ])
    if params.get("source_long", False):
        cargs.append("--s+long")
    if params.get("output_subdir", None) is not None:
        cargs.extend([
            "--sub",
            params.get("output_subdir", None)
        ])
    if params.get("gca_file", None) is not None:
        cargs.extend([
            "--gca",
            execution.input_file(params.get("gca_file", None))
        ])
    if params.get("no_reg", False):
        cargs.append("--no-reg")
    if params.get("no_canorm", False):
        cargs.append("--no-canorm")
    if params.get("init_spm", False):
        cargs.append("--init-spm")
    if params.get("reg_only", False):
        cargs.append("--reg-only")
    if params.get("halo1", False):
        cargs.append("--halo1")
    if params.get("halo2", False):
        cargs.append("--halo2")
    return cargs


def wmsaseg_outputs(
    params: WmsasegParamsDict,
    execution: Execution,
) -> WmsasegOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = WmsasegOutputs(
        root=execution.output_file("."),
        t1_canorm=execution.output_file(params.get("output_subdir", None) + "/T1.canorm.mgz") if (params.get("output_subdir") is not None) else None,
        wmsa_lta=execution.output_file(params.get("output_subdir", None) + "/wmsa.lta") if (params.get("output_subdir") is not None) else None,
    )
    return ret


def wmsaseg_execute(
    params: WmsasegParamsDict,
    runner: Runner | None = None,
) -> WmsasegOutputs:
    """
    wmsaseg
    
    White Matter Hyperintensity Segmentation Tool.
    
    Author: FreeSurfer Developers
    
    URL: https://github.com/freesurfer/freesurfer
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `WmsasegOutputs`).
    """
    wmsaseg_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(WMSASEG_METADATA)
    params = execution.params(params)
    cargs = wmsaseg_cargs(params, execution)
    ret = wmsaseg_outputs(params, execution)
    execution.run(cargs)
    return ret


def wmsaseg(
    subject: str,
    source_orig: str | None = None,
    source_long: bool = False,
    output_subdir: str | None = None,
    gca_file: InputPathType | None = None,
    no_reg: bool = False,
    no_canorm: bool = False,
    init_spm: bool = False,
    reg_only: bool = False,
    halo1: bool = False,
    halo2: bool = False,
    runner: Runner | None = None,
) -> WmsasegOutputs:
    """
    wmsaseg
    
    White Matter Hyperintensity Segmentation Tool.
    
    Author: FreeSurfer Developers
    
    URL: https://github.com/freesurfer/freesurfer
    
    Args:
        subject: Subject identifier.
        source_orig: Use T2 and PD images from original subject.
        source_long: Use T2 and PD images from longitudinal subject.
        output_subdir: Output subdirectory name (default is wmsa).
        gca_file: GCA file path.
        no_reg: Do not register mode to anatomical image.
        no_canorm: Do not run mri_ca_normalize.
        init_spm: Initialize SPM (default is FSL).
        reg_only: Only perform registration.
        halo1: Halo 1 option.
        halo2: Halo 2 option.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `WmsasegOutputs`).
    """
    params = wmsaseg_params(
        subject=subject,
        source_orig=source_orig,
        source_long=source_long,
        output_subdir=output_subdir,
        gca_file=gca_file,
        no_reg=no_reg,
        no_canorm=no_canorm,
        init_spm=init_spm,
        reg_only=reg_only,
        halo1=halo1,
        halo2=halo2,
    )
    return wmsaseg_execute(params, runner)


__all__ = [
    "WMSASEG_METADATA",
    "WmsasegOutputs",
    "WmsasegParamsDict",
    "WmsasegParamsDictTagged",
    "wmsaseg",
    "wmsaseg_execute",
    "wmsaseg_params",
]
