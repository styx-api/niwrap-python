# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

TRK_TOOLS_METADATA = Metadata(
    id="113c2ab5e4181b985d590456b9c41a26b1525c4f.boutiques",
    name="trk_tools",
    package="freesurfer",
    container_image_tag="freesurfer/freesurfer:7.4.1",
)


_TrkToolsParamsDictNoTag = typing.TypedDict('_TrkToolsParamsDictNoTag', {
    "reference_image": InputPathType,
    "input_trk": InputPathType,
    "output_trk": typing.NotRequired[str | None],
    "output_image": typing.NotRequired[str | None],
    "update_header": bool,
    "output_vtk": typing.NotRequired[str | None],
})
TrkToolsParamsDictTagged = typing.TypedDict('TrkToolsParamsDictTagged', {
    "@type": typing.Literal["freesurfer/trk_tools"],
    "reference_image": InputPathType,
    "input_trk": InputPathType,
    "output_trk": typing.NotRequired[str | None],
    "output_image": typing.NotRequired[str | None],
    "update_header": bool,
    "output_vtk": typing.NotRequired[str | None],
})
TrkToolsParamsDict = _TrkToolsParamsDictNoTag | TrkToolsParamsDictTagged


class TrkToolsOutputs(typing.NamedTuple):
    """
    Output object returned when calling `TrkToolsParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    trk_output_file: OutputPathType | None
    """The processed output TRK file"""
    image_output_file: OutputPathType | None
    """Image exported from TRK file"""
    vtk_output_file: OutputPathType | None
    """VTK file containing streamlines"""


def trk_tools_params(
    reference_image: InputPathType,
    input_trk: InputPathType,
    output_trk: str | None = None,
    output_image: str | None = None,
    update_header: bool = False,
    output_vtk: str | None = None,
) -> TrkToolsParamsDictTagged:
    """
    Build parameters.
    
    Args:
        reference_image: Reference image for TRK processing.
        input_trk: Input TRK file to be processed.
        output_trk: Output TRK file.
        output_image: Export TRK into an image.
        update_header: Update TRK header with reference image.
        output_vtk: Output streamlines in VTK format.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "freesurfer/trk_tools",
        "reference_image": reference_image,
        "input_trk": input_trk,
        "update_header": update_header,
    }
    if output_trk is not None:
        params["output_trk"] = output_trk
    if output_image is not None:
        params["output_image"] = output_image
    if output_vtk is not None:
        params["output_vtk"] = output_vtk
    return params


def trk_tools_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `TrkToolsParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("reference_image", None) is None:
        raise StyxValidationError("`reference_image` must not be None")
    if not isinstance(params["reference_image"], (pathlib.Path, str)):
        raise StyxValidationError(f'`reference_image` has the wrong type: Received `{type(params.get("reference_image", None))}` expected `InputPathType`')
    if params.get("input_trk", None) is None:
        raise StyxValidationError("`input_trk` must not be None")
    if not isinstance(params["input_trk"], (pathlib.Path, str)):
        raise StyxValidationError(f'`input_trk` has the wrong type: Received `{type(params.get("input_trk", None))}` expected `InputPathType`')
    if params.get("output_trk", None) is not None:
        if not isinstance(params["output_trk"], str):
            raise StyxValidationError(f'`output_trk` has the wrong type: Received `{type(params.get("output_trk", None))}` expected `str | None`')
    if params.get("output_image", None) is not None:
        if not isinstance(params["output_image"], str):
            raise StyxValidationError(f'`output_image` has the wrong type: Received `{type(params.get("output_image", None))}` expected `str | None`')
    if params.get("update_header", False) is None:
        raise StyxValidationError("`update_header` must not be None")
    if not isinstance(params["update_header"], bool):
        raise StyxValidationError(f'`update_header` has the wrong type: Received `{type(params.get("update_header", False))}` expected `bool`')
    if params.get("output_vtk", None) is not None:
        if not isinstance(params["output_vtk"], str):
            raise StyxValidationError(f'`output_vtk` has the wrong type: Received `{type(params.get("output_vtk", None))}` expected `str | None`')


def trk_tools_cargs(
    params: TrkToolsParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("trk_tools")
    cargs.extend([
        "-i",
        execution.input_file(params.get("reference_image", None))
    ])
    cargs.extend([
        "-f",
        execution.input_file(params.get("input_trk", None))
    ])
    if params.get("output_trk", None) is not None:
        cargs.extend([
            "-o",
            params.get("output_trk", None)
        ])
    if params.get("output_image", None) is not None:
        cargs.extend([
            "-e",
            params.get("output_image", None)
        ])
    if params.get("update_header", False):
        cargs.append("-u")
    if params.get("output_vtk", None) is not None:
        cargs.extend([
            "-v",
            params.get("output_vtk", None)
        ])
    return cargs


def trk_tools_outputs(
    params: TrkToolsParamsDict,
    execution: Execution,
) -> TrkToolsOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = TrkToolsOutputs(
        root=execution.output_file("."),
        trk_output_file=execution.output_file(params.get("output_trk", None)) if (params.get("output_trk") is not None) else None,
        image_output_file=execution.output_file(params.get("output_image", None)) if (params.get("output_image") is not None) else None,
        vtk_output_file=execution.output_file(params.get("output_vtk", None)) if (params.get("output_vtk") is not None) else None,
    )
    return ret


def trk_tools_execute(
    params: TrkToolsParamsDict,
    runner: Runner | None = None,
) -> TrkToolsOutputs:
    """
    trk_tools
    
    Tool for processing TRK files.
    
    Author: FreeSurfer Developers
    
    URL: https://github.com/freesurfer/freesurfer
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `TrkToolsOutputs`).
    """
    trk_tools_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(TRK_TOOLS_METADATA)
    params = execution.params(params)
    cargs = trk_tools_cargs(params, execution)
    ret = trk_tools_outputs(params, execution)
    execution.run(cargs)
    return ret


def trk_tools(
    reference_image: InputPathType,
    input_trk: InputPathType,
    output_trk: str | None = None,
    output_image: str | None = None,
    update_header: bool = False,
    output_vtk: str | None = None,
    runner: Runner | None = None,
) -> TrkToolsOutputs:
    """
    trk_tools
    
    Tool for processing TRK files.
    
    Author: FreeSurfer Developers
    
    URL: https://github.com/freesurfer/freesurfer
    
    Args:
        reference_image: Reference image for TRK processing.
        input_trk: Input TRK file to be processed.
        output_trk: Output TRK file.
        output_image: Export TRK into an image.
        update_header: Update TRK header with reference image.
        output_vtk: Output streamlines in VTK format.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `TrkToolsOutputs`).
    """
    params = trk_tools_params(
        reference_image=reference_image,
        input_trk=input_trk,
        output_trk=output_trk,
        output_image=output_image,
        update_header=update_header,
        output_vtk=output_vtk,
    )
    return trk_tools_execute(params, runner)


__all__ = [
    "TRK_TOOLS_METADATA",
    "TrkToolsOutputs",
    "TrkToolsParamsDict",
    "TrkToolsParamsDictTagged",
    "trk_tools",
    "trk_tools_execute",
    "trk_tools_params",
]
