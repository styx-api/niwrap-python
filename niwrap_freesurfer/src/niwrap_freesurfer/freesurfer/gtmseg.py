# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

GTMSEG_METADATA = Metadata(
    id="905804c42add9b579f3d1f9170baa87421e1e8da.boutiques",
    name="gtmseg",
    package="freesurfer",
    container_image_tag="freesurfer/freesurfer:7.4.1",
)


_GtmsegParamsDictNoTag = typing.TypedDict('_GtmsegParamsDictNoTag', {
    "subject": str,
    "outvol": typing.NotRequired[str | None],
    "usf": typing.NotRequired[float | None],
    "subsegwm": bool,
    "keep_hypo": bool,
    "keep_cc": bool,
    "dmax": typing.NotRequired[float | None],
    "ctx_annot": typing.NotRequired[str | None],
    "wm_annot": typing.NotRequired[str | None],
    "output_usf": typing.NotRequired[float | None],
    "head": typing.NotRequired[str | None],
    "subseg_cbwm": bool,
    "no_pons": bool,
    "no_vermis": bool,
    "ctab": typing.NotRequired[InputPathType | None],
    "no_seg_stats": bool,
    "xcerseg": bool,
    "debug": bool,
})
GtmsegParamsDictTagged = typing.TypedDict('GtmsegParamsDictTagged', {
    "@type": typing.Literal["freesurfer/gtmseg"],
    "subject": str,
    "outvol": typing.NotRequired[str | None],
    "usf": typing.NotRequired[float | None],
    "subsegwm": bool,
    "keep_hypo": bool,
    "keep_cc": bool,
    "dmax": typing.NotRequired[float | None],
    "ctx_annot": typing.NotRequired[str | None],
    "wm_annot": typing.NotRequired[str | None],
    "output_usf": typing.NotRequired[float | None],
    "head": typing.NotRequired[str | None],
    "subseg_cbwm": bool,
    "no_pons": bool,
    "no_vermis": bool,
    "ctab": typing.NotRequired[InputPathType | None],
    "no_seg_stats": bool,
    "xcerseg": bool,
    "debug": bool,
})
GtmsegParamsDict = _GtmsegParamsDictNoTag | GtmsegParamsDictTagged


class GtmsegOutputs(typing.NamedTuple):
    """
    Output object returned when calling `GtmsegParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    output_volume: OutputPathType | None
    """Output segmentation volume"""
    output_ctab: OutputPathType
    """Generated color table for the output segmentation"""


def gtmseg_params(
    subject: str,
    outvol: str | None = None,
    usf: float | None = None,
    subsegwm: bool = False,
    keep_hypo: bool = False,
    keep_cc: bool = False,
    dmax: float | None = None,
    ctx_annot: str | None = None,
    wm_annot: str | None = None,
    output_usf: float | None = None,
    head: str | None = None,
    subseg_cbwm: bool = False,
    no_pons: bool = False,
    no_vermis: bool = False,
    ctab: InputPathType | None = None,
    no_seg_stats: bool = False,
    xcerseg: bool = False,
    debug: bool = False,
) -> GtmsegParamsDictTagged:
    """
    Build parameters.
    
    Args:
        subject: Subject to analyze.
        outvol: Output volume relative to subject/mri.
        usf: Upsampling factor for segmentation resolution.
        subsegwm: Subsegment white matter into lobes.
        keep_hypo: Do not relabel hypointensities as white matter when\
            subsegmenting WM.
        keep_cc: Do not relabel corpus callosum as white matter.
        dmax: Distance threshold for subsegmenting WM.
        ctx_annot: Annotation for cortical segmentation.
        wm_annot: Annotation for WM segmentation with --subsegwm.
        output_usf: Set output upsampling factor different from input USF for\
            debugging.
        head: Use alternative head segmentation file.
        subseg_cbwm: Subsegment cerebellum WM into core and gyri.
        no_pons: Do not add pons segmentation when running xcerebralseg.
        no_vermis: Do not add vermis segmentation when running xcerebralseg.
        ctab: Color table for custom segmentation.
        no_seg_stats: Do not compute segmentation statistics.
        xcerseg: Run xcerebralseg to create apas+head.mgz.
        debug: Enable debugging mode.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "freesurfer/gtmseg",
        "subject": subject,
        "subsegwm": subsegwm,
        "keep_hypo": keep_hypo,
        "keep_cc": keep_cc,
        "subseg_cbwm": subseg_cbwm,
        "no_pons": no_pons,
        "no_vermis": no_vermis,
        "no_seg_stats": no_seg_stats,
        "xcerseg": xcerseg,
        "debug": debug,
    }
    if outvol is not None:
        params["outvol"] = outvol
    if usf is not None:
        params["usf"] = usf
    if dmax is not None:
        params["dmax"] = dmax
    if ctx_annot is not None:
        params["ctx_annot"] = ctx_annot
    if wm_annot is not None:
        params["wm_annot"] = wm_annot
    if output_usf is not None:
        params["output_usf"] = output_usf
    if head is not None:
        params["head"] = head
    if ctab is not None:
        params["ctab"] = ctab
    return params


def gtmseg_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `GtmsegParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("subject", None) is None:
        raise StyxValidationError("`subject` must not be None")
    if not isinstance(params["subject"], str):
        raise StyxValidationError(f'`subject` has the wrong type: Received `{type(params.get("subject", None))}` expected `str`')
    if params.get("outvol", None) is not None:
        if not isinstance(params["outvol"], str):
            raise StyxValidationError(f'`outvol` has the wrong type: Received `{type(params.get("outvol", None))}` expected `str | None`')
    if params.get("usf", None) is not None:
        if not isinstance(params["usf"], (float, int)):
            raise StyxValidationError(f'`usf` has the wrong type: Received `{type(params.get("usf", None))}` expected `float | None`')
    if params.get("subsegwm", False) is None:
        raise StyxValidationError("`subsegwm` must not be None")
    if not isinstance(params["subsegwm"], bool):
        raise StyxValidationError(f'`subsegwm` has the wrong type: Received `{type(params.get("subsegwm", False))}` expected `bool`')
    if params.get("keep_hypo", False) is None:
        raise StyxValidationError("`keep_hypo` must not be None")
    if not isinstance(params["keep_hypo"], bool):
        raise StyxValidationError(f'`keep_hypo` has the wrong type: Received `{type(params.get("keep_hypo", False))}` expected `bool`')
    if params.get("keep_cc", False) is None:
        raise StyxValidationError("`keep_cc` must not be None")
    if not isinstance(params["keep_cc"], bool):
        raise StyxValidationError(f'`keep_cc` has the wrong type: Received `{type(params.get("keep_cc", False))}` expected `bool`')
    if params.get("dmax", None) is not None:
        if not isinstance(params["dmax"], (float, int)):
            raise StyxValidationError(f'`dmax` has the wrong type: Received `{type(params.get("dmax", None))}` expected `float | None`')
    if params.get("ctx_annot", None) is not None:
        if not isinstance(params["ctx_annot"], str):
            raise StyxValidationError(f'`ctx_annot` has the wrong type: Received `{type(params.get("ctx_annot", None))}` expected `str | None`')
    if params.get("wm_annot", None) is not None:
        if not isinstance(params["wm_annot"], str):
            raise StyxValidationError(f'`wm_annot` has the wrong type: Received `{type(params.get("wm_annot", None))}` expected `str | None`')
    if params.get("output_usf", None) is not None:
        if not isinstance(params["output_usf"], (float, int)):
            raise StyxValidationError(f'`output_usf` has the wrong type: Received `{type(params.get("output_usf", None))}` expected `float | None`')
    if params.get("head", None) is not None:
        if not isinstance(params["head"], str):
            raise StyxValidationError(f'`head` has the wrong type: Received `{type(params.get("head", None))}` expected `str | None`')
    if params.get("subseg_cbwm", False) is None:
        raise StyxValidationError("`subseg_cbwm` must not be None")
    if not isinstance(params["subseg_cbwm"], bool):
        raise StyxValidationError(f'`subseg_cbwm` has the wrong type: Received `{type(params.get("subseg_cbwm", False))}` expected `bool`')
    if params.get("no_pons", False) is None:
        raise StyxValidationError("`no_pons` must not be None")
    if not isinstance(params["no_pons"], bool):
        raise StyxValidationError(f'`no_pons` has the wrong type: Received `{type(params.get("no_pons", False))}` expected `bool`')
    if params.get("no_vermis", False) is None:
        raise StyxValidationError("`no_vermis` must not be None")
    if not isinstance(params["no_vermis"], bool):
        raise StyxValidationError(f'`no_vermis` has the wrong type: Received `{type(params.get("no_vermis", False))}` expected `bool`')
    if params.get("ctab", None) is not None:
        if not isinstance(params["ctab"], (pathlib.Path, str)):
            raise StyxValidationError(f'`ctab` has the wrong type: Received `{type(params.get("ctab", None))}` expected `InputPathType | None`')
    if params.get("no_seg_stats", False) is None:
        raise StyxValidationError("`no_seg_stats` must not be None")
    if not isinstance(params["no_seg_stats"], bool):
        raise StyxValidationError(f'`no_seg_stats` has the wrong type: Received `{type(params.get("no_seg_stats", False))}` expected `bool`')
    if params.get("xcerseg", False) is None:
        raise StyxValidationError("`xcerseg` must not be None")
    if not isinstance(params["xcerseg"], bool):
        raise StyxValidationError(f'`xcerseg` has the wrong type: Received `{type(params.get("xcerseg", False))}` expected `bool`')
    if params.get("debug", False) is None:
        raise StyxValidationError("`debug` must not be None")
    if not isinstance(params["debug"], bool):
        raise StyxValidationError(f'`debug` has the wrong type: Received `{type(params.get("debug", False))}` expected `bool`')


def gtmseg_cargs(
    params: GtmsegParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("gtmseg")
    cargs.extend([
        "--s",
        params.get("subject", None)
    ])
    if params.get("outvol", None) is not None:
        cargs.extend([
            "--o",
            params.get("outvol", None)
        ])
    if params.get("usf", None) is not None:
        cargs.extend([
            "--usf",
            str(params.get("usf", None))
        ])
    if params.get("subsegwm", False):
        cargs.append("--subsegwm")
    if params.get("keep_hypo", False):
        cargs.append("--keep-hypo")
    if params.get("keep_cc", False):
        cargs.append("--keep-cc")
    if params.get("dmax", None) is not None:
        cargs.extend([
            "--dmax",
            str(params.get("dmax", None))
        ])
    if params.get("ctx_annot", None) is not None:
        cargs.extend([
            "--ctx-annot",
            params.get("ctx_annot", None)
        ])
    if params.get("wm_annot", None) is not None:
        cargs.extend([
            "--wm-annot",
            params.get("wm_annot", None)
        ])
    if params.get("output_usf", None) is not None:
        cargs.extend([
            "--output-usf",
            str(params.get("output_usf", None))
        ])
    if params.get("head", None) is not None:
        cargs.extend([
            "--head",
            params.get("head", None)
        ])
    if params.get("subseg_cbwm", False):
        cargs.append("--subseg-cblum-wm")
    if params.get("no_pons", False):
        cargs.append("--no-pons")
    if params.get("no_vermis", False):
        cargs.append("--no-vermis")
    if params.get("ctab", None) is not None:
        cargs.extend([
            "--ctab",
            execution.input_file(params.get("ctab", None))
        ])
    if params.get("no_seg_stats", False):
        cargs.append("--no-seg-stats")
    if params.get("xcerseg", False):
        cargs.append("--xcerseg")
    if params.get("debug", False):
        cargs.append("--debug")
    return cargs


def gtmseg_outputs(
    params: GtmsegParamsDict,
    execution: Execution,
) -> GtmsegOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = GtmsegOutputs(
        root=execution.output_file("."),
        output_volume=execution.output_file("$SUBJECTS_DIR/" + params.get("subject", None) + "/mri/" + params.get("outvol", None)) if (params.get("outvol") is not None) else None,
        output_ctab=execution.output_file("$SUBJECTS_DIR/" + params.get("subject", None) + "/mri/gtmseg+myseg.ctab"),
    )
    return ret


def gtmseg_execute(
    params: GtmsegParamsDict,
    runner: Runner | None = None,
) -> GtmsegOutputs:
    """
    gtmseg
    
    Creates an anatomical segmentation for the geometric transfer matrix (GTM)
    used in PET partial volume correction.
    
    Author: FreeSurfer Developers
    
    URL: https://github.com/freesurfer/freesurfer
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `GtmsegOutputs`).
    """
    gtmseg_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(GTMSEG_METADATA)
    params = execution.params(params)
    cargs = gtmseg_cargs(params, execution)
    ret = gtmseg_outputs(params, execution)
    execution.run(cargs)
    return ret


def gtmseg(
    subject: str,
    outvol: str | None = None,
    usf: float | None = None,
    subsegwm: bool = False,
    keep_hypo: bool = False,
    keep_cc: bool = False,
    dmax: float | None = None,
    ctx_annot: str | None = None,
    wm_annot: str | None = None,
    output_usf: float | None = None,
    head: str | None = None,
    subseg_cbwm: bool = False,
    no_pons: bool = False,
    no_vermis: bool = False,
    ctab: InputPathType | None = None,
    no_seg_stats: bool = False,
    xcerseg: bool = False,
    debug: bool = False,
    runner: Runner | None = None,
) -> GtmsegOutputs:
    """
    gtmseg
    
    Creates an anatomical segmentation for the geometric transfer matrix (GTM)
    used in PET partial volume correction.
    
    Author: FreeSurfer Developers
    
    URL: https://github.com/freesurfer/freesurfer
    
    Args:
        subject: Subject to analyze.
        outvol: Output volume relative to subject/mri.
        usf: Upsampling factor for segmentation resolution.
        subsegwm: Subsegment white matter into lobes.
        keep_hypo: Do not relabel hypointensities as white matter when\
            subsegmenting WM.
        keep_cc: Do not relabel corpus callosum as white matter.
        dmax: Distance threshold for subsegmenting WM.
        ctx_annot: Annotation for cortical segmentation.
        wm_annot: Annotation for WM segmentation with --subsegwm.
        output_usf: Set output upsampling factor different from input USF for\
            debugging.
        head: Use alternative head segmentation file.
        subseg_cbwm: Subsegment cerebellum WM into core and gyri.
        no_pons: Do not add pons segmentation when running xcerebralseg.
        no_vermis: Do not add vermis segmentation when running xcerebralseg.
        ctab: Color table for custom segmentation.
        no_seg_stats: Do not compute segmentation statistics.
        xcerseg: Run xcerebralseg to create apas+head.mgz.
        debug: Enable debugging mode.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `GtmsegOutputs`).
    """
    params = gtmseg_params(
        subject=subject,
        outvol=outvol,
        usf=usf,
        subsegwm=subsegwm,
        keep_hypo=keep_hypo,
        keep_cc=keep_cc,
        dmax=dmax,
        ctx_annot=ctx_annot,
        wm_annot=wm_annot,
        output_usf=output_usf,
        head=head,
        subseg_cbwm=subseg_cbwm,
        no_pons=no_pons,
        no_vermis=no_vermis,
        ctab=ctab,
        no_seg_stats=no_seg_stats,
        xcerseg=xcerseg,
        debug=debug,
    )
    return gtmseg_execute(params, runner)


__all__ = [
    "GTMSEG_METADATA",
    "GtmsegOutputs",
    "GtmsegParamsDict",
    "GtmsegParamsDictTagged",
    "gtmseg",
    "gtmseg_execute",
    "gtmseg_params",
]
