# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

MRI_AVERAGE_METADATA = Metadata(
    id="b3f32f14636c8ffec10c09466e6ffcd8ac3e9675.boutiques",
    name="mri_average",
    package="freesurfer",
    container_image_tag="freesurfer/freesurfer:7.4.1",
)


_MriAverageParamsDictNoTag = typing.TypedDict('_MriAverageParamsDictNoTag', {
    "input_volumes": list[InputPathType],
    "output_volume": str,
    "rigid_alignment": bool,
    "read_from_file": bool,
    "dt": typing.NotRequired[float | None],
    "tol": typing.NotRequired[float | None],
    "conform": bool,
    "noconform": bool,
    "reduce": typing.NotRequired[float | None],
    "sinc_interpolation": typing.NotRequired[float | None],
    "trilinear": bool,
    "window": bool,
    "snapshots": typing.NotRequired[float | None],
    "translation": typing.NotRequired[list[float] | None],
    "rotation": typing.NotRequired[list[float] | None],
    "momentum": typing.NotRequired[float | None],
    "rms": bool,
    "rms_alt": bool,
    "percent": bool,
    "binarize": typing.NotRequired[float | None],
    "absolute": bool,
})
MriAverageParamsDictTagged = typing.TypedDict('MriAverageParamsDictTagged', {
    "@type": typing.Literal["freesurfer/mri_average"],
    "input_volumes": list[InputPathType],
    "output_volume": str,
    "rigid_alignment": bool,
    "read_from_file": bool,
    "dt": typing.NotRequired[float | None],
    "tol": typing.NotRequired[float | None],
    "conform": bool,
    "noconform": bool,
    "reduce": typing.NotRequired[float | None],
    "sinc_interpolation": typing.NotRequired[float | None],
    "trilinear": bool,
    "window": bool,
    "snapshots": typing.NotRequired[float | None],
    "translation": typing.NotRequired[list[float] | None],
    "rotation": typing.NotRequired[list[float] | None],
    "momentum": typing.NotRequired[float | None],
    "rms": bool,
    "rms_alt": bool,
    "percent": bool,
    "binarize": typing.NotRequired[float | None],
    "absolute": bool,
})
MriAverageParamsDict = _MriAverageParamsDictNoTag | MriAverageParamsDictTagged


class MriAverageOutputs(typing.NamedTuple):
    """
    Output object returned when calling `MriAverageParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    output_file: OutputPathType
    """The averaged output volume."""


def mri_average_params(
    input_volumes: list[InputPathType],
    output_volume: str,
    rigid_alignment: bool = False,
    read_from_file: bool = False,
    dt: float | None = None,
    tol: float | None = None,
    conform: bool = False,
    noconform: bool = False,
    reduce: float | None = None,
    sinc_interpolation: float | None = None,
    trilinear: bool = False,
    window: bool = False,
    snapshots: float | None = None,
    translation: list[float] | None = None,
    rotation: list[float] | None = None,
    momentum: float | None = None,
    rms: bool = False,
    rms_alt: bool = False,
    percent: bool = False,
    binarize: float | None = None,
    absolute: bool = False,
) -> MriAverageParamsDictTagged:
    """
    Build parameters.
    
    Args:
        input_volumes: Input volumes to average.
        output_volume: Output volume file.
        rigid_alignment: Rigid alignment of input volumes before averaging.
        read_from_file: Read volumes from an input file (first argument is the\
            input filename).
        dt: Set dt to n (default=1e-6).
        tol: Set tolerance to n (default=1e-5).
        conform: Interpolate volume to be isotropic 1mm^3 (on by default).
        noconform: Inhibit isotropic volume interpolation.
        reduce: Reduce input images n (default=2) times.
        sinc_interpolation: Using sinc interpolation with window width of 2*n\
            (default=3).
        trilinear: Use trilinear interpolation.
        window: Apply hanning window to volumes.
        snapshots: Write snapshots every n iterations.
        translation: Translation of second volume.
        rotation: Rotation of second volume around each axis in degrees.
        momentum: Use momentum n (default=0).
        rms: Compute sqrt of average of sum of squares (RMS, same as -rms).
        rms_alt: Compute sqrt of average of sum of squares (RMS, same as -sqr).
        percent: Compute percentage.
        binarize: Binarize the input volumes using threshold th.
        absolute: Take absolute value of volume.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "freesurfer/mri_average",
        "input_volumes": input_volumes,
        "output_volume": output_volume,
        "rigid_alignment": rigid_alignment,
        "read_from_file": read_from_file,
        "conform": conform,
        "noconform": noconform,
        "trilinear": trilinear,
        "window": window,
        "rms": rms,
        "rms_alt": rms_alt,
        "percent": percent,
        "absolute": absolute,
    }
    if dt is not None:
        params["dt"] = dt
    if tol is not None:
        params["tol"] = tol
    if reduce is not None:
        params["reduce"] = reduce
    if sinc_interpolation is not None:
        params["sinc_interpolation"] = sinc_interpolation
    if snapshots is not None:
        params["snapshots"] = snapshots
    if translation is not None:
        params["translation"] = translation
    if rotation is not None:
        params["rotation"] = rotation
    if momentum is not None:
        params["momentum"] = momentum
    if binarize is not None:
        params["binarize"] = binarize
    return params


def mri_average_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `MriAverageParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("input_volumes", None) is None:
        raise StyxValidationError("`input_volumes` must not be None")
    if not isinstance(params["input_volumes"], list):
        raise StyxValidationError(f'`input_volumes` has the wrong type: Received `{type(params.get("input_volumes", None))}` expected `list[InputPathType]`')
    for e in params["input_volumes"]:
        if not isinstance(e, (pathlib.Path, str)):
            raise StyxValidationError(f'`input_volumes` has the wrong type: Received `{type(params.get("input_volumes", None))}` expected `list[InputPathType]`')
    if params.get("output_volume", None) is None:
        raise StyxValidationError("`output_volume` must not be None")
    if not isinstance(params["output_volume"], str):
        raise StyxValidationError(f'`output_volume` has the wrong type: Received `{type(params.get("output_volume", None))}` expected `str`')
    if params.get("rigid_alignment", False) is None:
        raise StyxValidationError("`rigid_alignment` must not be None")
    if not isinstance(params["rigid_alignment"], bool):
        raise StyxValidationError(f'`rigid_alignment` has the wrong type: Received `{type(params.get("rigid_alignment", False))}` expected `bool`')
    if params.get("read_from_file", False) is None:
        raise StyxValidationError("`read_from_file` must not be None")
    if not isinstance(params["read_from_file"], bool):
        raise StyxValidationError(f'`read_from_file` has the wrong type: Received `{type(params.get("read_from_file", False))}` expected `bool`')
    if params.get("dt", None) is not None:
        if not isinstance(params["dt"], (float, int)):
            raise StyxValidationError(f'`dt` has the wrong type: Received `{type(params.get("dt", None))}` expected `float | None`')
    if params.get("tol", None) is not None:
        if not isinstance(params["tol"], (float, int)):
            raise StyxValidationError(f'`tol` has the wrong type: Received `{type(params.get("tol", None))}` expected `float | None`')
    if params.get("conform", False) is None:
        raise StyxValidationError("`conform` must not be None")
    if not isinstance(params["conform"], bool):
        raise StyxValidationError(f'`conform` has the wrong type: Received `{type(params.get("conform", False))}` expected `bool`')
    if params.get("noconform", False) is None:
        raise StyxValidationError("`noconform` must not be None")
    if not isinstance(params["noconform"], bool):
        raise StyxValidationError(f'`noconform` has the wrong type: Received `{type(params.get("noconform", False))}` expected `bool`')
    if params.get("reduce", None) is not None:
        if not isinstance(params["reduce"], (float, int)):
            raise StyxValidationError(f'`reduce` has the wrong type: Received `{type(params.get("reduce", None))}` expected `float | None`')
    if params.get("sinc_interpolation", None) is not None:
        if not isinstance(params["sinc_interpolation"], (float, int)):
            raise StyxValidationError(f'`sinc_interpolation` has the wrong type: Received `{type(params.get("sinc_interpolation", None))}` expected `float | None`')
    if params.get("trilinear", False) is None:
        raise StyxValidationError("`trilinear` must not be None")
    if not isinstance(params["trilinear"], bool):
        raise StyxValidationError(f'`trilinear` has the wrong type: Received `{type(params.get("trilinear", False))}` expected `bool`')
    if params.get("window", False) is None:
        raise StyxValidationError("`window` must not be None")
    if not isinstance(params["window"], bool):
        raise StyxValidationError(f'`window` has the wrong type: Received `{type(params.get("window", False))}` expected `bool`')
    if params.get("snapshots", None) is not None:
        if not isinstance(params["snapshots"], (float, int)):
            raise StyxValidationError(f'`snapshots` has the wrong type: Received `{type(params.get("snapshots", None))}` expected `float | None`')
    if params.get("translation", None) is not None:
        if not isinstance(params["translation"], list):
            raise StyxValidationError(f'`translation` has the wrong type: Received `{type(params.get("translation", None))}` expected `list[float] | None`')
        if len(params["translation"]) != 3:
            raise StyxValidationError("Parameter `translation` must contain exactly 3 elements")
        for e in params["translation"]:
            if not isinstance(e, (float, int)):
                raise StyxValidationError(f'`translation` has the wrong type: Received `{type(params.get("translation", None))}` expected `list[float] | None`')
    if params.get("rotation", None) is not None:
        if not isinstance(params["rotation"], list):
            raise StyxValidationError(f'`rotation` has the wrong type: Received `{type(params.get("rotation", None))}` expected `list[float] | None`')
        if len(params["rotation"]) != 3:
            raise StyxValidationError("Parameter `rotation` must contain exactly 3 elements")
        for e in params["rotation"]:
            if not isinstance(e, (float, int)):
                raise StyxValidationError(f'`rotation` has the wrong type: Received `{type(params.get("rotation", None))}` expected `list[float] | None`')
    if params.get("momentum", None) is not None:
        if not isinstance(params["momentum"], (float, int)):
            raise StyxValidationError(f'`momentum` has the wrong type: Received `{type(params.get("momentum", None))}` expected `float | None`')
    if params.get("rms", False) is None:
        raise StyxValidationError("`rms` must not be None")
    if not isinstance(params["rms"], bool):
        raise StyxValidationError(f'`rms` has the wrong type: Received `{type(params.get("rms", False))}` expected `bool`')
    if params.get("rms_alt", False) is None:
        raise StyxValidationError("`rms_alt` must not be None")
    if not isinstance(params["rms_alt"], bool):
        raise StyxValidationError(f'`rms_alt` has the wrong type: Received `{type(params.get("rms_alt", False))}` expected `bool`')
    if params.get("percent", False) is None:
        raise StyxValidationError("`percent` must not be None")
    if not isinstance(params["percent"], bool):
        raise StyxValidationError(f'`percent` has the wrong type: Received `{type(params.get("percent", False))}` expected `bool`')
    if params.get("binarize", None) is not None:
        if not isinstance(params["binarize"], (float, int)):
            raise StyxValidationError(f'`binarize` has the wrong type: Received `{type(params.get("binarize", None))}` expected `float | None`')
    if params.get("absolute", False) is None:
        raise StyxValidationError("`absolute` must not be None")
    if not isinstance(params["absolute"], bool):
        raise StyxValidationError(f'`absolute` has the wrong type: Received `{type(params.get("absolute", False))}` expected `bool`')


def mri_average_cargs(
    params: MriAverageParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("mri_average")
    cargs.extend([execution.input_file(f) for f in params.get("input_volumes", None)])
    cargs.append(params.get("output_volume", None))
    if params.get("rigid_alignment", False):
        cargs.append("-a")
    if params.get("read_from_file", False):
        cargs.append("-F")
    if params.get("dt", None) is not None:
        cargs.extend([
            "-dt",
            str(params.get("dt", None))
        ])
    if params.get("tol", None) is not None:
        cargs.extend([
            "-tol",
            str(params.get("tol", None))
        ])
    if params.get("conform", False):
        cargs.append("-conform")
    if params.get("noconform", False):
        cargs.append("-noconform")
    if params.get("reduce", None) is not None:
        cargs.extend([
            "-reduce",
            str(params.get("reduce", None))
        ])
    if params.get("sinc_interpolation", None) is not None:
        cargs.extend([
            "-sinc",
            str(params.get("sinc_interpolation", None))
        ])
    if params.get("trilinear", False):
        cargs.append("-trilinear")
    if params.get("window", False):
        cargs.append("-window")
    if params.get("snapshots", None) is not None:
        cargs.extend([
            "-w",
            str(params.get("snapshots", None))
        ])
    if params.get("translation", None) is not None:
        cargs.extend([
            "-t",
            *map(str, params.get("translation", None))
        ])
    if params.get("rotation", None) is not None:
        cargs.extend([
            "-r",
            *map(str, params.get("rotation", None))
        ])
    if params.get("momentum", None) is not None:
        cargs.extend([
            "-m",
            str(params.get("momentum", None))
        ])
    if params.get("rms", False):
        cargs.append("-sqr")
    if params.get("rms_alt", False):
        cargs.append("-rms")
    if params.get("percent", False):
        cargs.append("-p")
    if params.get("binarize", None) is not None:
        cargs.extend([
            "-b",
            str(params.get("binarize", None))
        ])
    if params.get("absolute", False):
        cargs.append("-abs")
    return cargs


def mri_average_outputs(
    params: MriAverageParamsDict,
    execution: Execution,
) -> MriAverageOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = MriAverageOutputs(
        root=execution.output_file("."),
        output_file=execution.output_file(params.get("output_volume", None)),
    )
    return ret


def mri_average_execute(
    params: MriAverageParamsDict,
    runner: Runner | None = None,
) -> MriAverageOutputs:
    """
    mri_average
    
    Averages multiple volumes with various options for alignment, interpolation,
    and transformations.
    
    Author: FreeSurfer Developers
    
    URL: https://github.com/freesurfer/freesurfer
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `MriAverageOutputs`).
    """
    mri_average_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(MRI_AVERAGE_METADATA)
    params = execution.params(params)
    cargs = mri_average_cargs(params, execution)
    ret = mri_average_outputs(params, execution)
    execution.run(cargs)
    return ret


def mri_average(
    input_volumes: list[InputPathType],
    output_volume: str,
    rigid_alignment: bool = False,
    read_from_file: bool = False,
    dt: float | None = None,
    tol: float | None = None,
    conform: bool = False,
    noconform: bool = False,
    reduce: float | None = None,
    sinc_interpolation: float | None = None,
    trilinear: bool = False,
    window: bool = False,
    snapshots: float | None = None,
    translation: list[float] | None = None,
    rotation: list[float] | None = None,
    momentum: float | None = None,
    rms: bool = False,
    rms_alt: bool = False,
    percent: bool = False,
    binarize: float | None = None,
    absolute: bool = False,
    runner: Runner | None = None,
) -> MriAverageOutputs:
    """
    mri_average
    
    Averages multiple volumes with various options for alignment, interpolation,
    and transformations.
    
    Author: FreeSurfer Developers
    
    URL: https://github.com/freesurfer/freesurfer
    
    Args:
        input_volumes: Input volumes to average.
        output_volume: Output volume file.
        rigid_alignment: Rigid alignment of input volumes before averaging.
        read_from_file: Read volumes from an input file (first argument is the\
            input filename).
        dt: Set dt to n (default=1e-6).
        tol: Set tolerance to n (default=1e-5).
        conform: Interpolate volume to be isotropic 1mm^3 (on by default).
        noconform: Inhibit isotropic volume interpolation.
        reduce: Reduce input images n (default=2) times.
        sinc_interpolation: Using sinc interpolation with window width of 2*n\
            (default=3).
        trilinear: Use trilinear interpolation.
        window: Apply hanning window to volumes.
        snapshots: Write snapshots every n iterations.
        translation: Translation of second volume.
        rotation: Rotation of second volume around each axis in degrees.
        momentum: Use momentum n (default=0).
        rms: Compute sqrt of average of sum of squares (RMS, same as -rms).
        rms_alt: Compute sqrt of average of sum of squares (RMS, same as -sqr).
        percent: Compute percentage.
        binarize: Binarize the input volumes using threshold th.
        absolute: Take absolute value of volume.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `MriAverageOutputs`).
    """
    params = mri_average_params(
        input_volumes=input_volumes,
        output_volume=output_volume,
        rigid_alignment=rigid_alignment,
        read_from_file=read_from_file,
        dt=dt,
        tol=tol,
        conform=conform,
        noconform=noconform,
        reduce=reduce,
        sinc_interpolation=sinc_interpolation,
        trilinear=trilinear,
        window=window,
        snapshots=snapshots,
        translation=translation,
        rotation=rotation,
        momentum=momentum,
        rms=rms,
        rms_alt=rms_alt,
        percent=percent,
        binarize=binarize,
        absolute=absolute,
    )
    return mri_average_execute(params, runner)


__all__ = [
    "MRI_AVERAGE_METADATA",
    "MriAverageOutputs",
    "MriAverageParamsDict",
    "MriAverageParamsDictTagged",
    "mri_average",
    "mri_average_execute",
    "mri_average_params",
]
