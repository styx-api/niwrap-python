# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

FSPALM_METADATA = Metadata(
    id="cf8e3d88104ed079f77f6b32ec9e15dfe608166a.boutiques",
    name="fspalm",
    package="freesurfer",
    container_image_tag="freesurfer/freesurfer:7.4.1",
)


_FspalmParamsDictNoTag = typing.TypedDict('_FspalmParamsDictNoTag', {
    "glmdir": str,
    "cft": float,
    "cwp": float,
    "onetail": bool,
    "twotail": bool,
    "name": typing.NotRequired[str | None],
    "iters": typing.NotRequired[float | None],
    "monly": bool,
    "pponly": bool,
    "octave": bool,
    "centroid": bool,
    "2spaces": bool,
    "3spaces": bool,
    "pargs": typing.NotRequired[str | None],
})
FspalmParamsDictTagged = typing.TypedDict('FspalmParamsDictTagged', {
    "@type": typing.Literal["freesurfer/fspalm"],
    "glmdir": str,
    "cft": float,
    "cwp": float,
    "onetail": bool,
    "twotail": bool,
    "name": typing.NotRequired[str | None],
    "iters": typing.NotRequired[float | None],
    "monly": bool,
    "pponly": bool,
    "octave": bool,
    "centroid": bool,
    "2spaces": bool,
    "3spaces": bool,
    "pargs": typing.NotRequired[str | None],
})
FspalmParamsDict = _FspalmParamsDictNoTag | FspalmParamsDictTagged


class FspalmOutputs(typing.NamedTuple):
    """
    Output object returned when calling `FspalmParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""


def fspalm_params(
    glmdir: str,
    cft: float,
    cwp: float,
    onetail: bool = False,
    twotail: bool = False,
    name: str | None = None,
    iters: float | None = None,
    monly: bool = False,
    pponly: bool = False,
    octave: bool = False,
    centroid: bool = False,
    v_2spaces: bool = False,
    v_3spaces: bool = False,
    pargs: str | None = None,
) -> FspalmParamsDictTagged:
    """
    Build parameters.
    
    Args:
        glmdir: The mri_glmfit directory to prepare.
        cft: Voxel-wise cluster forming threshold (CFT), -log10(p).
        cwp: Clusterwise p-value threshold.
        onetail: Perform a one-tailed test.
        twotail: Perform a two-tailed test. NOTE: changes CFT.
        name: Name of palm subdirectory (default="palm").
        iters: Number of iterations.
        monly: Only create matlab file, do not run.
        pponly: Only perform post-processing.
        octave: Run with octave, not matlab.
        centroid: Add --centroid flag to mri_surfcluster post-processing.
        v_2spaces: Bonferroni-correct for 2 spaces.
        v_3spaces: Bonferroni-correct for 3 spaces.
        pargs: Supply additional args to be passed to the palm function.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "freesurfer/fspalm",
        "glmdir": glmdir,
        "cft": cft,
        "cwp": cwp,
        "onetail": onetail,
        "twotail": twotail,
        "monly": monly,
        "pponly": pponly,
        "octave": octave,
        "centroid": centroid,
        "2spaces": v_2spaces,
        "3spaces": v_3spaces,
    }
    if name is not None:
        params["name"] = name
    if iters is not None:
        params["iters"] = iters
    if pargs is not None:
        params["pargs"] = pargs
    return params


def fspalm_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `FspalmParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("glmdir", None) is None:
        raise StyxValidationError("`glmdir` must not be None")
    if not isinstance(params["glmdir"], str):
        raise StyxValidationError(f'`glmdir` has the wrong type: Received `{type(params.get("glmdir", None))}` expected `str`')
    if params.get("cft", None) is None:
        raise StyxValidationError("`cft` must not be None")
    if not isinstance(params["cft"], (float, int)):
        raise StyxValidationError(f'`cft` has the wrong type: Received `{type(params.get("cft", None))}` expected `float`')
    if params.get("cwp", None) is None:
        raise StyxValidationError("`cwp` must not be None")
    if not isinstance(params["cwp"], (float, int)):
        raise StyxValidationError(f'`cwp` has the wrong type: Received `{type(params.get("cwp", None))}` expected `float`')
    if params.get("onetail", False) is None:
        raise StyxValidationError("`onetail` must not be None")
    if not isinstance(params["onetail"], bool):
        raise StyxValidationError(f'`onetail` has the wrong type: Received `{type(params.get("onetail", False))}` expected `bool`')
    if params.get("twotail", False) is None:
        raise StyxValidationError("`twotail` must not be None")
    if not isinstance(params["twotail"], bool):
        raise StyxValidationError(f'`twotail` has the wrong type: Received `{type(params.get("twotail", False))}` expected `bool`')
    if params.get("name", None) is not None:
        if not isinstance(params["name"], str):
            raise StyxValidationError(f'`name` has the wrong type: Received `{type(params.get("name", None))}` expected `str | None`')
    if params.get("iters", None) is not None:
        if not isinstance(params["iters"], (float, int)):
            raise StyxValidationError(f'`iters` has the wrong type: Received `{type(params.get("iters", None))}` expected `float | None`')
    if params.get("monly", False) is None:
        raise StyxValidationError("`monly` must not be None")
    if not isinstance(params["monly"], bool):
        raise StyxValidationError(f'`monly` has the wrong type: Received `{type(params.get("monly", False))}` expected `bool`')
    if params.get("pponly", False) is None:
        raise StyxValidationError("`pponly` must not be None")
    if not isinstance(params["pponly"], bool):
        raise StyxValidationError(f'`pponly` has the wrong type: Received `{type(params.get("pponly", False))}` expected `bool`')
    if params.get("octave", False) is None:
        raise StyxValidationError("`octave` must not be None")
    if not isinstance(params["octave"], bool):
        raise StyxValidationError(f'`octave` has the wrong type: Received `{type(params.get("octave", False))}` expected `bool`')
    if params.get("centroid", False) is None:
        raise StyxValidationError("`centroid` must not be None")
    if not isinstance(params["centroid"], bool):
        raise StyxValidationError(f'`centroid` has the wrong type: Received `{type(params.get("centroid", False))}` expected `bool`')
    if params.get("2spaces", False) is None:
        raise StyxValidationError("`2spaces` must not be None")
    if not isinstance(params["2spaces"], bool):
        raise StyxValidationError(f'`2spaces` has the wrong type: Received `{type(params.get("2spaces", False))}` expected `bool`')
    if params.get("3spaces", False) is None:
        raise StyxValidationError("`3spaces` must not be None")
    if not isinstance(params["3spaces"], bool):
        raise StyxValidationError(f'`3spaces` has the wrong type: Received `{type(params.get("3spaces", False))}` expected `bool`')
    if params.get("pargs", None) is not None:
        if not isinstance(params["pargs"], str):
            raise StyxValidationError(f'`pargs` has the wrong type: Received `{type(params.get("pargs", None))}` expected `str | None`')


def fspalm_cargs(
    params: FspalmParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("fspalm")
    cargs.extend([
        "--glmdir",
        params.get("glmdir", None)
    ])
    cargs.extend([
        "--cft",
        str(params.get("cft", None))
    ])
    cargs.extend([
        "--cwp",
        str(params.get("cwp", None))
    ])
    if params.get("onetail", False):
        cargs.append("--onetail")
    if params.get("twotail", False):
        cargs.append("--twotail")
    if params.get("name", None) is not None:
        cargs.extend([
            "--name",
            params.get("name", None)
        ])
    if params.get("iters", None) is not None:
        cargs.extend([
            "--iters",
            str(params.get("iters", None))
        ])
    if params.get("monly", False):
        cargs.append("--monly")
    if params.get("pponly", False):
        cargs.append("--pponly")
    if params.get("octave", False):
        cargs.append("--octave")
    if params.get("centroid", False):
        cargs.append("--centroid")
    if params.get("2spaces", False):
        cargs.append("--2spaces")
    if params.get("3spaces", False):
        cargs.append("--3spaces")
    if params.get("pargs", None) is not None:
        cargs.extend([
            "--pargs",
            params.get("pargs", None)
        ])
    return cargs


def fspalm_outputs(
    params: FspalmParamsDict,
    execution: Execution,
) -> FspalmOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = FspalmOutputs(
        root=execution.output_file("."),
    )
    return ret


def fspalm_execute(
    params: FspalmParamsDict,
    runner: Runner | None = None,
) -> FspalmOutputs:
    """
    fspalm
    
    Prepares and analyzes the output of mri_glmfit for Permutation Analysis of
    Linear Models (PALM) to correct for multiple comparisons.
    
    Author: FreeSurfer Developers
    
    URL: https://github.com/freesurfer/freesurfer
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `FspalmOutputs`).
    """
    fspalm_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(FSPALM_METADATA)
    params = execution.params(params)
    cargs = fspalm_cargs(params, execution)
    ret = fspalm_outputs(params, execution)
    execution.run(cargs)
    return ret


def fspalm(
    glmdir: str,
    cft: float,
    cwp: float,
    onetail: bool = False,
    twotail: bool = False,
    name: str | None = None,
    iters: float | None = None,
    monly: bool = False,
    pponly: bool = False,
    octave: bool = False,
    centroid: bool = False,
    v_2spaces: bool = False,
    v_3spaces: bool = False,
    pargs: str | None = None,
    runner: Runner | None = None,
) -> FspalmOutputs:
    """
    fspalm
    
    Prepares and analyzes the output of mri_glmfit for Permutation Analysis of
    Linear Models (PALM) to correct for multiple comparisons.
    
    Author: FreeSurfer Developers
    
    URL: https://github.com/freesurfer/freesurfer
    
    Args:
        glmdir: The mri_glmfit directory to prepare.
        cft: Voxel-wise cluster forming threshold (CFT), -log10(p).
        cwp: Clusterwise p-value threshold.
        onetail: Perform a one-tailed test.
        twotail: Perform a two-tailed test. NOTE: changes CFT.
        name: Name of palm subdirectory (default="palm").
        iters: Number of iterations.
        monly: Only create matlab file, do not run.
        pponly: Only perform post-processing.
        octave: Run with octave, not matlab.
        centroid: Add --centroid flag to mri_surfcluster post-processing.
        v_2spaces: Bonferroni-correct for 2 spaces.
        v_3spaces: Bonferroni-correct for 3 spaces.
        pargs: Supply additional args to be passed to the palm function.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `FspalmOutputs`).
    """
    params = fspalm_params(
        glmdir=glmdir,
        cft=cft,
        cwp=cwp,
        onetail=onetail,
        twotail=twotail,
        name=name,
        iters=iters,
        monly=monly,
        pponly=pponly,
        octave=octave,
        centroid=centroid,
        v_2spaces=v_2spaces,
        v_3spaces=v_3spaces,
        pargs=pargs,
    )
    return fspalm_execute(params, runner)


__all__ = [
    "FSPALM_METADATA",
    "FspalmOutputs",
    "FspalmParamsDict",
    "FspalmParamsDictTagged",
    "fspalm",
    "fspalm_execute",
    "fspalm_params",
]
