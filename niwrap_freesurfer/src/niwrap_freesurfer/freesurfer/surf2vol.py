# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

SURF2VOL_METADATA = Metadata(
    id="2f13e7b99130c1abcbecb98db3d3979f7a4aec03.boutiques",
    name="surf2vol",
    package="freesurfer",
    container_image_tag="freesurfer/freesurfer:7.4.1",
)


_Surf2volParamsDictNoTag = typing.TypedDict('_Surf2volParamsDictNoTag', {
    "fixed_surface": InputPathType,
    "moving_surface": InputPathType,
    "fixed_mri": InputPathType,
    "moving_mri": InputPathType,
    "output_file": typing.NotRequired[str | None],
    "output_field": typing.NotRequired[str | None],
    "output_affine": typing.NotRequired[str | None],
    "output_surf": typing.NotRequired[str | None],
    "output_surf_affine": typing.NotRequired[str | None],
    "output_mesh": typing.NotRequired[str | None],
    "spacing_x": typing.NotRequired[float | None],
    "spacing_y": typing.NotRequired[float | None],
    "spacing_z": typing.NotRequired[float | None],
    "poisson_ratio": typing.NotRequired[float | None],
    "dirty_factor": typing.NotRequired[float | None],
    "debug_output": bool,
    "cache_transform": typing.NotRequired[str | None],
})
Surf2volParamsDictTagged = typing.TypedDict('Surf2volParamsDictTagged', {
    "@type": typing.Literal["freesurfer/surf2vol"],
    "fixed_surface": InputPathType,
    "moving_surface": InputPathType,
    "fixed_mri": InputPathType,
    "moving_mri": InputPathType,
    "output_file": typing.NotRequired[str | None],
    "output_field": typing.NotRequired[str | None],
    "output_affine": typing.NotRequired[str | None],
    "output_surf": typing.NotRequired[str | None],
    "output_surf_affine": typing.NotRequired[str | None],
    "output_mesh": typing.NotRequired[str | None],
    "spacing_x": typing.NotRequired[float | None],
    "spacing_y": typing.NotRequired[float | None],
    "spacing_z": typing.NotRequired[float | None],
    "poisson_ratio": typing.NotRequired[float | None],
    "dirty_factor": typing.NotRequired[float | None],
    "debug_output": bool,
    "cache_transform": typing.NotRequired[str | None],
})
Surf2volParamsDict = _Surf2volParamsDictNoTag | Surf2volParamsDictTagged


class Surf2volOutputs(typing.NamedTuple):
    """
    Output object returned when calling `Surf2volParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    output_file: OutputPathType | None
    """Default output of the deformation process."""
    output_field: OutputPathType | None
    """Field output of the deformation process."""


def surf2vol_params(
    fixed_surface: InputPathType,
    moving_surface: InputPathType,
    fixed_mri: InputPathType,
    moving_mri: InputPathType,
    output_file: str | None = None,
    output_field: str | None = None,
    output_affine: str | None = None,
    output_surf: str | None = None,
    output_surf_affine: str | None = None,
    output_mesh: str | None = None,
    spacing_x: float | None = None,
    spacing_y: float | None = None,
    spacing_z: float | None = None,
    poisson_ratio: float | None = None,
    dirty_factor: float | None = None,
    debug_output: bool = False,
    cache_transform: str | None = None,
) -> Surf2volParamsDictTagged:
    """
    Build parameters.
    
    Args:
        fixed_surface: File path for the main fixed surface.
        moving_surface: File path for the main moving surface.
        fixed_mri: Fixed volume file.
        moving_mri: Moving volume file.
        output_file: Output file for the result, default is out.mgz.
        output_field: Output field file, default is out_field.mgz.
        output_affine: Path for the output affine file.
        output_surf: Root file name for output surfaces which will have indices\
            appended for each surface.
        output_surf_affine: Root file name for output surfaces with affine\
            transformations.
        output_mesh: File path for the output mesh.
        spacing_x: Specifies the x spacing for the deformation grid.
        spacing_y: Specifies the y spacing for the deformation grid.
        spacing_z: Specifies the z spacing for the deformation grid.
        poisson_ratio: Poisson ratio for material properties, default is 0.3.
        dirty_factor: Factor for dirty regions, between 0 and 1.
        debug_output: Enable debug output, writing a morph file at each\
            iteration.
        cache_transform: Path to save transformation cache for reusing in\
            subsequent runs.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "freesurfer/surf2vol",
        "fixed_surface": fixed_surface,
        "moving_surface": moving_surface,
        "fixed_mri": fixed_mri,
        "moving_mri": moving_mri,
        "debug_output": debug_output,
    }
    if output_file is not None:
        params["output_file"] = output_file
    if output_field is not None:
        params["output_field"] = output_field
    if output_affine is not None:
        params["output_affine"] = output_affine
    if output_surf is not None:
        params["output_surf"] = output_surf
    if output_surf_affine is not None:
        params["output_surf_affine"] = output_surf_affine
    if output_mesh is not None:
        params["output_mesh"] = output_mesh
    if spacing_x is not None:
        params["spacing_x"] = spacing_x
    if spacing_y is not None:
        params["spacing_y"] = spacing_y
    if spacing_z is not None:
        params["spacing_z"] = spacing_z
    if poisson_ratio is not None:
        params["poisson_ratio"] = poisson_ratio
    if dirty_factor is not None:
        params["dirty_factor"] = dirty_factor
    if cache_transform is not None:
        params["cache_transform"] = cache_transform
    return params


def surf2vol_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `Surf2volParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("fixed_surface", None) is None:
        raise StyxValidationError("`fixed_surface` must not be None")
    if not isinstance(params["fixed_surface"], (pathlib.Path, str)):
        raise StyxValidationError(f'`fixed_surface` has the wrong type: Received `{type(params.get("fixed_surface", None))}` expected `InputPathType`')
    if params.get("moving_surface", None) is None:
        raise StyxValidationError("`moving_surface` must not be None")
    if not isinstance(params["moving_surface"], (pathlib.Path, str)):
        raise StyxValidationError(f'`moving_surface` has the wrong type: Received `{type(params.get("moving_surface", None))}` expected `InputPathType`')
    if params.get("fixed_mri", None) is None:
        raise StyxValidationError("`fixed_mri` must not be None")
    if not isinstance(params["fixed_mri"], (pathlib.Path, str)):
        raise StyxValidationError(f'`fixed_mri` has the wrong type: Received `{type(params.get("fixed_mri", None))}` expected `InputPathType`')
    if params.get("moving_mri", None) is None:
        raise StyxValidationError("`moving_mri` must not be None")
    if not isinstance(params["moving_mri"], (pathlib.Path, str)):
        raise StyxValidationError(f'`moving_mri` has the wrong type: Received `{type(params.get("moving_mri", None))}` expected `InputPathType`')
    if params.get("output_file", None) is not None:
        if not isinstance(params["output_file"], str):
            raise StyxValidationError(f'`output_file` has the wrong type: Received `{type(params.get("output_file", None))}` expected `str | None`')
    if params.get("output_field", None) is not None:
        if not isinstance(params["output_field"], str):
            raise StyxValidationError(f'`output_field` has the wrong type: Received `{type(params.get("output_field", None))}` expected `str | None`')
    if params.get("output_affine", None) is not None:
        if not isinstance(params["output_affine"], str):
            raise StyxValidationError(f'`output_affine` has the wrong type: Received `{type(params.get("output_affine", None))}` expected `str | None`')
    if params.get("output_surf", None) is not None:
        if not isinstance(params["output_surf"], str):
            raise StyxValidationError(f'`output_surf` has the wrong type: Received `{type(params.get("output_surf", None))}` expected `str | None`')
    if params.get("output_surf_affine", None) is not None:
        if not isinstance(params["output_surf_affine"], str):
            raise StyxValidationError(f'`output_surf_affine` has the wrong type: Received `{type(params.get("output_surf_affine", None))}` expected `str | None`')
    if params.get("output_mesh", None) is not None:
        if not isinstance(params["output_mesh"], str):
            raise StyxValidationError(f'`output_mesh` has the wrong type: Received `{type(params.get("output_mesh", None))}` expected `str | None`')
    if params.get("spacing_x", None) is not None:
        if not isinstance(params["spacing_x"], (float, int)):
            raise StyxValidationError(f'`spacing_x` has the wrong type: Received `{type(params.get("spacing_x", None))}` expected `float | None`')
    if params.get("spacing_y", None) is not None:
        if not isinstance(params["spacing_y"], (float, int)):
            raise StyxValidationError(f'`spacing_y` has the wrong type: Received `{type(params.get("spacing_y", None))}` expected `float | None`')
    if params.get("spacing_z", None) is not None:
        if not isinstance(params["spacing_z"], (float, int)):
            raise StyxValidationError(f'`spacing_z` has the wrong type: Received `{type(params.get("spacing_z", None))}` expected `float | None`')
    if params.get("poisson_ratio", None) is not None:
        if not isinstance(params["poisson_ratio"], (float, int)):
            raise StyxValidationError(f'`poisson_ratio` has the wrong type: Received `{type(params.get("poisson_ratio", None))}` expected `float | None`')
        if params["poisson_ratio"] > 0.5:
            raise StyxValidationError("Parameter `poisson_ratio` must be at most 0.5")
    if params.get("dirty_factor", None) is not None:
        if not isinstance(params["dirty_factor"], (float, int)):
            raise StyxValidationError(f'`dirty_factor` has the wrong type: Received `{type(params.get("dirty_factor", None))}` expected `float | None`')
        if not (0 <= params["dirty_factor"] <= 1):
            raise StyxValidationError("Parameter `dirty_factor` must be between 0 and 1 (inclusive)")
    if params.get("debug_output", False) is None:
        raise StyxValidationError("`debug_output` must not be None")
    if not isinstance(params["debug_output"], bool):
        raise StyxValidationError(f'`debug_output` has the wrong type: Received `{type(params.get("debug_output", False))}` expected `bool`')
    if params.get("cache_transform", None) is not None:
        if not isinstance(params["cache_transform"], str):
            raise StyxValidationError(f'`cache_transform` has the wrong type: Received `{type(params.get("cache_transform", None))}` expected `str | None`')


def surf2vol_cargs(
    params: Surf2volParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("surf2vol")
    cargs.extend([
        "-fixed_surf",
        execution.input_file(params.get("fixed_surface", None))
    ])
    cargs.extend([
        "-moving_surf",
        execution.input_file(params.get("moving_surface", None))
    ])
    cargs.extend([
        "-fixed_mri",
        execution.input_file(params.get("fixed_mri", None))
    ])
    cargs.extend([
        "-moving_mri",
        execution.input_file(params.get("moving_mri", None))
    ])
    if params.get("output_file", None) is not None:
        cargs.extend([
            "-out",
            params.get("output_file", None)
        ])
    if params.get("output_field", None) is not None:
        cargs.extend([
            "-out_field",
            params.get("output_field", None)
        ])
    if params.get("output_affine", None) is not None:
        cargs.extend([
            "-out_affine",
            params.get("output_affine", None)
        ])
    if params.get("output_surf", None) is not None:
        cargs.extend([
            "-out_surf",
            params.get("output_surf", None)
        ])
    if params.get("output_surf_affine", None) is not None:
        cargs.extend([
            "-out_surf_affine",
            params.get("output_surf_affine", None)
        ])
    if params.get("output_mesh", None) is not None:
        cargs.extend([
            "-out_mesh",
            params.get("output_mesh", None)
        ])
    if params.get("spacing_x", None) is not None:
        cargs.extend([
            "-spacing_x",
            str(params.get("spacing_x", None))
        ])
    if params.get("spacing_y", None) is not None:
        cargs.extend([
            "-spacing_y",
            str(params.get("spacing_y", None))
        ])
    if params.get("spacing_z", None) is not None:
        cargs.extend([
            "-spacing_z",
            str(params.get("spacing_z", None))
        ])
    if params.get("poisson_ratio", None) is not None:
        cargs.extend([
            "-poisson",
            str(params.get("poisson_ratio", None))
        ])
    if params.get("dirty_factor", None) is not None:
        cargs.extend([
            "-dirty",
            str(params.get("dirty_factor", None))
        ])
    if params.get("debug_output", False):
        cargs.append("-dbg_output")
    if params.get("cache_transform", None) is not None:
        cargs.extend([
            "-cache_transform",
            params.get("cache_transform", None)
        ])
    return cargs


def surf2vol_outputs(
    params: Surf2volParamsDict,
    execution: Execution,
) -> Surf2volOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = Surf2volOutputs(
        root=execution.output_file("."),
        output_file=execution.output_file(params.get("output_file", None)) if (params.get("output_file") is not None) else None,
        output_field=execution.output_file(params.get("output_field", None)) if (params.get("output_field") is not None) else None,
    )
    return ret


def surf2vol_execute(
    params: Surf2volParamsDict,
    runner: Runner | None = None,
) -> Surf2volOutputs:
    """
    surf2vol
    
    Diffuse surface deformation to volumes using surface and MRI data.
    
    Author: FreeSurfer Developers
    
    URL: https://github.com/freesurfer/freesurfer
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `Surf2volOutputs`).
    """
    surf2vol_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(SURF2VOL_METADATA)
    params = execution.params(params)
    cargs = surf2vol_cargs(params, execution)
    ret = surf2vol_outputs(params, execution)
    execution.run(cargs)
    return ret


def surf2vol(
    fixed_surface: InputPathType,
    moving_surface: InputPathType,
    fixed_mri: InputPathType,
    moving_mri: InputPathType,
    output_file: str | None = None,
    output_field: str | None = None,
    output_affine: str | None = None,
    output_surf: str | None = None,
    output_surf_affine: str | None = None,
    output_mesh: str | None = None,
    spacing_x: float | None = None,
    spacing_y: float | None = None,
    spacing_z: float | None = None,
    poisson_ratio: float | None = None,
    dirty_factor: float | None = None,
    debug_output: bool = False,
    cache_transform: str | None = None,
    runner: Runner | None = None,
) -> Surf2volOutputs:
    """
    surf2vol
    
    Diffuse surface deformation to volumes using surface and MRI data.
    
    Author: FreeSurfer Developers
    
    URL: https://github.com/freesurfer/freesurfer
    
    Args:
        fixed_surface: File path for the main fixed surface.
        moving_surface: File path for the main moving surface.
        fixed_mri: Fixed volume file.
        moving_mri: Moving volume file.
        output_file: Output file for the result, default is out.mgz.
        output_field: Output field file, default is out_field.mgz.
        output_affine: Path for the output affine file.
        output_surf: Root file name for output surfaces which will have indices\
            appended for each surface.
        output_surf_affine: Root file name for output surfaces with affine\
            transformations.
        output_mesh: File path for the output mesh.
        spacing_x: Specifies the x spacing for the deformation grid.
        spacing_y: Specifies the y spacing for the deformation grid.
        spacing_z: Specifies the z spacing for the deformation grid.
        poisson_ratio: Poisson ratio for material properties, default is 0.3.
        dirty_factor: Factor for dirty regions, between 0 and 1.
        debug_output: Enable debug output, writing a morph file at each\
            iteration.
        cache_transform: Path to save transformation cache for reusing in\
            subsequent runs.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `Surf2volOutputs`).
    """
    params = surf2vol_params(
        fixed_surface=fixed_surface,
        moving_surface=moving_surface,
        fixed_mri=fixed_mri,
        moving_mri=moving_mri,
        output_file=output_file,
        output_field=output_field,
        output_affine=output_affine,
        output_surf=output_surf,
        output_surf_affine=output_surf_affine,
        output_mesh=output_mesh,
        spacing_x=spacing_x,
        spacing_y=spacing_y,
        spacing_z=spacing_z,
        poisson_ratio=poisson_ratio,
        dirty_factor=dirty_factor,
        debug_output=debug_output,
        cache_transform=cache_transform,
    )
    return surf2vol_execute(params, runner)


__all__ = [
    "SURF2VOL_METADATA",
    "Surf2volOutputs",
    "Surf2volParamsDict",
    "Surf2volParamsDictTagged",
    "surf2vol",
    "surf2vol_execute",
    "surf2vol_params",
]
