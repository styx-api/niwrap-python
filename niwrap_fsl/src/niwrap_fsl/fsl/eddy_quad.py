# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

EDDY_QUAD_METADATA = Metadata(
    id="aef792b86aa70fd58b9644f561db5910be0cb839.boutiques",
    name="eddy_quad",
    package="fsl",
    container_image_tag="brainlife/fsl:6.0.4-patched2",
)


_EddyQuadParamsDictNoTag = typing.TypedDict('_EddyQuadParamsDictNoTag', {
    "eddyBase": str,
    "eddyIndex": InputPathType,
    "eddyParams": InputPathType,
    "mask": InputPathType,
    "bvals": InputPathType,
    "bvecs": typing.NotRequired[InputPathType | None],
    "output_dir": typing.NotRequired[str | None],
    "field": typing.NotRequired[InputPathType | None],
    "slspec": typing.NotRequired[InputPathType | None],
    "verbose": bool,
})
EddyQuadParamsDictTagged = typing.TypedDict('EddyQuadParamsDictTagged', {
    "@type": typing.Literal["fsl/eddy_quad"],
    "eddyBase": str,
    "eddyIndex": InputPathType,
    "eddyParams": InputPathType,
    "mask": InputPathType,
    "bvals": InputPathType,
    "bvecs": typing.NotRequired[InputPathType | None],
    "output_dir": typing.NotRequired[str | None],
    "field": typing.NotRequired[InputPathType | None],
    "slspec": typing.NotRequired[InputPathType | None],
    "verbose": bool,
})
EddyQuadParamsDict = _EddyQuadParamsDictNoTag | EddyQuadParamsDictTagged


class EddyQuadOutputs(typing.NamedTuple):
    """
    Output object returned when calling `EddyQuadParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    output_dir_qc: OutputPathType | None
    """Quality control data outputs"""


def eddy_quad_params(
    eddy_base: str,
    eddy_index: InputPathType,
    eddy_params: InputPathType,
    mask: InputPathType,
    bvals: InputPathType,
    bvecs: InputPathType | None = None,
    output_dir: str | None = None,
    field: InputPathType | None = None,
    slspec: InputPathType | None = None,
    verbose: bool = False,
) -> EddyQuadParamsDictTagged:
    """
    Build parameters.
    
    Args:
        eddy_base: Basename (including path) specified when running EDDY.
        eddy_index: File containing indices for all volumes into acquisition\
            parameters.
        eddy_params: File containing acquisition parameters.
        mask: Binary mask file.
        bvals: b-values file.
        bvecs: b-vectors file - only used when <eddyBase>.eddy_residuals file\
            is present.
        output_dir: Output directory - default = '<eddyBase>.qc'.
        field: TOPUP estimated field (in Hz).
        slspec: Text file specifying slice/group acquisition.
        verbose: Display debug messages.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "fsl/eddy_quad",
        "eddyBase": eddy_base,
        "eddyIndex": eddy_index,
        "eddyParams": eddy_params,
        "mask": mask,
        "bvals": bvals,
        "verbose": verbose,
    }
    if bvecs is not None:
        params["bvecs"] = bvecs
    if output_dir is not None:
        params["output_dir"] = output_dir
    if field is not None:
        params["field"] = field
    if slspec is not None:
        params["slspec"] = slspec
    return params


def eddy_quad_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `EddyQuadParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("eddyBase", None) is None:
        raise StyxValidationError("`eddyBase` must not be None")
    if not isinstance(params["eddyBase"], str):
        raise StyxValidationError(f'`eddyBase` has the wrong type: Received `{type(params.get("eddyBase", None))}` expected `str`')
    if params.get("eddyIndex", None) is None:
        raise StyxValidationError("`eddyIndex` must not be None")
    if not isinstance(params["eddyIndex"], (pathlib.Path, str)):
        raise StyxValidationError(f'`eddyIndex` has the wrong type: Received `{type(params.get("eddyIndex", None))}` expected `InputPathType`')
    if params.get("eddyParams", None) is None:
        raise StyxValidationError("`eddyParams` must not be None")
    if not isinstance(params["eddyParams"], (pathlib.Path, str)):
        raise StyxValidationError(f'`eddyParams` has the wrong type: Received `{type(params.get("eddyParams", None))}` expected `InputPathType`')
    if params.get("mask", None) is None:
        raise StyxValidationError("`mask` must not be None")
    if not isinstance(params["mask"], (pathlib.Path, str)):
        raise StyxValidationError(f'`mask` has the wrong type: Received `{type(params.get("mask", None))}` expected `InputPathType`')
    if params.get("bvals", None) is None:
        raise StyxValidationError("`bvals` must not be None")
    if not isinstance(params["bvals"], (pathlib.Path, str)):
        raise StyxValidationError(f'`bvals` has the wrong type: Received `{type(params.get("bvals", None))}` expected `InputPathType`')
    if params.get("bvecs", None) is not None:
        if not isinstance(params["bvecs"], (pathlib.Path, str)):
            raise StyxValidationError(f'`bvecs` has the wrong type: Received `{type(params.get("bvecs", None))}` expected `InputPathType | None`')
    if params.get("output_dir", None) is not None:
        if not isinstance(params["output_dir"], str):
            raise StyxValidationError(f'`output_dir` has the wrong type: Received `{type(params.get("output_dir", None))}` expected `str | None`')
    if params.get("field", None) is not None:
        if not isinstance(params["field"], (pathlib.Path, str)):
            raise StyxValidationError(f'`field` has the wrong type: Received `{type(params.get("field", None))}` expected `InputPathType | None`')
    if params.get("slspec", None) is not None:
        if not isinstance(params["slspec"], (pathlib.Path, str)):
            raise StyxValidationError(f'`slspec` has the wrong type: Received `{type(params.get("slspec", None))}` expected `InputPathType | None`')
    if params.get("verbose", False) is None:
        raise StyxValidationError("`verbose` must not be None")
    if not isinstance(params["verbose"], bool):
        raise StyxValidationError(f'`verbose` has the wrong type: Received `{type(params.get("verbose", False))}` expected `bool`')


def eddy_quad_cargs(
    params: EddyQuadParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("eddy_quad")
    cargs.append(params.get("eddyBase", None))
    cargs.extend([
        "--eddyIdx",
        execution.input_file(params.get("eddyIndex", None))
    ])
    cargs.extend([
        "--eddyParams",
        execution.input_file(params.get("eddyParams", None))
    ])
    cargs.extend([
        "--mask",
        execution.input_file(params.get("mask", None))
    ])
    cargs.extend([
        "--bvals",
        execution.input_file(params.get("bvals", None))
    ])
    if params.get("bvecs", None) is not None:
        cargs.extend([
            "--bvecs",
            execution.input_file(params.get("bvecs", None))
        ])
    if params.get("output_dir", None) is not None:
        cargs.extend([
            "--output-dir",
            params.get("output_dir", None)
        ])
    if params.get("field", None) is not None:
        cargs.extend([
            "--field",
            execution.input_file(params.get("field", None))
        ])
    if params.get("slspec", None) is not None:
        cargs.extend([
            "--slspec",
            execution.input_file(params.get("slspec", None))
        ])
    if params.get("verbose", False):
        cargs.append("--verbose")
    return cargs


def eddy_quad_outputs(
    params: EddyQuadParamsDict,
    execution: Execution,
) -> EddyQuadOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = EddyQuadOutputs(
        root=execution.output_file("."),
        output_dir_qc=execution.output_file(params.get("output_dir", None)) if (params.get("output_dir") is not None) else None,
    )
    return ret


def eddy_quad_execute(
    params: EddyQuadParamsDict,
    runner: Runner | None = None,
) -> EddyQuadOutputs:
    """
    eddy_quad
    
    QUality Assessment for DMRI.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `EddyQuadOutputs`).
    """
    eddy_quad_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(EDDY_QUAD_METADATA)
    params = execution.params(params)
    cargs = eddy_quad_cargs(params, execution)
    ret = eddy_quad_outputs(params, execution)
    execution.run(cargs)
    return ret


def eddy_quad(
    eddy_base: str,
    eddy_index: InputPathType,
    eddy_params: InputPathType,
    mask: InputPathType,
    bvals: InputPathType,
    bvecs: InputPathType | None = None,
    output_dir: str | None = None,
    field: InputPathType | None = None,
    slspec: InputPathType | None = None,
    verbose: bool = False,
    runner: Runner | None = None,
) -> EddyQuadOutputs:
    """
    eddy_quad
    
    QUality Assessment for DMRI.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        eddy_base: Basename (including path) specified when running EDDY.
        eddy_index: File containing indices for all volumes into acquisition\
            parameters.
        eddy_params: File containing acquisition parameters.
        mask: Binary mask file.
        bvals: b-values file.
        bvecs: b-vectors file - only used when <eddyBase>.eddy_residuals file\
            is present.
        output_dir: Output directory - default = '<eddyBase>.qc'.
        field: TOPUP estimated field (in Hz).
        slspec: Text file specifying slice/group acquisition.
        verbose: Display debug messages.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `EddyQuadOutputs`).
    """
    params = eddy_quad_params(
        eddy_base=eddy_base,
        eddy_index=eddy_index,
        eddy_params=eddy_params,
        mask=mask,
        bvals=bvals,
        bvecs=bvecs,
        output_dir=output_dir,
        field=field,
        slspec=slspec,
        verbose=verbose,
    )
    return eddy_quad_execute(params, runner)


__all__ = [
    "EDDY_QUAD_METADATA",
    "EddyQuadOutputs",
    "EddyQuadParamsDict",
    "EddyQuadParamsDictTagged",
    "eddy_quad",
    "eddy_quad_execute",
    "eddy_quad_params",
]
