# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

FSL_SBCA_METADATA = Metadata(
    id="05641f8c61b17b79acbd7fe93ce2880376fdae90.boutiques",
    name="fsl_sbca",
    package="fsl",
    container_image_tag="brainlife/fsl:6.0.4-patched2",
)


_FslSbcaParamsDictNoTag = typing.TypedDict('_FslSbcaParamsDictNoTag', {
    "infile": InputPathType,
    "seed": InputPathType,
    "target": InputPathType,
    "out": str,
    "reg_flag": bool,
    "conf_files": typing.NotRequired[list[InputPathType] | None],
    "seed_data": typing.NotRequired[InputPathType | None],
    "binarise_flag": bool,
    "mean_flag": bool,
    "abs_cc_flag": bool,
    "order": typing.NotRequired[float | None],
    "out_seeds_flag": bool,
    "out_seedmask_flag": bool,
    "out_ttcs_flag": bool,
    "out_conf_flag": bool,
    "verbose_flag": bool,
    "help_flag": bool,
})
FslSbcaParamsDictTagged = typing.TypedDict('FslSbcaParamsDictTagged', {
    "@type": typing.Literal["fsl/fsl_sbca"],
    "infile": InputPathType,
    "seed": InputPathType,
    "target": InputPathType,
    "out": str,
    "reg_flag": bool,
    "conf_files": typing.NotRequired[list[InputPathType] | None],
    "seed_data": typing.NotRequired[InputPathType | None],
    "binarise_flag": bool,
    "mean_flag": bool,
    "abs_cc_flag": bool,
    "order": typing.NotRequired[float | None],
    "out_seeds_flag": bool,
    "out_seedmask_flag": bool,
    "out_ttcs_flag": bool,
    "out_conf_flag": bool,
    "verbose_flag": bool,
    "help_flag": bool,
})
FslSbcaParamsDict = _FslSbcaParamsDictNoTag | FslSbcaParamsDictTagged


class FslSbcaOutputs(typing.NamedTuple):
    """
    Output object returned when calling `FslSbcaParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    output_seed_mask_image: OutputPathType
    """Output seed mask image"""
    output_seed_mask_image_base: OutputPathType
    """Output seed mask image"""
    output_confound_time_courses: OutputPathType
    """Output confound time courses"""


def fsl_sbca_params(
    infile: InputPathType,
    seed: InputPathType,
    target: InputPathType,
    out: str,
    reg_flag: bool = False,
    conf_files: list[InputPathType] | None = None,
    seed_data: InputPathType | None = None,
    binarise_flag: bool = False,
    mean_flag: bool = False,
    abs_cc_flag: bool = False,
    order: float | None = None,
    out_seeds_flag: bool = False,
    out_seedmask_flag: bool = False,
    out_ttcs_flag: bool = False,
    out_conf_flag: bool = False,
    verbose_flag: bool = False,
    help_flag: bool = False,
) -> FslSbcaParamsDictTagged:
    """
    Build parameters.
    
    Args:
        infile: Input file name (4D image file).
        seed: Seed voxel coordinate or file name of seed mask (3D/4D file).
        target: File name of target mask(s) (3D or 4D file).
        out: Output file base name.
        reg_flag: Perform time series regression rather than classification to\
            targets.
        conf_files: File name (or comma-separated list of file names) for\
            confound ASCII text files.
        seed_data: File name of 4D data file for the seed.
        binarise_flag: Binarise spatial maps prior to calculation of time\
            courses.
        mean_flag: Use mean instead of Eigenvariates for calculation of time\
            courses.
        abs_cc_flag: Use maximum absolute value instead of maximum value of the\
            cross-correlations.
        order: Number of Eigenvariates (default 1).
        out_seeds_flag: Output seed mask image as <basename>_seeds.
        out_seedmask_flag: Output seed mask image as <basename>_seedmask.
        out_ttcs_flag: Output target time courses as <basename>_ttc<X>.txt.
        out_conf_flag: Output confound time courses as <basename>_confounds.txt.
        verbose_flag: Switch on diagnostic messages.
        help_flag: Display help text.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "fsl/fsl_sbca",
        "infile": infile,
        "seed": seed,
        "target": target,
        "out": out,
        "reg_flag": reg_flag,
        "binarise_flag": binarise_flag,
        "mean_flag": mean_flag,
        "abs_cc_flag": abs_cc_flag,
        "out_seeds_flag": out_seeds_flag,
        "out_seedmask_flag": out_seedmask_flag,
        "out_ttcs_flag": out_ttcs_flag,
        "out_conf_flag": out_conf_flag,
        "verbose_flag": verbose_flag,
        "help_flag": help_flag,
    }
    if conf_files is not None:
        params["conf_files"] = conf_files
    if seed_data is not None:
        params["seed_data"] = seed_data
    if order is not None:
        params["order"] = order
    return params


def fsl_sbca_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `FslSbcaParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("infile", None) is None:
        raise StyxValidationError("`infile` must not be None")
    if not isinstance(params["infile"], (pathlib.Path, str)):
        raise StyxValidationError(f'`infile` has the wrong type: Received `{type(params.get("infile", None))}` expected `InputPathType`')
    if params.get("seed", None) is None:
        raise StyxValidationError("`seed` must not be None")
    if not isinstance(params["seed"], (pathlib.Path, str)):
        raise StyxValidationError(f'`seed` has the wrong type: Received `{type(params.get("seed", None))}` expected `InputPathType`')
    if params.get("target", None) is None:
        raise StyxValidationError("`target` must not be None")
    if not isinstance(params["target"], (pathlib.Path, str)):
        raise StyxValidationError(f'`target` has the wrong type: Received `{type(params.get("target", None))}` expected `InputPathType`')
    if params.get("out", None) is None:
        raise StyxValidationError("`out` must not be None")
    if not isinstance(params["out"], str):
        raise StyxValidationError(f'`out` has the wrong type: Received `{type(params.get("out", None))}` expected `str`')
    if params.get("reg_flag", False) is None:
        raise StyxValidationError("`reg_flag` must not be None")
    if not isinstance(params["reg_flag"], bool):
        raise StyxValidationError(f'`reg_flag` has the wrong type: Received `{type(params.get("reg_flag", False))}` expected `bool`')
    if params.get("conf_files", None) is not None:
        if not isinstance(params["conf_files"], list):
            raise StyxValidationError(f'`conf_files` has the wrong type: Received `{type(params.get("conf_files", None))}` expected `list[InputPathType] | None`')
        for e in params["conf_files"]:
            if not isinstance(e, (pathlib.Path, str)):
                raise StyxValidationError(f'`conf_files` has the wrong type: Received `{type(params.get("conf_files", None))}` expected `list[InputPathType] | None`')
    if params.get("seed_data", None) is not None:
        if not isinstance(params["seed_data"], (pathlib.Path, str)):
            raise StyxValidationError(f'`seed_data` has the wrong type: Received `{type(params.get("seed_data", None))}` expected `InputPathType | None`')
    if params.get("binarise_flag", False) is None:
        raise StyxValidationError("`binarise_flag` must not be None")
    if not isinstance(params["binarise_flag"], bool):
        raise StyxValidationError(f'`binarise_flag` has the wrong type: Received `{type(params.get("binarise_flag", False))}` expected `bool`')
    if params.get("mean_flag", False) is None:
        raise StyxValidationError("`mean_flag` must not be None")
    if not isinstance(params["mean_flag"], bool):
        raise StyxValidationError(f'`mean_flag` has the wrong type: Received `{type(params.get("mean_flag", False))}` expected `bool`')
    if params.get("abs_cc_flag", False) is None:
        raise StyxValidationError("`abs_cc_flag` must not be None")
    if not isinstance(params["abs_cc_flag"], bool):
        raise StyxValidationError(f'`abs_cc_flag` has the wrong type: Received `{type(params.get("abs_cc_flag", False))}` expected `bool`')
    if params.get("order", None) is not None:
        if not isinstance(params["order"], (float, int)):
            raise StyxValidationError(f'`order` has the wrong type: Received `{type(params.get("order", None))}` expected `float | None`')
    if params.get("out_seeds_flag", False) is None:
        raise StyxValidationError("`out_seeds_flag` must not be None")
    if not isinstance(params["out_seeds_flag"], bool):
        raise StyxValidationError(f'`out_seeds_flag` has the wrong type: Received `{type(params.get("out_seeds_flag", False))}` expected `bool`')
    if params.get("out_seedmask_flag", False) is None:
        raise StyxValidationError("`out_seedmask_flag` must not be None")
    if not isinstance(params["out_seedmask_flag"], bool):
        raise StyxValidationError(f'`out_seedmask_flag` has the wrong type: Received `{type(params.get("out_seedmask_flag", False))}` expected `bool`')
    if params.get("out_ttcs_flag", False) is None:
        raise StyxValidationError("`out_ttcs_flag` must not be None")
    if not isinstance(params["out_ttcs_flag"], bool):
        raise StyxValidationError(f'`out_ttcs_flag` has the wrong type: Received `{type(params.get("out_ttcs_flag", False))}` expected `bool`')
    if params.get("out_conf_flag", False) is None:
        raise StyxValidationError("`out_conf_flag` must not be None")
    if not isinstance(params["out_conf_flag"], bool):
        raise StyxValidationError(f'`out_conf_flag` has the wrong type: Received `{type(params.get("out_conf_flag", False))}` expected `bool`')
    if params.get("verbose_flag", False) is None:
        raise StyxValidationError("`verbose_flag` must not be None")
    if not isinstance(params["verbose_flag"], bool):
        raise StyxValidationError(f'`verbose_flag` has the wrong type: Received `{type(params.get("verbose_flag", False))}` expected `bool`')
    if params.get("help_flag", False) is None:
        raise StyxValidationError("`help_flag` must not be None")
    if not isinstance(params["help_flag"], bool):
        raise StyxValidationError(f'`help_flag` has the wrong type: Received `{type(params.get("help_flag", False))}` expected `bool`')


def fsl_sbca_cargs(
    params: FslSbcaParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("fsl_sbca")
    cargs.extend([
        "--in",
        execution.input_file(params.get("infile", None))
    ])
    cargs.extend([
        "--seed",
        execution.input_file(params.get("seed", None))
    ])
    cargs.extend([
        "--target",
        execution.input_file(params.get("target", None))
    ])
    cargs.extend([
        "--out",
        params.get("out", None)
    ])
    if params.get("reg_flag", False):
        cargs.append("--reg")
    if params.get("conf_files", None) is not None:
        cargs.extend([
            "--conf",
            *[execution.input_file(f) for f in params.get("conf_files", None)]
        ])
    if params.get("seed_data", None) is not None:
        cargs.extend([
            "--seeddata",
            execution.input_file(params.get("seed_data", None))
        ])
    if params.get("binarise_flag", False):
        cargs.append("--bin")
    if params.get("mean_flag", False):
        cargs.append("--mean")
    if params.get("abs_cc_flag", False):
        cargs.append("--abscc")
    if params.get("order", None) is not None:
        cargs.extend([
            "--order",
            str(params.get("order", None))
        ])
    if params.get("out_seeds_flag", False):
        cargs.append("--out_seeds")
    if params.get("out_seedmask_flag", False):
        cargs.append("--out_seedmask")
    if params.get("out_ttcs_flag", False):
        cargs.append("--out_ttcs")
    if params.get("out_conf_flag", False):
        cargs.append("--out_conf")
    if params.get("verbose_flag", False):
        cargs.append("-v")
    if params.get("help_flag", False):
        cargs.append("-h")
    return cargs


def fsl_sbca_outputs(
    params: FslSbcaParamsDict,
    execution: Execution,
) -> FslSbcaOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = FslSbcaOutputs(
        root=execution.output_file("."),
        output_seed_mask_image=execution.output_file(params.get("out", None) + "_seeds"),
        output_seed_mask_image_base=execution.output_file(params.get("out", None) + "_seedmask"),
        output_confound_time_courses=execution.output_file(params.get("out", None) + "_confounds.txt"),
    )
    return ret


def fsl_sbca_execute(
    params: FslSbcaParamsDict,
    runner: Runner | None = None,
) -> FslSbcaOutputs:
    """
    fsl_sbca
    
    Performs seed-based correlation analysis on FMRI data using either a single
    seed coordinate or a seed mask.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `FslSbcaOutputs`).
    """
    fsl_sbca_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(FSL_SBCA_METADATA)
    params = execution.params(params)
    cargs = fsl_sbca_cargs(params, execution)
    ret = fsl_sbca_outputs(params, execution)
    execution.run(cargs)
    return ret


def fsl_sbca(
    infile: InputPathType,
    seed: InputPathType,
    target: InputPathType,
    out: str,
    reg_flag: bool = False,
    conf_files: list[InputPathType] | None = None,
    seed_data: InputPathType | None = None,
    binarise_flag: bool = False,
    mean_flag: bool = False,
    abs_cc_flag: bool = False,
    order: float | None = None,
    out_seeds_flag: bool = False,
    out_seedmask_flag: bool = False,
    out_ttcs_flag: bool = False,
    out_conf_flag: bool = False,
    verbose_flag: bool = False,
    help_flag: bool = False,
    runner: Runner | None = None,
) -> FslSbcaOutputs:
    """
    fsl_sbca
    
    Performs seed-based correlation analysis on FMRI data using either a single
    seed coordinate or a seed mask.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        infile: Input file name (4D image file).
        seed: Seed voxel coordinate or file name of seed mask (3D/4D file).
        target: File name of target mask(s) (3D or 4D file).
        out: Output file base name.
        reg_flag: Perform time series regression rather than classification to\
            targets.
        conf_files: File name (or comma-separated list of file names) for\
            confound ASCII text files.
        seed_data: File name of 4D data file for the seed.
        binarise_flag: Binarise spatial maps prior to calculation of time\
            courses.
        mean_flag: Use mean instead of Eigenvariates for calculation of time\
            courses.
        abs_cc_flag: Use maximum absolute value instead of maximum value of the\
            cross-correlations.
        order: Number of Eigenvariates (default 1).
        out_seeds_flag: Output seed mask image as <basename>_seeds.
        out_seedmask_flag: Output seed mask image as <basename>_seedmask.
        out_ttcs_flag: Output target time courses as <basename>_ttc<X>.txt.
        out_conf_flag: Output confound time courses as <basename>_confounds.txt.
        verbose_flag: Switch on diagnostic messages.
        help_flag: Display help text.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `FslSbcaOutputs`).
    """
    params = fsl_sbca_params(
        infile=infile,
        seed=seed,
        target=target,
        out=out,
        reg_flag=reg_flag,
        conf_files=conf_files,
        seed_data=seed_data,
        binarise_flag=binarise_flag,
        mean_flag=mean_flag,
        abs_cc_flag=abs_cc_flag,
        order=order,
        out_seeds_flag=out_seeds_flag,
        out_seedmask_flag=out_seedmask_flag,
        out_ttcs_flag=out_ttcs_flag,
        out_conf_flag=out_conf_flag,
        verbose_flag=verbose_flag,
        help_flag=help_flag,
    )
    return fsl_sbca_execute(params, runner)


__all__ = [
    "FSL_SBCA_METADATA",
    "FslSbcaOutputs",
    "FslSbcaParamsDict",
    "FslSbcaParamsDictTagged",
    "fsl_sbca",
    "fsl_sbca_execute",
    "fsl_sbca_params",
]
