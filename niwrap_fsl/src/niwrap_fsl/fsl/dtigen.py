# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

DTIGEN_METADATA = Metadata(
    id="abaee699f51242a35eba0eb7f3373dacc2e8c362.boutiques",
    name="dtigen",
    package="fsl",
    container_image_tag="brainlife/fsl:6.0.4-patched2",
)


_DtigenParamsDictNoTag = typing.TypedDict('_DtigenParamsDictNoTag', {
    "tensor": InputPathType,
    "s0": InputPathType,
    "output_data": str,
    "bvecs": InputPathType,
    "bvals": InputPathType,
    "brainmask": InputPathType,
    "kurtosis": typing.NotRequired[InputPathType | None],
    "help": bool,
})
DtigenParamsDictTagged = typing.TypedDict('DtigenParamsDictTagged', {
    "@type": typing.Literal["fsl/dtigen"],
    "tensor": InputPathType,
    "s0": InputPathType,
    "output_data": str,
    "bvecs": InputPathType,
    "bvals": InputPathType,
    "brainmask": InputPathType,
    "kurtosis": typing.NotRequired[InputPathType | None],
    "help": bool,
})
DtigenParamsDict = _DtigenParamsDictNoTag | DtigenParamsDictTagged


class DtigenOutputs(typing.NamedTuple):
    """
    Output object returned when calling `DtigenParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    output_diffusion_data: OutputPathType
    """Output diffusion data"""
    output_kurtosis_map: OutputPathType | None
    """Mean kurtosis map"""


def dtigen_params(
    tensor: InputPathType,
    s0: InputPathType,
    output_data: str,
    bvecs: InputPathType,
    bvals: InputPathType,
    brainmask: InputPathType,
    kurtosis: InputPathType | None = None,
    help_: bool = False,
) -> DtigenParamsDictTagged:
    """
    Build parameters.
    
    Args:
        tensor: Input tensor file.
        s0: Input S0 file.
        output_data: Output data file.
        bvecs: bvecs ASCII text file.
        bvals: bvals ASCII text file.
        brainmask: Brain mask file.
        kurtosis: Mean kurtosis map.
        help_: Display help message.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "fsl/dtigen",
        "tensor": tensor,
        "s0": s0,
        "output_data": output_data,
        "bvecs": bvecs,
        "bvals": bvals,
        "brainmask": brainmask,
        "help": help_,
    }
    if kurtosis is not None:
        params["kurtosis"] = kurtosis
    return params


def dtigen_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `DtigenParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("tensor", None) is None:
        raise StyxValidationError("`tensor` must not be None")
    if not isinstance(params["tensor"], (pathlib.Path, str)):
        raise StyxValidationError(f'`tensor` has the wrong type: Received `{type(params.get("tensor", None))}` expected `InputPathType`')
    if params.get("s0", None) is None:
        raise StyxValidationError("`s0` must not be None")
    if not isinstance(params["s0"], (pathlib.Path, str)):
        raise StyxValidationError(f'`s0` has the wrong type: Received `{type(params.get("s0", None))}` expected `InputPathType`')
    if params.get("output_data", None) is None:
        raise StyxValidationError("`output_data` must not be None")
    if not isinstance(params["output_data"], str):
        raise StyxValidationError(f'`output_data` has the wrong type: Received `{type(params.get("output_data", None))}` expected `str`')
    if params.get("bvecs", None) is None:
        raise StyxValidationError("`bvecs` must not be None")
    if not isinstance(params["bvecs"], (pathlib.Path, str)):
        raise StyxValidationError(f'`bvecs` has the wrong type: Received `{type(params.get("bvecs", None))}` expected `InputPathType`')
    if params.get("bvals", None) is None:
        raise StyxValidationError("`bvals` must not be None")
    if not isinstance(params["bvals"], (pathlib.Path, str)):
        raise StyxValidationError(f'`bvals` has the wrong type: Received `{type(params.get("bvals", None))}` expected `InputPathType`')
    if params.get("brainmask", None) is None:
        raise StyxValidationError("`brainmask` must not be None")
    if not isinstance(params["brainmask"], (pathlib.Path, str)):
        raise StyxValidationError(f'`brainmask` has the wrong type: Received `{type(params.get("brainmask", None))}` expected `InputPathType`')
    if params.get("kurtosis", None) is not None:
        if not isinstance(params["kurtosis"], (pathlib.Path, str)):
            raise StyxValidationError(f'`kurtosis` has the wrong type: Received `{type(params.get("kurtosis", None))}` expected `InputPathType | None`')
    if params.get("help", False) is None:
        raise StyxValidationError("`help` must not be None")
    if not isinstance(params["help"], bool):
        raise StyxValidationError(f'`help` has the wrong type: Received `{type(params.get("help", False))}` expected `bool`')


def dtigen_cargs(
    params: DtigenParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("dtigen")
    cargs.extend([
        "-t",
        execution.input_file(params.get("tensor", None))
    ])
    cargs.extend([
        "--s0",
        execution.input_file(params.get("s0", None))
    ])
    cargs.extend([
        "-o",
        params.get("output_data", None)
    ])
    cargs.extend([
        "-r",
        execution.input_file(params.get("bvecs", None))
    ])
    cargs.extend([
        "-b",
        execution.input_file(params.get("bvals", None))
    ])
    cargs.extend([
        "-m",
        execution.input_file(params.get("brainmask", None))
    ])
    if params.get("kurtosis", None) is not None:
        cargs.extend([
            "--kurt",
            execution.input_file(params.get("kurtosis", None))
        ])
    if params.get("help", False):
        cargs.append("-h")
    return cargs


def dtigen_outputs(
    params: DtigenParamsDict,
    execution: Execution,
) -> DtigenOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = DtigenOutputs(
        root=execution.output_file("."),
        output_diffusion_data=execution.output_file(params.get("output_data", None) + ".nii.gz"),
        output_kurtosis_map=execution.output_file(pathlib.Path(params.get("kurtosis", None)).name) if (params.get("kurtosis") is not None) else None,
    )
    return ret


def dtigen_execute(
    params: DtigenParamsDict,
    runner: Runner | None = None,
) -> DtigenOutputs:
    """
    dtigen
    
    Generate diffusion data using tensor model.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `DtigenOutputs`).
    """
    dtigen_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(DTIGEN_METADATA)
    params = execution.params(params)
    cargs = dtigen_cargs(params, execution)
    ret = dtigen_outputs(params, execution)
    execution.run(cargs)
    return ret


def dtigen(
    tensor: InputPathType,
    s0: InputPathType,
    output_data: str,
    bvecs: InputPathType,
    bvals: InputPathType,
    brainmask: InputPathType,
    kurtosis: InputPathType | None = None,
    help_: bool = False,
    runner: Runner | None = None,
) -> DtigenOutputs:
    """
    dtigen
    
    Generate diffusion data using tensor model.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        tensor: Input tensor file.
        s0: Input S0 file.
        output_data: Output data file.
        bvecs: bvecs ASCII text file.
        bvals: bvals ASCII text file.
        brainmask: Brain mask file.
        kurtosis: Mean kurtosis map.
        help_: Display help message.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `DtigenOutputs`).
    """
    params = dtigen_params(
        tensor=tensor,
        s0=s0,
        output_data=output_data,
        bvecs=bvecs,
        bvals=bvals,
        brainmask=brainmask,
        kurtosis=kurtosis,
        help_=help_,
    )
    return dtigen_execute(params, runner)


__all__ = [
    "DTIGEN_METADATA",
    "DtigenOutputs",
    "DtigenParamsDict",
    "DtigenParamsDictTagged",
    "dtigen",
    "dtigen_execute",
    "dtigen_params",
]
