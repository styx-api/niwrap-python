# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

RUN_FIRST_METADATA = Metadata(
    id="38fb0f5e94f123699e878584a83c503c048bd417.boutiques",
    name="run_first",
    package="fsl",
    container_image_tag="brainlife/fsl:6.0.4-patched2",
)


_RunFirstParamsDictNoTag = typing.TypedDict('_RunFirstParamsDictNoTag', {
    "input_image": InputPathType,
    "transformation_matrix": InputPathType,
    "n_modes": float,
    "output_basename": str,
    "model_name": InputPathType,
    "verbose_flag": bool,
    "intref_model_name": typing.NotRequired[str | None],
    "load_bvars": typing.NotRequired[InputPathType | None],
    "multiple_images_flag": bool,
})
RunFirstParamsDictTagged = typing.TypedDict('RunFirstParamsDictTagged', {
    "@type": typing.Literal["fsl/run_first"],
    "input_image": InputPathType,
    "transformation_matrix": InputPathType,
    "n_modes": float,
    "output_basename": str,
    "model_name": InputPathType,
    "verbose_flag": bool,
    "intref_model_name": typing.NotRequired[str | None],
    "load_bvars": typing.NotRequired[InputPathType | None],
    "multiple_images_flag": bool,
})
RunFirstParamsDict = _RunFirstParamsDictNoTag | RunFirstParamsDictTagged


class RunFirstOutputs(typing.NamedTuple):
    """
    Output object returned when calling `RunFirstParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""


def run_first_params(
    input_image: InputPathType,
    transformation_matrix: InputPathType,
    n_modes: float,
    output_basename: str,
    model_name: InputPathType,
    verbose_flag: bool = False,
    intref_model_name: str | None = None,
    load_bvars: InputPathType | None = None,
    multiple_images_flag: bool = False,
) -> RunFirstParamsDictTagged:
    """
    Build parameters.
    
    Args:
        input_image: Input image file (e.g. img.nii.gz).
        transformation_matrix: Input transformation matrix file (e.g.\
            input_to_mni.mat).
        n_modes: Number of modes.
        output_basename: Output basename.
        model_name: Model name.
        verbose_flag: Verbose mode.
        intref_model_name: Reference structure for the local intensity\
            normalization.
        load_bvars: Initializes FIRST with a previous estimate of the structure.
        multiple_images_flag: Run FIRST on multiple images; provide a list of\
            images, transformation matrices, and output names.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "fsl/run_first",
        "input_image": input_image,
        "transformation_matrix": transformation_matrix,
        "n_modes": n_modes,
        "output_basename": output_basename,
        "model_name": model_name,
        "verbose_flag": verbose_flag,
        "multiple_images_flag": multiple_images_flag,
    }
    if intref_model_name is not None:
        params["intref_model_name"] = intref_model_name
    if load_bvars is not None:
        params["load_bvars"] = load_bvars
    return params


def run_first_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `RunFirstParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("input_image", None) is None:
        raise StyxValidationError("`input_image` must not be None")
    if not isinstance(params["input_image"], (pathlib.Path, str)):
        raise StyxValidationError(f'`input_image` has the wrong type: Received `{type(params.get("input_image", None))}` expected `InputPathType`')
    if params.get("transformation_matrix", None) is None:
        raise StyxValidationError("`transformation_matrix` must not be None")
    if not isinstance(params["transformation_matrix"], (pathlib.Path, str)):
        raise StyxValidationError(f'`transformation_matrix` has the wrong type: Received `{type(params.get("transformation_matrix", None))}` expected `InputPathType`')
    if params.get("n_modes", None) is None:
        raise StyxValidationError("`n_modes` must not be None")
    if not isinstance(params["n_modes"], (float, int)):
        raise StyxValidationError(f'`n_modes` has the wrong type: Received `{type(params.get("n_modes", None))}` expected `float`')
    if params.get("output_basename", None) is None:
        raise StyxValidationError("`output_basename` must not be None")
    if not isinstance(params["output_basename"], str):
        raise StyxValidationError(f'`output_basename` has the wrong type: Received `{type(params.get("output_basename", None))}` expected `str`')
    if params.get("model_name", None) is None:
        raise StyxValidationError("`model_name` must not be None")
    if not isinstance(params["model_name"], (pathlib.Path, str)):
        raise StyxValidationError(f'`model_name` has the wrong type: Received `{type(params.get("model_name", None))}` expected `InputPathType`')
    if params.get("verbose_flag", False) is None:
        raise StyxValidationError("`verbose_flag` must not be None")
    if not isinstance(params["verbose_flag"], bool):
        raise StyxValidationError(f'`verbose_flag` has the wrong type: Received `{type(params.get("verbose_flag", False))}` expected `bool`')
    if params.get("intref_model_name", None) is not None:
        if not isinstance(params["intref_model_name"], str):
            raise StyxValidationError(f'`intref_model_name` has the wrong type: Received `{type(params.get("intref_model_name", None))}` expected `str | None`')
    if params.get("load_bvars", None) is not None:
        if not isinstance(params["load_bvars"], (pathlib.Path, str)):
            raise StyxValidationError(f'`load_bvars` has the wrong type: Received `{type(params.get("load_bvars", None))}` expected `InputPathType | None`')
    if params.get("multiple_images_flag", False) is None:
        raise StyxValidationError("`multiple_images_flag` must not be None")
    if not isinstance(params["multiple_images_flag"], bool):
        raise StyxValidationError(f'`multiple_images_flag` has the wrong type: Received `{type(params.get("multiple_images_flag", False))}` expected `bool`')


def run_first_cargs(
    params: RunFirstParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("run_first")
    cargs.extend([
        "-i",
        execution.input_file(params.get("input_image", None))
    ])
    cargs.extend([
        "-t",
        execution.input_file(params.get("transformation_matrix", None))
    ])
    cargs.extend([
        "-n",
        str(params.get("n_modes", None))
    ])
    cargs.extend([
        "-o",
        params.get("output_basename", None)
    ])
    cargs.extend([
        "-m",
        execution.input_file(params.get("model_name", None))
    ])
    if params.get("verbose_flag", False):
        cargs.append("-v")
    if params.get("intref_model_name", None) is not None:
        cargs.extend([
            "-intref",
            params.get("intref_model_name", None)
        ])
    if params.get("load_bvars", None) is not None:
        cargs.extend([
            "-loadBvars",
            execution.input_file(params.get("load_bvars", None))
        ])
    if params.get("multiple_images_flag", False):
        cargs.append("-multipleImages")
    return cargs


def run_first_outputs(
    params: RunFirstParamsDict,
    execution: Execution,
) -> RunFirstOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = RunFirstOutputs(
        root=execution.output_file("."),
    )
    return ret


def run_first_execute(
    params: RunFirstParamsDict,
    runner: Runner | None = None,
) -> RunFirstOutputs:
    """
    run_first
    
    A tool to run FSL's FIRST for subcortical segmentation.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `RunFirstOutputs`).
    """
    run_first_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(RUN_FIRST_METADATA)
    params = execution.params(params)
    cargs = run_first_cargs(params, execution)
    ret = run_first_outputs(params, execution)
    execution.run(cargs)
    return ret


def run_first(
    input_image: InputPathType,
    transformation_matrix: InputPathType,
    n_modes: float,
    output_basename: str,
    model_name: InputPathType,
    verbose_flag: bool = False,
    intref_model_name: str | None = None,
    load_bvars: InputPathType | None = None,
    multiple_images_flag: bool = False,
    runner: Runner | None = None,
) -> RunFirstOutputs:
    """
    run_first
    
    A tool to run FSL's FIRST for subcortical segmentation.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        input_image: Input image file (e.g. img.nii.gz).
        transformation_matrix: Input transformation matrix file (e.g.\
            input_to_mni.mat).
        n_modes: Number of modes.
        output_basename: Output basename.
        model_name: Model name.
        verbose_flag: Verbose mode.
        intref_model_name: Reference structure for the local intensity\
            normalization.
        load_bvars: Initializes FIRST with a previous estimate of the structure.
        multiple_images_flag: Run FIRST on multiple images; provide a list of\
            images, transformation matrices, and output names.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `RunFirstOutputs`).
    """
    params = run_first_params(
        input_image=input_image,
        transformation_matrix=transformation_matrix,
        n_modes=n_modes,
        output_basename=output_basename,
        model_name=model_name,
        verbose_flag=verbose_flag,
        intref_model_name=intref_model_name,
        load_bvars=load_bvars,
        multiple_images_flag=multiple_images_flag,
    )
    return run_first_execute(params, runner)


__all__ = [
    "RUN_FIRST_METADATA",
    "RunFirstOutputs",
    "RunFirstParamsDict",
    "RunFirstParamsDictTagged",
    "run_first",
    "run_first_execute",
    "run_first_params",
]
