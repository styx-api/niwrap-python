# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

SUSAN_METADATA = Metadata(
    id="df7143190550f4edd77aee38412229dd5192192c.boutiques",
    name="susan",
    package="fsl",
    container_image_tag="brainlife/fsl:6.0.4-patched2",
)


_SusanParamsDictNoTag = typing.TypedDict('_SusanParamsDictNoTag', {
    "input_file": InputPathType,
    "brightness_threshold": float,
    "spatial_size": float,
    "dimensionality": float,
    "use_median_filter": float,
    "n_usans": float,
    "usan1": typing.NotRequired[InputPathType | None],
    "brightness_threshold1": typing.NotRequired[float | None],
    "usan2": typing.NotRequired[InputPathType | None],
    "brightness_threshold2": typing.NotRequired[float | None],
    "output_file": str,
})
SusanParamsDictTagged = typing.TypedDict('SusanParamsDictTagged', {
    "@type": typing.Literal["fsl/susan"],
    "input_file": InputPathType,
    "brightness_threshold": float,
    "spatial_size": float,
    "dimensionality": float,
    "use_median_filter": float,
    "n_usans": float,
    "usan1": typing.NotRequired[InputPathType | None],
    "brightness_threshold1": typing.NotRequired[float | None],
    "usan2": typing.NotRequired[InputPathType | None],
    "brightness_threshold2": typing.NotRequired[float | None],
    "output_file": str,
})
SusanParamsDict = _SusanParamsDictNoTag | SusanParamsDictTagged


class SusanOutputs(typing.NamedTuple):
    """
    Output object returned when calling `SusanParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    filtered_output: OutputPathType
    """Filtered output image file"""


def susan_params(
    input_file: InputPathType,
    brightness_threshold: float,
    spatial_size: float,
    dimensionality: float,
    use_median_filter: float,
    n_usans: float,
    output_file: str,
    usan1: InputPathType | None = None,
    brightness_threshold1: float | None = None,
    usan2: InputPathType | None = None,
    brightness_threshold2: float | None = None,
) -> SusanParamsDictTagged:
    """
    Build parameters.
    
    Args:
        input_file: Input image file.
        brightness_threshold: Brightness threshold; should be greater than\
            noise level and less than contrast of edges to be preserved.
        spatial_size: Spatial size (sigma, i.e., half-width) of smoothing, in\
            mm.
        dimensionality: Dimensionality (2 or 3), for within-plane (2) or fully\
            3D (3) smoothing.
        use_median_filter: Use median filter for cases where single-point noise\
            is detected (0 or 1).
        n_usans: Determine if the smoothing area is found from secondary images\
            (0, 1 or 2).
        output_file: Output image file.
        usan1: First USAN image file.
        brightness_threshold1: Brightness threshold for first USAN image.
        usan2: Second USAN image file.
        brightness_threshold2: Brightness threshold for second USAN image.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "fsl/susan",
        "input_file": input_file,
        "brightness_threshold": brightness_threshold,
        "spatial_size": spatial_size,
        "dimensionality": dimensionality,
        "use_median_filter": use_median_filter,
        "n_usans": n_usans,
        "output_file": output_file,
    }
    if usan1 is not None:
        params["usan1"] = usan1
    if brightness_threshold1 is not None:
        params["brightness_threshold1"] = brightness_threshold1
    if usan2 is not None:
        params["usan2"] = usan2
    if brightness_threshold2 is not None:
        params["brightness_threshold2"] = brightness_threshold2
    return params


def susan_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `SusanParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("input_file", None) is None:
        raise StyxValidationError("`input_file` must not be None")
    if not isinstance(params["input_file"], (pathlib.Path, str)):
        raise StyxValidationError(f'`input_file` has the wrong type: Received `{type(params.get("input_file", None))}` expected `InputPathType`')
    if params.get("brightness_threshold", None) is None:
        raise StyxValidationError("`brightness_threshold` must not be None")
    if not isinstance(params["brightness_threshold"], (float, int)):
        raise StyxValidationError(f'`brightness_threshold` has the wrong type: Received `{type(params.get("brightness_threshold", None))}` expected `float`')
    if params.get("spatial_size", None) is None:
        raise StyxValidationError("`spatial_size` must not be None")
    if not isinstance(params["spatial_size"], (float, int)):
        raise StyxValidationError(f'`spatial_size` has the wrong type: Received `{type(params.get("spatial_size", None))}` expected `float`')
    if params.get("dimensionality", None) is None:
        raise StyxValidationError("`dimensionality` must not be None")
    if not isinstance(params["dimensionality"], (float, int)):
        raise StyxValidationError(f'`dimensionality` has the wrong type: Received `{type(params.get("dimensionality", None))}` expected `float`')
    if not (2 <= params["dimensionality"] <= 3):
        raise StyxValidationError("Parameter `dimensionality` must be between 2 and 3 (inclusive)")
    if params.get("use_median_filter", None) is None:
        raise StyxValidationError("`use_median_filter` must not be None")
    if not isinstance(params["use_median_filter"], (float, int)):
        raise StyxValidationError(f'`use_median_filter` has the wrong type: Received `{type(params.get("use_median_filter", None))}` expected `float`')
    if not (0 <= params["use_median_filter"] <= 1):
        raise StyxValidationError("Parameter `use_median_filter` must be between 0 and 1 (inclusive)")
    if params.get("n_usans", None) is None:
        raise StyxValidationError("`n_usans` must not be None")
    if not isinstance(params["n_usans"], (float, int)):
        raise StyxValidationError(f'`n_usans` has the wrong type: Received `{type(params.get("n_usans", None))}` expected `float`')
    if not (0 <= params["n_usans"] <= 2):
        raise StyxValidationError("Parameter `n_usans` must be between 0 and 2 (inclusive)")
    if params.get("usan1", None) is not None:
        if not isinstance(params["usan1"], (pathlib.Path, str)):
            raise StyxValidationError(f'`usan1` has the wrong type: Received `{type(params.get("usan1", None))}` expected `InputPathType | None`')
    if params.get("brightness_threshold1", None) is not None:
        if not isinstance(params["brightness_threshold1"], (float, int)):
            raise StyxValidationError(f'`brightness_threshold1` has the wrong type: Received `{type(params.get("brightness_threshold1", None))}` expected `float | None`')
    if params.get("usan2", None) is not None:
        if not isinstance(params["usan2"], (pathlib.Path, str)):
            raise StyxValidationError(f'`usan2` has the wrong type: Received `{type(params.get("usan2", None))}` expected `InputPathType | None`')
    if params.get("brightness_threshold2", None) is not None:
        if not isinstance(params["brightness_threshold2"], (float, int)):
            raise StyxValidationError(f'`brightness_threshold2` has the wrong type: Received `{type(params.get("brightness_threshold2", None))}` expected `float | None`')
    if params.get("output_file", None) is None:
        raise StyxValidationError("`output_file` must not be None")
    if not isinstance(params["output_file"], str):
        raise StyxValidationError(f'`output_file` has the wrong type: Received `{type(params.get("output_file", None))}` expected `str`')


def susan_cargs(
    params: SusanParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("susan")
    cargs.append(execution.input_file(params.get("input_file", None)))
    cargs.append(str(params.get("brightness_threshold", None)))
    cargs.append(str(params.get("spatial_size", None)))
    cargs.append(str(params.get("dimensionality", None)))
    cargs.append(str(params.get("use_median_filter", None)))
    cargs.append(str(params.get("n_usans", None)))
    if params.get("usan1", None) is not None:
        cargs.append(execution.input_file(params.get("usan1", None)))
    if params.get("brightness_threshold1", None) is not None:
        cargs.append(str(params.get("brightness_threshold1", None)))
    if params.get("usan2", None) is not None:
        cargs.append(execution.input_file(params.get("usan2", None)))
    if params.get("brightness_threshold2", None) is not None:
        cargs.append(str(params.get("brightness_threshold2", None)))
    cargs.append(params.get("output_file", None))
    return cargs


def susan_outputs(
    params: SusanParamsDict,
    execution: Execution,
) -> SusanOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = SusanOutputs(
        root=execution.output_file("."),
        filtered_output=execution.output_file(params.get("output_file", None)),
    )
    return ret


def susan_execute(
    params: SusanParamsDict,
    runner: Runner | None = None,
) -> SusanOutputs:
    """
    susan
    
    Non-linear noise reduction filtering tool.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `SusanOutputs`).
    """
    susan_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(SUSAN_METADATA)
    params = execution.params(params)
    cargs = susan_cargs(params, execution)
    ret = susan_outputs(params, execution)
    execution.run(cargs)
    return ret


def susan(
    input_file: InputPathType,
    brightness_threshold: float,
    spatial_size: float,
    dimensionality: float,
    use_median_filter: float,
    n_usans: float,
    output_file: str,
    usan1: InputPathType | None = None,
    brightness_threshold1: float | None = None,
    usan2: InputPathType | None = None,
    brightness_threshold2: float | None = None,
    runner: Runner | None = None,
) -> SusanOutputs:
    """
    susan
    
    Non-linear noise reduction filtering tool.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        input_file: Input image file.
        brightness_threshold: Brightness threshold; should be greater than\
            noise level and less than contrast of edges to be preserved.
        spatial_size: Spatial size (sigma, i.e., half-width) of smoothing, in\
            mm.
        dimensionality: Dimensionality (2 or 3), for within-plane (2) or fully\
            3D (3) smoothing.
        use_median_filter: Use median filter for cases where single-point noise\
            is detected (0 or 1).
        n_usans: Determine if the smoothing area is found from secondary images\
            (0, 1 or 2).
        output_file: Output image file.
        usan1: First USAN image file.
        brightness_threshold1: Brightness threshold for first USAN image.
        usan2: Second USAN image file.
        brightness_threshold2: Brightness threshold for second USAN image.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `SusanOutputs`).
    """
    params = susan_params(
        input_file=input_file,
        brightness_threshold=brightness_threshold,
        spatial_size=spatial_size,
        dimensionality=dimensionality,
        use_median_filter=use_median_filter,
        n_usans=n_usans,
        usan1=usan1,
        brightness_threshold1=brightness_threshold1,
        usan2=usan2,
        brightness_threshold2=brightness_threshold2,
        output_file=output_file,
    )
    return susan_execute(params, runner)


__all__ = [
    "SUSAN_METADATA",
    "SusanOutputs",
    "SusanParamsDict",
    "SusanParamsDictTagged",
    "susan",
    "susan_execute",
    "susan_params",
]
