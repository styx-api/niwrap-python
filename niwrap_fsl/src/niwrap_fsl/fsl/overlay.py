# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

OVERLAY_METADATA = Metadata(
    id="ac1c797a31f7d90df494c815b67143ce463e0b7a.boutiques",
    name="overlay",
    package="fsl",
    container_image_tag="brainlife/fsl:6.0.4-patched2",
)


_OverlayParamsDictNoTag = typing.TypedDict('_OverlayParamsDictNoTag', {
    "auto_thresh_bg": bool,
    "background_image": InputPathType,
    "bg_thresh": list[float],
    "full_bg_range": bool,
    "out_file": typing.NotRequired[str | None],
    "out_type": typing.NotRequired[typing.Literal["float", "int"] | None],
    "output_type": typing.NotRequired[typing.Literal["NIFTI", "NIFTI_PAIR", "NIFTI_GZ", "NIFTI_PAIR_GZ"] | None],
    "stat_image": InputPathType,
    "stat_image2": typing.NotRequired[InputPathType | None],
    "stat_thresh": list[float],
    "stat_thresh2": typing.NotRequired[list[float] | None],
    "use_checkerboard": bool,
})
OverlayParamsDictTagged = typing.TypedDict('OverlayParamsDictTagged', {
    "@type": typing.Literal["fsl/overlay"],
    "auto_thresh_bg": bool,
    "background_image": InputPathType,
    "bg_thresh": list[float],
    "full_bg_range": bool,
    "out_file": typing.NotRequired[str | None],
    "out_type": typing.NotRequired[typing.Literal["float", "int"] | None],
    "output_type": typing.NotRequired[typing.Literal["NIFTI", "NIFTI_PAIR", "NIFTI_GZ", "NIFTI_PAIR_GZ"] | None],
    "stat_image": InputPathType,
    "stat_image2": typing.NotRequired[InputPathType | None],
    "stat_thresh": list[float],
    "stat_thresh2": typing.NotRequired[list[float] | None],
    "use_checkerboard": bool,
})
OverlayParamsDict = _OverlayParamsDictNoTag | OverlayParamsDictTagged


class OverlayOutputs(typing.NamedTuple):
    """
    Output object returned when calling `OverlayParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    out_file_outfile: OutputPathType | None
    """Combined image volume."""


def overlay_params(
    background_image: InputPathType,
    bg_thresh: list[float],
    stat_image: InputPathType,
    stat_thresh: list[float],
    auto_thresh_bg: bool = False,
    full_bg_range: bool = False,
    out_file: str | None = None,
    out_type: typing.Literal["float", "int"] | None = None,
    output_type: typing.Literal["NIFTI", "NIFTI_PAIR", "NIFTI_GZ", "NIFTI_PAIR_GZ"] | None = None,
    stat_image2: InputPathType | None = None,
    stat_thresh2: list[float] | None = None,
    use_checkerboard: bool = False,
) -> OverlayParamsDictTagged:
    """
    Build parameters.
    
    Args:
        background_image: Image to use as background.
        bg_thresh: (a float, a float). Min and max values for background\
            intensity.
        stat_image: Statistical image to overlay in color.
        stat_thresh: (a float, a float). Min and max values for the statistical\
            overlay.
        auto_thresh_bg: Automatically threshold the background image.
        full_bg_range: Use full range of background image.
        out_file: Combined image volume.
        out_type: 'float' or 'int'. Write output with float or int.
        output_type: 'nifti' or 'nifti_pair' or 'nifti_gz' or 'nifti_pair_gz'.\
            Fsl output type.
        stat_image2: Second statistical image to overlay in color.
        stat_thresh2: (a float, a float). Min and max values for second\
            statistical overlay.
        use_checkerboard: Use checkerboard mask for overlay.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "fsl/overlay",
        "auto_thresh_bg": auto_thresh_bg,
        "background_image": background_image,
        "bg_thresh": bg_thresh,
        "full_bg_range": full_bg_range,
        "stat_image": stat_image,
        "stat_thresh": stat_thresh,
        "use_checkerboard": use_checkerboard,
    }
    if out_file is not None:
        params["out_file"] = out_file
    if out_type is not None:
        params["out_type"] = out_type
    if output_type is not None:
        params["output_type"] = output_type
    if stat_image2 is not None:
        params["stat_image2"] = stat_image2
    if stat_thresh2 is not None:
        params["stat_thresh2"] = stat_thresh2
    return params


def overlay_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `OverlayParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("auto_thresh_bg", False) is None:
        raise StyxValidationError("`auto_thresh_bg` must not be None")
    if not isinstance(params["auto_thresh_bg"], bool):
        raise StyxValidationError(f'`auto_thresh_bg` has the wrong type: Received `{type(params.get("auto_thresh_bg", False))}` expected `bool`')
    if params.get("background_image", None) is None:
        raise StyxValidationError("`background_image` must not be None")
    if not isinstance(params["background_image"], (pathlib.Path, str)):
        raise StyxValidationError(f'`background_image` has the wrong type: Received `{type(params.get("background_image", None))}` expected `InputPathType`')
    if params.get("bg_thresh", None) is None:
        raise StyxValidationError("`bg_thresh` must not be None")
    if not isinstance(params["bg_thresh"], list):
        raise StyxValidationError(f'`bg_thresh` has the wrong type: Received `{type(params.get("bg_thresh", None))}` expected `list[float]`')
    if len(params["bg_thresh"]) != 2:
        raise StyxValidationError("Parameter `bg_thresh` must contain exactly 2 elements")
    for e in params["bg_thresh"]:
        if not isinstance(e, (float, int)):
            raise StyxValidationError(f'`bg_thresh` has the wrong type: Received `{type(params.get("bg_thresh", None))}` expected `list[float]`')
    if params.get("full_bg_range", False) is None:
        raise StyxValidationError("`full_bg_range` must not be None")
    if not isinstance(params["full_bg_range"], bool):
        raise StyxValidationError(f'`full_bg_range` has the wrong type: Received `{type(params.get("full_bg_range", False))}` expected `bool`')
    if params.get("out_file", None) is not None:
        if not isinstance(params["out_file"], str):
            raise StyxValidationError(f'`out_file` has the wrong type: Received `{type(params.get("out_file", None))}` expected `str | None`')
    if params.get("out_type", None) is not None:
        if not isinstance(params["out_type"], str):
            raise StyxValidationError(f'`out_type` has the wrong type: Received `{type(params.get("out_type", None))}` expected `typing.Literal["float", "int"] | None`')
        if params["out_type"] not in ["float", "int"]:
            raise StyxValidationError("Parameter `out_type` must be one of [\"float\", \"int\"]")
    if params.get("output_type", None) is not None:
        if not isinstance(params["output_type"], str):
            raise StyxValidationError(f'`output_type` has the wrong type: Received `{type(params.get("output_type", None))}` expected `typing.Literal["NIFTI", "NIFTI_PAIR", "NIFTI_GZ", "NIFTI_PAIR_GZ"] | None`')
        if params["output_type"] not in ["NIFTI", "NIFTI_PAIR", "NIFTI_GZ", "NIFTI_PAIR_GZ"]:
            raise StyxValidationError("Parameter `output_type` must be one of [\"NIFTI\", \"NIFTI_PAIR\", \"NIFTI_GZ\", \"NIFTI_PAIR_GZ\"]")
    if params.get("stat_image", None) is None:
        raise StyxValidationError("`stat_image` must not be None")
    if not isinstance(params["stat_image"], (pathlib.Path, str)):
        raise StyxValidationError(f'`stat_image` has the wrong type: Received `{type(params.get("stat_image", None))}` expected `InputPathType`')
    if params.get("stat_image2", None) is not None:
        if not isinstance(params["stat_image2"], (pathlib.Path, str)):
            raise StyxValidationError(f'`stat_image2` has the wrong type: Received `{type(params.get("stat_image2", None))}` expected `InputPathType | None`')
    if params.get("stat_thresh", None) is None:
        raise StyxValidationError("`stat_thresh` must not be None")
    if not isinstance(params["stat_thresh"], list):
        raise StyxValidationError(f'`stat_thresh` has the wrong type: Received `{type(params.get("stat_thresh", None))}` expected `list[float]`')
    if len(params["stat_thresh"]) != 2:
        raise StyxValidationError("Parameter `stat_thresh` must contain exactly 2 elements")
    for e in params["stat_thresh"]:
        if not isinstance(e, (float, int)):
            raise StyxValidationError(f'`stat_thresh` has the wrong type: Received `{type(params.get("stat_thresh", None))}` expected `list[float]`')
    if params.get("stat_thresh2", None) is not None:
        if not isinstance(params["stat_thresh2"], list):
            raise StyxValidationError(f'`stat_thresh2` has the wrong type: Received `{type(params.get("stat_thresh2", None))}` expected `list[float] | None`')
        if len(params["stat_thresh2"]) != 2:
            raise StyxValidationError("Parameter `stat_thresh2` must contain exactly 2 elements")
        for e in params["stat_thresh2"]:
            if not isinstance(e, (float, int)):
                raise StyxValidationError(f'`stat_thresh2` has the wrong type: Received `{type(params.get("stat_thresh2", None))}` expected `list[float] | None`')
    if params.get("use_checkerboard", False) is None:
        raise StyxValidationError("`use_checkerboard` must not be None")
    if not isinstance(params["use_checkerboard"], bool):
        raise StyxValidationError(f'`use_checkerboard` has the wrong type: Received `{type(params.get("use_checkerboard", False))}` expected `bool`')


def overlay_cargs(
    params: OverlayParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("overlay")
    if params.get("auto_thresh_bg", False):
        cargs.append("-a")
    cargs.append(execution.input_file(params.get("background_image", None)))
    cargs.extend(map(str, params.get("bg_thresh", None)))
    if params.get("full_bg_range", False):
        cargs.append("-A")
    if params.get("out_file", None) is not None:
        cargs.append(params.get("out_file", None))
    if params.get("out_type", None) is not None:
        cargs.append(params.get("out_type", None))
    if params.get("output_type", None) is not None:
        cargs.append(params.get("output_type", None))
    cargs.append(execution.input_file(params.get("stat_image", None)))
    if params.get("stat_image2", None) is not None:
        cargs.append(execution.input_file(params.get("stat_image2", None)))
    cargs.extend(map(str, params.get("stat_thresh", None)))
    if params.get("stat_thresh2", None) is not None:
        cargs.extend(map(str, params.get("stat_thresh2", None)))
    if params.get("use_checkerboard", False):
        cargs.append("-c")
    return cargs


def overlay_outputs(
    params: OverlayParamsDict,
    execution: Execution,
) -> OverlayOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = OverlayOutputs(
        root=execution.output_file("."),
        out_file_outfile=execution.output_file(params.get("out_file", None)) if (params.get("out_file") is not None) else None,
    )
    return ret


def overlay_execute(
    params: OverlayParamsDict,
    runner: Runner | None = None,
) -> OverlayOutputs:
    """
    overlay
    
    Use FSL's overlay command to combine background and statistical images into
    one volume.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `OverlayOutputs`).
    """
    overlay_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(OVERLAY_METADATA)
    params = execution.params(params)
    cargs = overlay_cargs(params, execution)
    ret = overlay_outputs(params, execution)
    execution.run(cargs)
    return ret


def overlay(
    background_image: InputPathType,
    bg_thresh: list[float],
    stat_image: InputPathType,
    stat_thresh: list[float],
    auto_thresh_bg: bool = False,
    full_bg_range: bool = False,
    out_file: str | None = None,
    out_type: typing.Literal["float", "int"] | None = None,
    output_type: typing.Literal["NIFTI", "NIFTI_PAIR", "NIFTI_GZ", "NIFTI_PAIR_GZ"] | None = None,
    stat_image2: InputPathType | None = None,
    stat_thresh2: list[float] | None = None,
    use_checkerboard: bool = False,
    runner: Runner | None = None,
) -> OverlayOutputs:
    """
    overlay
    
    Use FSL's overlay command to combine background and statistical images into
    one volume.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        background_image: Image to use as background.
        bg_thresh: (a float, a float). Min and max values for background\
            intensity.
        stat_image: Statistical image to overlay in color.
        stat_thresh: (a float, a float). Min and max values for the statistical\
            overlay.
        auto_thresh_bg: Automatically threshold the background image.
        full_bg_range: Use full range of background image.
        out_file: Combined image volume.
        out_type: 'float' or 'int'. Write output with float or int.
        output_type: 'nifti' or 'nifti_pair' or 'nifti_gz' or 'nifti_pair_gz'.\
            Fsl output type.
        stat_image2: Second statistical image to overlay in color.
        stat_thresh2: (a float, a float). Min and max values for second\
            statistical overlay.
        use_checkerboard: Use checkerboard mask for overlay.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `OverlayOutputs`).
    """
    params = overlay_params(
        auto_thresh_bg=auto_thresh_bg,
        background_image=background_image,
        bg_thresh=bg_thresh,
        full_bg_range=full_bg_range,
        out_file=out_file,
        out_type=out_type,
        output_type=output_type,
        stat_image=stat_image,
        stat_image2=stat_image2,
        stat_thresh=stat_thresh,
        stat_thresh2=stat_thresh2,
        use_checkerboard=use_checkerboard,
    )
    return overlay_execute(params, runner)


__all__ = [
    "OVERLAY_METADATA",
    "OverlayOutputs",
    "OverlayParamsDict",
    "OverlayParamsDictTagged",
    "overlay",
    "overlay_execute",
    "overlay_params",
]
