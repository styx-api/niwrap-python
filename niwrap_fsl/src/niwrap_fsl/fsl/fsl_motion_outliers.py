# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

FSL_MOTION_OUTLIERS_METADATA = Metadata(
    id="f18cbc5202296cebe79755786c77cab45770bd5f.boutiques",
    name="fsl_motion_outliers",
    package="fsl",
    container_image_tag="brainlife/fsl:6.0.4-patched2",
)


_FslMotionOutliersParamsDictNoTag = typing.TypedDict('_FslMotionOutliersParamsDictNoTag', {
    "input_4d_image": InputPathType,
    "output_confound_file": str,
    "mask_image": typing.NotRequired[InputPathType | None],
    "save_metric_file": typing.NotRequired[str | None],
    "save_metric_plot": typing.NotRequired[str | None],
    "temp_path": typing.NotRequired[str | None],
    "refrms_flag": bool,
    "dvars_flag": bool,
    "refmse_flag": bool,
    "fd_flag": bool,
    "fdrms_flag": bool,
    "abs_thresh": typing.NotRequired[float | None],
    "no_moco_flag": bool,
    "dummy_scans": typing.NotRequired[float | None],
    "verbose_flag": bool,
})
FslMotionOutliersParamsDictTagged = typing.TypedDict('FslMotionOutliersParamsDictTagged', {
    "@type": typing.Literal["fsl/fsl_motion_outliers"],
    "input_4d_image": InputPathType,
    "output_confound_file": str,
    "mask_image": typing.NotRequired[InputPathType | None],
    "save_metric_file": typing.NotRequired[str | None],
    "save_metric_plot": typing.NotRequired[str | None],
    "temp_path": typing.NotRequired[str | None],
    "refrms_flag": bool,
    "dvars_flag": bool,
    "refmse_flag": bool,
    "fd_flag": bool,
    "fdrms_flag": bool,
    "abs_thresh": typing.NotRequired[float | None],
    "no_moco_flag": bool,
    "dummy_scans": typing.NotRequired[float | None],
    "verbose_flag": bool,
})
FslMotionOutliersParamsDict = _FslMotionOutliersParamsDictNoTag | FslMotionOutliersParamsDictTagged


class FslMotionOutliersOutputs(typing.NamedTuple):
    """
    Output object returned when calling `FslMotionOutliersParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    output_confound_file: OutputPathType
    """Main output confound file"""
    metric_text_file: OutputPathType | None
    """Metric values saved as text file"""
    metric_plot_file: OutputPathType | None
    """Metric values saved as graphical plot (png format)"""


def fsl_motion_outliers_params(
    input_4d_image: InputPathType,
    output_confound_file: str,
    mask_image: InputPathType | None = None,
    save_metric_file: str | None = None,
    save_metric_plot: str | None = None,
    temp_path: str | None = None,
    refrms_flag: bool = False,
    dvars_flag: bool = False,
    refmse_flag: bool = False,
    fd_flag: bool = False,
    fdrms_flag: bool = False,
    abs_thresh: float | None = None,
    no_moco_flag: bool = False,
    dummy_scans: float | None = None,
    verbose_flag: bool = False,
) -> FslMotionOutliersParamsDictTagged:
    """
    Build parameters.
    
    Args:
        input_4d_image: Input 4D image (e.g. 4D.nii.gz).
        output_confound_file: Output confound file (e.g. confounds.txt).
        mask_image: Use supplied mask image for calculating metric.
        save_metric_file: Save metric values (e.g. DVARS) as text into\
            specified file.
        save_metric_plot: Save metric values (e.g. DVARS) as a graphical plot\
            (png format).
        temp_path: [Optional] Path to the location where temporary files should\
            be created. Defaults to /tmp.
        refrms_flag: Use RMS intensity difference to reference volume as metric.
        dvars_flag: Use DVARS as metric.
        refmse_flag: Mean Square Error version of --refrms (used in original\
            version of fsl_motion_outliers).
        fd_flag: Use FD (framewise displacement) as metric.
        fdrms_flag: Use FD with RMS matrix calculation as metric.
        abs_thresh: Specify absolute threshold value (otherwise use box-plot\
            cutoff = P75 + 1.5*IQR).
        no_moco_flag: Do not run motion correction (assumed already done).
        dummy_scans: Specify number of dummy scans to delete (before running\
            anything and creating EVs).
        verbose_flag: Verbose mode.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "fsl/fsl_motion_outliers",
        "input_4d_image": input_4d_image,
        "output_confound_file": output_confound_file,
        "refrms_flag": refrms_flag,
        "dvars_flag": dvars_flag,
        "refmse_flag": refmse_flag,
        "fd_flag": fd_flag,
        "fdrms_flag": fdrms_flag,
        "no_moco_flag": no_moco_flag,
        "verbose_flag": verbose_flag,
    }
    if mask_image is not None:
        params["mask_image"] = mask_image
    if save_metric_file is not None:
        params["save_metric_file"] = save_metric_file
    if save_metric_plot is not None:
        params["save_metric_plot"] = save_metric_plot
    if temp_path is not None:
        params["temp_path"] = temp_path
    if abs_thresh is not None:
        params["abs_thresh"] = abs_thresh
    if dummy_scans is not None:
        params["dummy_scans"] = dummy_scans
    return params


def fsl_motion_outliers_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `FslMotionOutliersParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("input_4d_image", None) is None:
        raise StyxValidationError("`input_4d_image` must not be None")
    if not isinstance(params["input_4d_image"], (pathlib.Path, str)):
        raise StyxValidationError(f'`input_4d_image` has the wrong type: Received `{type(params.get("input_4d_image", None))}` expected `InputPathType`')
    if params.get("output_confound_file", None) is None:
        raise StyxValidationError("`output_confound_file` must not be None")
    if not isinstance(params["output_confound_file"], str):
        raise StyxValidationError(f'`output_confound_file` has the wrong type: Received `{type(params.get("output_confound_file", None))}` expected `str`')
    if params.get("mask_image", None) is not None:
        if not isinstance(params["mask_image"], (pathlib.Path, str)):
            raise StyxValidationError(f'`mask_image` has the wrong type: Received `{type(params.get("mask_image", None))}` expected `InputPathType | None`')
    if params.get("save_metric_file", None) is not None:
        if not isinstance(params["save_metric_file"], str):
            raise StyxValidationError(f'`save_metric_file` has the wrong type: Received `{type(params.get("save_metric_file", None))}` expected `str | None`')
    if params.get("save_metric_plot", None) is not None:
        if not isinstance(params["save_metric_plot"], str):
            raise StyxValidationError(f'`save_metric_plot` has the wrong type: Received `{type(params.get("save_metric_plot", None))}` expected `str | None`')
    if params.get("temp_path", None) is not None:
        if not isinstance(params["temp_path"], str):
            raise StyxValidationError(f'`temp_path` has the wrong type: Received `{type(params.get("temp_path", None))}` expected `str | None`')
    if params.get("refrms_flag", False) is None:
        raise StyxValidationError("`refrms_flag` must not be None")
    if not isinstance(params["refrms_flag"], bool):
        raise StyxValidationError(f'`refrms_flag` has the wrong type: Received `{type(params.get("refrms_flag", False))}` expected `bool`')
    if params.get("dvars_flag", False) is None:
        raise StyxValidationError("`dvars_flag` must not be None")
    if not isinstance(params["dvars_flag"], bool):
        raise StyxValidationError(f'`dvars_flag` has the wrong type: Received `{type(params.get("dvars_flag", False))}` expected `bool`')
    if params.get("refmse_flag", False) is None:
        raise StyxValidationError("`refmse_flag` must not be None")
    if not isinstance(params["refmse_flag"], bool):
        raise StyxValidationError(f'`refmse_flag` has the wrong type: Received `{type(params.get("refmse_flag", False))}` expected `bool`')
    if params.get("fd_flag", False) is None:
        raise StyxValidationError("`fd_flag` must not be None")
    if not isinstance(params["fd_flag"], bool):
        raise StyxValidationError(f'`fd_flag` has the wrong type: Received `{type(params.get("fd_flag", False))}` expected `bool`')
    if params.get("fdrms_flag", False) is None:
        raise StyxValidationError("`fdrms_flag` must not be None")
    if not isinstance(params["fdrms_flag"], bool):
        raise StyxValidationError(f'`fdrms_flag` has the wrong type: Received `{type(params.get("fdrms_flag", False))}` expected `bool`')
    if params.get("abs_thresh", None) is not None:
        if not isinstance(params["abs_thresh"], (float, int)):
            raise StyxValidationError(f'`abs_thresh` has the wrong type: Received `{type(params.get("abs_thresh", None))}` expected `float | None`')
    if params.get("no_moco_flag", False) is None:
        raise StyxValidationError("`no_moco_flag` must not be None")
    if not isinstance(params["no_moco_flag"], bool):
        raise StyxValidationError(f'`no_moco_flag` has the wrong type: Received `{type(params.get("no_moco_flag", False))}` expected `bool`')
    if params.get("dummy_scans", None) is not None:
        if not isinstance(params["dummy_scans"], (float, int)):
            raise StyxValidationError(f'`dummy_scans` has the wrong type: Received `{type(params.get("dummy_scans", None))}` expected `float | None`')
    if params.get("verbose_flag", False) is None:
        raise StyxValidationError("`verbose_flag` must not be None")
    if not isinstance(params["verbose_flag"], bool):
        raise StyxValidationError(f'`verbose_flag` has the wrong type: Received `{type(params.get("verbose_flag", False))}` expected `bool`')


def fsl_motion_outliers_cargs(
    params: FslMotionOutliersParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("fsl_motion_outliers")
    cargs.extend([
        "-i",
        execution.input_file(params.get("input_4d_image", None))
    ])
    cargs.extend([
        "-o",
        params.get("output_confound_file", None)
    ])
    if params.get("mask_image", None) is not None:
        cargs.extend([
            "-m",
            execution.input_file(params.get("mask_image", None))
        ])
    if params.get("save_metric_file", None) is not None:
        cargs.extend([
            "-s",
            params.get("save_metric_file", None)
        ])
    if params.get("save_metric_plot", None) is not None:
        cargs.extend([
            "-p",
            params.get("save_metric_plot", None)
        ])
    if params.get("temp_path", None) is not None:
        cargs.extend([
            "-t",
            params.get("temp_path", None)
        ])
    if params.get("refrms_flag", False):
        cargs.append("--refrms")
    if params.get("dvars_flag", False):
        cargs.append("--dvars")
    if params.get("refmse_flag", False):
        cargs.append("--refmse")
    if params.get("fd_flag", False):
        cargs.append("--fd")
    if params.get("fdrms_flag", False):
        cargs.append("--fdrms")
    if params.get("abs_thresh", None) is not None:
        cargs.extend([
            "--thresh",
            str(params.get("abs_thresh", None))
        ])
    if params.get("no_moco_flag", False):
        cargs.append("--nomoco")
    if params.get("dummy_scans", None) is not None:
        cargs.extend([
            "--dummy",
            str(params.get("dummy_scans", None))
        ])
    if params.get("verbose_flag", False):
        cargs.append("-v")
    return cargs


def fsl_motion_outliers_outputs(
    params: FslMotionOutliersParamsDict,
    execution: Execution,
) -> FslMotionOutliersOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = FslMotionOutliersOutputs(
        root=execution.output_file("."),
        output_confound_file=execution.output_file(params.get("output_confound_file", None)),
        metric_text_file=execution.output_file(params.get("save_metric_file", None)) if (params.get("save_metric_file") is not None) else None,
        metric_plot_file=execution.output_file(params.get("save_metric_plot", None)) if (params.get("save_metric_plot") is not None) else None,
    )
    return ret


def fsl_motion_outliers_execute(
    params: FslMotionOutliersParamsDict,
    runner: Runner | None = None,
) -> FslMotionOutliersOutputs:
    """
    fsl_motion_outliers
    
    FSL tool used to calculate motion outliers in 4D image data.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `FslMotionOutliersOutputs`).
    """
    fsl_motion_outliers_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(FSL_MOTION_OUTLIERS_METADATA)
    params = execution.params(params)
    cargs = fsl_motion_outliers_cargs(params, execution)
    ret = fsl_motion_outliers_outputs(params, execution)
    execution.run(cargs)
    return ret


def fsl_motion_outliers(
    input_4d_image: InputPathType,
    output_confound_file: str,
    mask_image: InputPathType | None = None,
    save_metric_file: str | None = None,
    save_metric_plot: str | None = None,
    temp_path: str | None = None,
    refrms_flag: bool = False,
    dvars_flag: bool = False,
    refmse_flag: bool = False,
    fd_flag: bool = False,
    fdrms_flag: bool = False,
    abs_thresh: float | None = None,
    no_moco_flag: bool = False,
    dummy_scans: float | None = None,
    verbose_flag: bool = False,
    runner: Runner | None = None,
) -> FslMotionOutliersOutputs:
    """
    fsl_motion_outliers
    
    FSL tool used to calculate motion outliers in 4D image data.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        input_4d_image: Input 4D image (e.g. 4D.nii.gz).
        output_confound_file: Output confound file (e.g. confounds.txt).
        mask_image: Use supplied mask image for calculating metric.
        save_metric_file: Save metric values (e.g. DVARS) as text into\
            specified file.
        save_metric_plot: Save metric values (e.g. DVARS) as a graphical plot\
            (png format).
        temp_path: [Optional] Path to the location where temporary files should\
            be created. Defaults to /tmp.
        refrms_flag: Use RMS intensity difference to reference volume as metric.
        dvars_flag: Use DVARS as metric.
        refmse_flag: Mean Square Error version of --refrms (used in original\
            version of fsl_motion_outliers).
        fd_flag: Use FD (framewise displacement) as metric.
        fdrms_flag: Use FD with RMS matrix calculation as metric.
        abs_thresh: Specify absolute threshold value (otherwise use box-plot\
            cutoff = P75 + 1.5*IQR).
        no_moco_flag: Do not run motion correction (assumed already done).
        dummy_scans: Specify number of dummy scans to delete (before running\
            anything and creating EVs).
        verbose_flag: Verbose mode.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `FslMotionOutliersOutputs`).
    """
    params = fsl_motion_outliers_params(
        input_4d_image=input_4d_image,
        output_confound_file=output_confound_file,
        mask_image=mask_image,
        save_metric_file=save_metric_file,
        save_metric_plot=save_metric_plot,
        temp_path=temp_path,
        refrms_flag=refrms_flag,
        dvars_flag=dvars_flag,
        refmse_flag=refmse_flag,
        fd_flag=fd_flag,
        fdrms_flag=fdrms_flag,
        abs_thresh=abs_thresh,
        no_moco_flag=no_moco_flag,
        dummy_scans=dummy_scans,
        verbose_flag=verbose_flag,
    )
    return fsl_motion_outliers_execute(params, runner)


__all__ = [
    "FSL_MOTION_OUTLIERS_METADATA",
    "FslMotionOutliersOutputs",
    "FslMotionOutliersParamsDict",
    "FslMotionOutliersParamsDictTagged",
    "fsl_motion_outliers",
    "fsl_motion_outliers_execute",
    "fsl_motion_outliers_params",
]
