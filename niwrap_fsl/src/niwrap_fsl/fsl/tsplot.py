# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

TSPLOT_METADATA = Metadata(
    id="410bf87214e77b8762f8ea8905b226f5f36de93c.boutiques",
    name="tsplot",
    package="fsl",
    container_image_tag="brainlife/fsl:6.0.4-patched2",
)


_TsplotParamsDictNoTag = typing.TypedDict('_TsplotParamsDictNoTag', {
    "input_directory": str,
    "main_filtered_data": typing.NotRequired[InputPathType | None],
    "coordinates": typing.NotRequired[list[float] | None],
    "coordinates_output": typing.NotRequired[list[float] | None],
    "mask": typing.NotRequired[InputPathType | None],
    "output_directory": typing.NotRequired[str | None],
    "no_weight_flag": bool,
    "prewhiten_flag": bool,
    "no_raw_flag": bool,
})
TsplotParamsDictTagged = typing.TypedDict('TsplotParamsDictTagged', {
    "@type": typing.Literal["fsl/tsplot"],
    "input_directory": str,
    "main_filtered_data": typing.NotRequired[InputPathType | None],
    "coordinates": typing.NotRequired[list[float] | None],
    "coordinates_output": typing.NotRequired[list[float] | None],
    "mask": typing.NotRequired[InputPathType | None],
    "output_directory": typing.NotRequired[str | None],
    "no_weight_flag": bool,
    "prewhiten_flag": bool,
    "no_raw_flag": bool,
})
TsplotParamsDict = _TsplotParamsDictNoTag | TsplotParamsDictTagged


class TsplotOutputs(typing.NamedTuple):
    """
    Output object returned when calling `TsplotParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    timeseries_output: OutputPathType | None
    """Output timeseries data"""


def tsplot_params(
    input_directory: str,
    main_filtered_data: InputPathType | None = None,
    coordinates: list[float] | None = None,
    coordinates_output: list[float] | None = None,
    mask: InputPathType | None = None,
    output_directory: str | None = None,
    no_weight_flag: bool = False,
    prewhiten_flag: bool = False,
    no_raw_flag: bool = False,
) -> TsplotParamsDictTagged:
    """
    Build parameters.
    
    Args:
        input_directory: Input FEAT directory (e.g. feat_directory.feat).
        main_filtered_data: Input main filtered data, in case it's not\
            <feat_directory.feat>/filtered_func_data.
        coordinates: Use X, Y, Z instead of max Z stat position.
        coordinates_output: Use X,Y,Z to output time series only - no stats or\
            modelling.
        mask: Use mask image instead of thresholded activation images.
        output_directory: Change output directory from default of input FEAT\
            directory.
        no_weight_flag: Don't weight cluster averaging with Z stats.
        prewhiten_flag: Prewhiten data and model timeseries before plotting.
        no_raw_flag: Don't keep raw data text files.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "fsl/tsplot",
        "input_directory": input_directory,
        "no_weight_flag": no_weight_flag,
        "prewhiten_flag": prewhiten_flag,
        "no_raw_flag": no_raw_flag,
    }
    if main_filtered_data is not None:
        params["main_filtered_data"] = main_filtered_data
    if coordinates is not None:
        params["coordinates"] = coordinates
    if coordinates_output is not None:
        params["coordinates_output"] = coordinates_output
    if mask is not None:
        params["mask"] = mask
    if output_directory is not None:
        params["output_directory"] = output_directory
    return params


def tsplot_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `TsplotParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("input_directory", None) is None:
        raise StyxValidationError("`input_directory` must not be None")
    if not isinstance(params["input_directory"], str):
        raise StyxValidationError(f'`input_directory` has the wrong type: Received `{type(params.get("input_directory", None))}` expected `str`')
    if params.get("main_filtered_data", None) is not None:
        if not isinstance(params["main_filtered_data"], (pathlib.Path, str)):
            raise StyxValidationError(f'`main_filtered_data` has the wrong type: Received `{type(params.get("main_filtered_data", None))}` expected `InputPathType | None`')
    if params.get("coordinates", None) is not None:
        if not isinstance(params["coordinates"], list):
            raise StyxValidationError(f'`coordinates` has the wrong type: Received `{type(params.get("coordinates", None))}` expected `list[float] | None`')
        if len(params["coordinates"]) != 3:
            raise StyxValidationError("Parameter `coordinates` must contain exactly 3 elements")
        for e in params["coordinates"]:
            if not isinstance(e, (float, int)):
                raise StyxValidationError(f'`coordinates` has the wrong type: Received `{type(params.get("coordinates", None))}` expected `list[float] | None`')
    if params.get("coordinates_output", None) is not None:
        if not isinstance(params["coordinates_output"], list):
            raise StyxValidationError(f'`coordinates_output` has the wrong type: Received `{type(params.get("coordinates_output", None))}` expected `list[float] | None`')
        if len(params["coordinates_output"]) != 3:
            raise StyxValidationError("Parameter `coordinates_output` must contain exactly 3 elements")
        for e in params["coordinates_output"]:
            if not isinstance(e, (float, int)):
                raise StyxValidationError(f'`coordinates_output` has the wrong type: Received `{type(params.get("coordinates_output", None))}` expected `list[float] | None`')
    if params.get("mask", None) is not None:
        if not isinstance(params["mask"], (pathlib.Path, str)):
            raise StyxValidationError(f'`mask` has the wrong type: Received `{type(params.get("mask", None))}` expected `InputPathType | None`')
    if params.get("output_directory", None) is not None:
        if not isinstance(params["output_directory"], str):
            raise StyxValidationError(f'`output_directory` has the wrong type: Received `{type(params.get("output_directory", None))}` expected `str | None`')
    if params.get("no_weight_flag", False) is None:
        raise StyxValidationError("`no_weight_flag` must not be None")
    if not isinstance(params["no_weight_flag"], bool):
        raise StyxValidationError(f'`no_weight_flag` has the wrong type: Received `{type(params.get("no_weight_flag", False))}` expected `bool`')
    if params.get("prewhiten_flag", False) is None:
        raise StyxValidationError("`prewhiten_flag` must not be None")
    if not isinstance(params["prewhiten_flag"], bool):
        raise StyxValidationError(f'`prewhiten_flag` has the wrong type: Received `{type(params.get("prewhiten_flag", False))}` expected `bool`')
    if params.get("no_raw_flag", False) is None:
        raise StyxValidationError("`no_raw_flag` must not be None")
    if not isinstance(params["no_raw_flag"], bool):
        raise StyxValidationError(f'`no_raw_flag` has the wrong type: Received `{type(params.get("no_raw_flag", False))}` expected `bool`')


def tsplot_cargs(
    params: TsplotParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("tsplot")
    cargs.append(params.get("input_directory", None))
    if params.get("main_filtered_data", None) is not None:
        cargs.extend([
            "-f",
            execution.input_file(params.get("main_filtered_data", None))
        ])
    if params.get("coordinates", None) is not None:
        cargs.extend([
            "-c",
            *map(str, params.get("coordinates", None))
        ])
    if params.get("coordinates_output", None) is not None:
        cargs.extend([
            "-C",
            *map(str, params.get("coordinates_output", None))
        ])
    if params.get("mask", None) is not None:
        cargs.extend([
            "-m",
            execution.input_file(params.get("mask", None))
        ])
    if params.get("output_directory", None) is not None:
        cargs.extend([
            "-o",
            params.get("output_directory", None)
        ])
    if params.get("no_weight_flag", False):
        cargs.append("-n")
    if params.get("prewhiten_flag", False):
        cargs.append("-p")
    if params.get("no_raw_flag", False):
        cargs.append("-d")
    return cargs


def tsplot_outputs(
    params: TsplotParamsDict,
    execution: Execution,
) -> TsplotOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = TsplotOutputs(
        root=execution.output_file("."),
        timeseries_output=execution.output_file(params.get("output_directory", None) + "/timeseries.txt") if (params.get("output_directory") is not None) else None,
    )
    return ret


def tsplot_execute(
    params: TsplotParamsDict,
    runner: Runner | None = None,
) -> TsplotOutputs:
    """
    tsplot
    
    Time series plotting tool for FSL.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `TsplotOutputs`).
    """
    tsplot_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(TSPLOT_METADATA)
    params = execution.params(params)
    cargs = tsplot_cargs(params, execution)
    ret = tsplot_outputs(params, execution)
    execution.run(cargs)
    return ret


def tsplot(
    input_directory: str,
    main_filtered_data: InputPathType | None = None,
    coordinates: list[float] | None = None,
    coordinates_output: list[float] | None = None,
    mask: InputPathType | None = None,
    output_directory: str | None = None,
    no_weight_flag: bool = False,
    prewhiten_flag: bool = False,
    no_raw_flag: bool = False,
    runner: Runner | None = None,
) -> TsplotOutputs:
    """
    tsplot
    
    Time series plotting tool for FSL.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        input_directory: Input FEAT directory (e.g. feat_directory.feat).
        main_filtered_data: Input main filtered data, in case it's not\
            <feat_directory.feat>/filtered_func_data.
        coordinates: Use X, Y, Z instead of max Z stat position.
        coordinates_output: Use X,Y,Z to output time series only - no stats or\
            modelling.
        mask: Use mask image instead of thresholded activation images.
        output_directory: Change output directory from default of input FEAT\
            directory.
        no_weight_flag: Don't weight cluster averaging with Z stats.
        prewhiten_flag: Prewhiten data and model timeseries before plotting.
        no_raw_flag: Don't keep raw data text files.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `TsplotOutputs`).
    """
    params = tsplot_params(
        input_directory=input_directory,
        main_filtered_data=main_filtered_data,
        coordinates=coordinates,
        coordinates_output=coordinates_output,
        mask=mask,
        output_directory=output_directory,
        no_weight_flag=no_weight_flag,
        prewhiten_flag=prewhiten_flag,
        no_raw_flag=no_raw_flag,
    )
    return tsplot_execute(params, runner)


__all__ = [
    "TSPLOT_METADATA",
    "TsplotOutputs",
    "TsplotParamsDict",
    "TsplotParamsDictTagged",
    "tsplot",
    "tsplot_execute",
    "tsplot_params",
]
