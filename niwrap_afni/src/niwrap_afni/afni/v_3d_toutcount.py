# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

V_3D_TOUTCOUNT_METADATA = Metadata(
    id="9193883305e8473f3547bb336f7df4ae106042f8.boutiques",
    name="3dToutcount",
    package="afni",
    container_image_tag="afni/afni_make_build:AFNI_24.2.06",
)


_V3dToutcountParamsDictNoTag = typing.TypedDict('_V3dToutcountParamsDictNoTag', {
    "input_dataset": str,
    "output_prefix": typing.NotRequired[str | None],
    "mask_dataset": typing.NotRequired[str | None],
    "q_threshold": typing.NotRequired[float | None],
    "autoclip": bool,
    "automask": bool,
    "fraction": bool,
    "range": bool,
    "polort_order": typing.NotRequired[float | None],
    "legendre": bool,
})
V3dToutcountParamsDictTagged = typing.TypedDict('V3dToutcountParamsDictTagged', {
    "@type": typing.Literal["afni/3dToutcount"],
    "input_dataset": str,
    "output_prefix": typing.NotRequired[str | None],
    "mask_dataset": typing.NotRequired[str | None],
    "q_threshold": typing.NotRequired[float | None],
    "autoclip": bool,
    "automask": bool,
    "fraction": bool,
    "range": bool,
    "polort_order": typing.NotRequired[float | None],
    "legendre": bool,
})
V3dToutcountParamsDict = _V3dToutcountParamsDictNoTag | V3dToutcountParamsDictTagged


class V3dToutcountOutputs(typing.NamedTuple):
    """
    Output object returned when calling `V3dToutcountParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    output_afni_head: OutputPathType | None
    """Output dataset in AFNI format (HEAD file)."""
    output_afni_brik: OutputPathType | None
    """Output dataset in AFNI format (BRIK file)."""


def v_3d_toutcount_params(
    input_dataset: str,
    output_prefix: str | None = None,
    mask_dataset: str | None = None,
    q_threshold: float | None = None,
    autoclip: bool = False,
    automask: bool = False,
    fraction: bool = False,
    range_: bool = False,
    polort_order: float | None = None,
    legendre: bool = False,
) -> V3dToutcountParamsDictTagged:
    """
    Build parameters.
    
    Args:
        input_dataset: Input 3D+time dataset (e.g. dataset+orig).
        output_prefix: Prefix of the new dataset saved with the outlier Q\
            values, applicable with the -save option.
        mask_dataset: Only count voxels in the provided mask dataset.
        q_threshold: Use 'q' instead of 0.001 in the calculation of alpha. Must\
            be within range 0 < q < 1.
        autoclip: Clip off 'small' voxels (as in 3dClipLevel). Cannot use with\
            -mask.
        automask: Automatically mask the dataset. Cannot use with -mask.
        fraction: Output the fraction of (masked) voxels which are outliers at\
            each time point, instead of the count.
        range_: Print out median+3.5*MAD of outlier count with each time point.
        polort_order: Detrend each voxel time series with polynomials of order\
            'nn'. Default value is 0, which removes the median.
        legendre: Use Legendre polynomials for detrending (also allows -polort\
            > 3).
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "afni/3dToutcount",
        "input_dataset": input_dataset,
        "autoclip": autoclip,
        "automask": automask,
        "fraction": fraction,
        "range": range_,
        "legendre": legendre,
    }
    if output_prefix is not None:
        params["output_prefix"] = output_prefix
    if mask_dataset is not None:
        params["mask_dataset"] = mask_dataset
    if q_threshold is not None:
        params["q_threshold"] = q_threshold
    if polort_order is not None:
        params["polort_order"] = polort_order
    return params


def v_3d_toutcount_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `V3dToutcountParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("input_dataset", None) is None:
        raise StyxValidationError("`input_dataset` must not be None")
    if not isinstance(params["input_dataset"], str):
        raise StyxValidationError(f'`input_dataset` has the wrong type: Received `{type(params.get("input_dataset", None))}` expected `str`')
    if params.get("output_prefix", None) is not None:
        if not isinstance(params["output_prefix"], str):
            raise StyxValidationError(f'`output_prefix` has the wrong type: Received `{type(params.get("output_prefix", None))}` expected `str | None`')
    if params.get("mask_dataset", None) is not None:
        if not isinstance(params["mask_dataset"], str):
            raise StyxValidationError(f'`mask_dataset` has the wrong type: Received `{type(params.get("mask_dataset", None))}` expected `str | None`')
    if params.get("q_threshold", None) is not None:
        if not isinstance(params["q_threshold"], (float, int)):
            raise StyxValidationError(f'`q_threshold` has the wrong type: Received `{type(params.get("q_threshold", None))}` expected `float | None`')
        if not (0 <= params["q_threshold"] <= 1):
            raise StyxValidationError("Parameter `q_threshold` must be between 0 and 1 (inclusive)")
    if params.get("autoclip", False) is None:
        raise StyxValidationError("`autoclip` must not be None")
    if not isinstance(params["autoclip"], bool):
        raise StyxValidationError(f'`autoclip` has the wrong type: Received `{type(params.get("autoclip", False))}` expected `bool`')
    if params.get("automask", False) is None:
        raise StyxValidationError("`automask` must not be None")
    if not isinstance(params["automask"], bool):
        raise StyxValidationError(f'`automask` has the wrong type: Received `{type(params.get("automask", False))}` expected `bool`')
    if params.get("fraction", False) is None:
        raise StyxValidationError("`fraction` must not be None")
    if not isinstance(params["fraction"], bool):
        raise StyxValidationError(f'`fraction` has the wrong type: Received `{type(params.get("fraction", False))}` expected `bool`')
    if params.get("range", False) is None:
        raise StyxValidationError("`range` must not be None")
    if not isinstance(params["range"], bool):
        raise StyxValidationError(f'`range` has the wrong type: Received `{type(params.get("range", False))}` expected `bool`')
    if params.get("polort_order", None) is not None:
        if not isinstance(params["polort_order"], (float, int)):
            raise StyxValidationError(f'`polort_order` has the wrong type: Received `{type(params.get("polort_order", None))}` expected `float | None`')
    if params.get("legendre", False) is None:
        raise StyxValidationError("`legendre` must not be None")
    if not isinstance(params["legendre"], bool):
        raise StyxValidationError(f'`legendre` has the wrong type: Received `{type(params.get("legendre", False))}` expected `bool`')


def v_3d_toutcount_cargs(
    params: V3dToutcountParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("3dToutcount")
    cargs.append(params.get("input_dataset", None))
    if params.get("output_prefix", None) is not None:
        cargs.append(params.get("output_prefix", None))
    if params.get("mask_dataset", None) is not None:
        cargs.extend([
            "-mask",
            params.get("mask_dataset", None)
        ])
    if params.get("q_threshold", None) is not None:
        cargs.extend([
            "-qthr",
            str(params.get("q_threshold", None))
        ])
    if params.get("autoclip", False):
        cargs.append("-autoclip")
    if params.get("automask", False):
        cargs.append("-automask")
    if params.get("fraction", False):
        cargs.append("-fraction")
    if params.get("range", False):
        cargs.append("-range")
    if params.get("polort_order", None) is not None:
        cargs.extend([
            "-polort",
            str(params.get("polort_order", None))
        ])
    if params.get("legendre", False):
        cargs.append("-legendre")
    return cargs


def v_3d_toutcount_outputs(
    params: V3dToutcountParamsDict,
    execution: Execution,
) -> V3dToutcountOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = V3dToutcountOutputs(
        root=execution.output_file("."),
        output_afni_head=execution.output_file(params.get("output_prefix", None) + ".HEAD") if (params.get("output_prefix") is not None) else None,
        output_afni_brik=execution.output_file(params.get("output_prefix", None) + ".BRIK") if (params.get("output_prefix") is not None) else None,
    )
    return ret


def v_3d_toutcount_execute(
    params: V3dToutcountParamsDict,
    runner: Runner | None = None,
) -> V3dToutcountOutputs:
    """
    3dToutcount
    
    Calculates the number of 'outliers' in a 3D+time dataset at each time point.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `V3dToutcountOutputs`).
    """
    v_3d_toutcount_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(V_3D_TOUTCOUNT_METADATA)
    params = execution.params(params)
    cargs = v_3d_toutcount_cargs(params, execution)
    ret = v_3d_toutcount_outputs(params, execution)
    execution.run(cargs)
    return ret


def v_3d_toutcount(
    input_dataset: str,
    output_prefix: str | None = None,
    mask_dataset: str | None = None,
    q_threshold: float | None = None,
    autoclip: bool = False,
    automask: bool = False,
    fraction: bool = False,
    range_: bool = False,
    polort_order: float | None = None,
    legendre: bool = False,
    runner: Runner | None = None,
) -> V3dToutcountOutputs:
    """
    3dToutcount
    
    Calculates the number of 'outliers' in a 3D+time dataset at each time point.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        input_dataset: Input 3D+time dataset (e.g. dataset+orig).
        output_prefix: Prefix of the new dataset saved with the outlier Q\
            values, applicable with the -save option.
        mask_dataset: Only count voxels in the provided mask dataset.
        q_threshold: Use 'q' instead of 0.001 in the calculation of alpha. Must\
            be within range 0 < q < 1.
        autoclip: Clip off 'small' voxels (as in 3dClipLevel). Cannot use with\
            -mask.
        automask: Automatically mask the dataset. Cannot use with -mask.
        fraction: Output the fraction of (masked) voxels which are outliers at\
            each time point, instead of the count.
        range_: Print out median+3.5*MAD of outlier count with each time point.
        polort_order: Detrend each voxel time series with polynomials of order\
            'nn'. Default value is 0, which removes the median.
        legendre: Use Legendre polynomials for detrending (also allows -polort\
            > 3).
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `V3dToutcountOutputs`).
    """
    params = v_3d_toutcount_params(
        input_dataset=input_dataset,
        output_prefix=output_prefix,
        mask_dataset=mask_dataset,
        q_threshold=q_threshold,
        autoclip=autoclip,
        automask=automask,
        fraction=fraction,
        range_=range_,
        polort_order=polort_order,
        legendre=legendre,
    )
    return v_3d_toutcount_execute(params, runner)


__all__ = [
    "V3dToutcountOutputs",
    "V3dToutcountParamsDict",
    "V3dToutcountParamsDictTagged",
    "V_3D_TOUTCOUNT_METADATA",
    "v_3d_toutcount",
    "v_3d_toutcount_execute",
    "v_3d_toutcount_params",
]
