# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

FIM2_METADATA = Metadata(
    id="5a4e1f8896d5725c0337f94e013785705278b663.boutiques",
    name="fim2",
    package="afni",
    container_image_tag="afni/afni_make_build:AFNI_24.2.06",
)


_Fim2ParamsDictNoTag = typing.TypedDict('_Fim2ParamsDictNoTag', {
    "image_files": list[InputPathType],
    "pcnt": typing.NotRequired[float | None],
    "pcthresh": typing.NotRequired[float | None],
    "im1": typing.NotRequired[int | None],
    "num": typing.NotRequired[int | None],
    "non": bool,
    "coef": typing.NotRequired[float | None],
    "ort": typing.NotRequired[list[InputPathType] | None],
    "ideal": typing.NotRequired[list[InputPathType] | None],
    "polref": typing.NotRequired[int | None],
    "fimfile": typing.NotRequired[str | None],
    "corr": bool,
    "corfile": typing.NotRequired[str | None],
    "cnrfile": typing.NotRequired[str | None],
    "sigfile": typing.NotRequired[str | None],
    "fitfile": typing.NotRequired[str | None],
    "subort": typing.NotRequired[str | None],
    "flim": bool,
    "clean": bool,
    "clip": bool,
    "q": bool,
    "dfspace": bool,
    "regbase": typing.NotRequired[str | None],
})
Fim2ParamsDictTagged = typing.TypedDict('Fim2ParamsDictTagged', {
    "@type": typing.Literal["afni/fim2"],
    "image_files": list[InputPathType],
    "pcnt": typing.NotRequired[float | None],
    "pcthresh": typing.NotRequired[float | None],
    "im1": typing.NotRequired[int | None],
    "num": typing.NotRequired[int | None],
    "non": bool,
    "coef": typing.NotRequired[float | None],
    "ort": typing.NotRequired[list[InputPathType] | None],
    "ideal": typing.NotRequired[list[InputPathType] | None],
    "polref": typing.NotRequired[int | None],
    "fimfile": typing.NotRequired[str | None],
    "corr": bool,
    "corfile": typing.NotRequired[str | None],
    "cnrfile": typing.NotRequired[str | None],
    "sigfile": typing.NotRequired[str | None],
    "fitfile": typing.NotRequired[str | None],
    "subort": typing.NotRequired[str | None],
    "flim": bool,
    "clean": bool,
    "clip": bool,
    "q": bool,
    "dfspace": bool,
    "regbase": typing.NotRequired[str | None],
})
Fim2ParamsDict = _Fim2ParamsDictNoTag | Fim2ParamsDictTagged


class Fim2Outputs(typing.NamedTuple):
    """
    Output object returned when calling `Fim2ParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    activation_magnitudes: OutputPathType | None
    """Activation magnitudes output file"""
    correlation_image: OutputPathType | None
    """Correlation image output file"""
    contrast_to_noise_image: OutputPathType | None
    """Contrast-to-noise image output file"""
    std_deviation_image: OutputPathType | None
    """Standard deviation image output file"""
    ls_fit_coefficients: OutputPathType | None
    """Least squares fit coefficients image files"""
    subtracted_references: OutputPathType | None
    """Subtracted ortho reference time series images"""


def fim2_params(
    image_files: list[InputPathType],
    pcnt: float | None = None,
    pcthresh: float | None = None,
    im1: int | None = None,
    num: int | None = None,
    non: bool = False,
    coef: float | None = None,
    ort: list[InputPathType] | None = None,
    ideal: list[InputPathType] | None = None,
    polref: int | None = None,
    fimfile: str | None = None,
    corr: bool = False,
    corfile: str | None = None,
    cnrfile: str | None = None,
    sigfile: str | None = None,
    fitfile: str | None = None,
    subort: str | None = None,
    flim: bool = False,
    clean: bool = False,
    clip: bool = False,
    q: bool = False,
    dfspace: bool = False,
    regbase: str | None = None,
) -> Fim2ParamsDictTagged:
    """
    Build parameters.
    
    Args:
        image_files: Input MRI image files.
        pcnt: Correlation coefficient threshold will be 1 - 0.01 * #.
        pcthresh: Correlation coefficient threshold will be #.
        im1: Index of image file to use as first in time series; default is 1.
        num: Number of images to actually use; default is to use all images.
        non: Turn off default normalization of the output activation image.
        coef: Scaling factor to convert the activation output from floats to\
            short ints.
        ort: Filename of a time series to which the image data will be\
            orthogonalized before correlations are computed.
        ideal: Filename of a time series to which the image data is to be\
            correlated.
        polref: Use polynomials of order 0..# as extra 'orts'; default is 0.
        fimfile: Filename to save activation magnitudes in.
        corr: Indicates to write correlation output to image file\
            'fimfile.CORR'.
        corfile: Filename to save correlation image in.
        cnrfile: Filename to save contrast-to-noise image in.
        sigfile: Filename to save standard deviation image in.
        fitfile: Image files of the least squares fit coefficients of all the\
            -ort and -polref time series.
        subort: Filename of the new timeseries of images with the orts and\
            polrefs subtracted out.
        flim: Write outputs in mrilib 'float' format.
        clean: Output images won't have the +/- 10000 values forced into their\
            corners for scaling purposes.
        clip: Set to zero regions of low intensity in output correlations, etc.
        q: Quiet operation mode.
        dfspace: Use the 'dfspace' filter to register the images spatially\
            before filtering.
        regbase: Read image in file 'fname' as the base image for registration.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "afni/fim2",
        "image_files": image_files,
        "non": non,
        "corr": corr,
        "flim": flim,
        "clean": clean,
        "clip": clip,
        "q": q,
        "dfspace": dfspace,
    }
    if pcnt is not None:
        params["pcnt"] = pcnt
    if pcthresh is not None:
        params["pcthresh"] = pcthresh
    if im1 is not None:
        params["im1"] = im1
    if num is not None:
        params["num"] = num
    if coef is not None:
        params["coef"] = coef
    if ort is not None:
        params["ort"] = ort
    if ideal is not None:
        params["ideal"] = ideal
    if polref is not None:
        params["polref"] = polref
    if fimfile is not None:
        params["fimfile"] = fimfile
    if corfile is not None:
        params["corfile"] = corfile
    if cnrfile is not None:
        params["cnrfile"] = cnrfile
    if sigfile is not None:
        params["sigfile"] = sigfile
    if fitfile is not None:
        params["fitfile"] = fitfile
    if subort is not None:
        params["subort"] = subort
    if regbase is not None:
        params["regbase"] = regbase
    return params


def fim2_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid `Fim2ParamsDict`
    object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("image_files", None) is None:
        raise StyxValidationError("`image_files` must not be None")
    if not isinstance(params["image_files"], list):
        raise StyxValidationError(f'`image_files` has the wrong type: Received `{type(params.get("image_files", None))}` expected `list[InputPathType]`')
    for e in params["image_files"]:
        if not isinstance(e, (pathlib.Path, str)):
            raise StyxValidationError(f'`image_files` has the wrong type: Received `{type(params.get("image_files", None))}` expected `list[InputPathType]`')
    if params.get("pcnt", None) is not None:
        if not isinstance(params["pcnt"], (float, int)):
            raise StyxValidationError(f'`pcnt` has the wrong type: Received `{type(params.get("pcnt", None))}` expected `float | None`')
    if params.get("pcthresh", None) is not None:
        if not isinstance(params["pcthresh"], (float, int)):
            raise StyxValidationError(f'`pcthresh` has the wrong type: Received `{type(params.get("pcthresh", None))}` expected `float | None`')
    if params.get("im1", None) is not None:
        if not isinstance(params["im1"], int):
            raise StyxValidationError(f'`im1` has the wrong type: Received `{type(params.get("im1", None))}` expected `int | None`')
    if params.get("num", None) is not None:
        if not isinstance(params["num"], int):
            raise StyxValidationError(f'`num` has the wrong type: Received `{type(params.get("num", None))}` expected `int | None`')
    if params.get("non", False) is None:
        raise StyxValidationError("`non` must not be None")
    if not isinstance(params["non"], bool):
        raise StyxValidationError(f'`non` has the wrong type: Received `{type(params.get("non", False))}` expected `bool`')
    if params.get("coef", None) is not None:
        if not isinstance(params["coef"], (float, int)):
            raise StyxValidationError(f'`coef` has the wrong type: Received `{type(params.get("coef", None))}` expected `float | None`')
    if params.get("ort", None) is not None:
        if not isinstance(params["ort"], list):
            raise StyxValidationError(f'`ort` has the wrong type: Received `{type(params.get("ort", None))}` expected `list[InputPathType] | None`')
        for e in params["ort"]:
            if not isinstance(e, (pathlib.Path, str)):
                raise StyxValidationError(f'`ort` has the wrong type: Received `{type(params.get("ort", None))}` expected `list[InputPathType] | None`')
    if params.get("ideal", None) is not None:
        if not isinstance(params["ideal"], list):
            raise StyxValidationError(f'`ideal` has the wrong type: Received `{type(params.get("ideal", None))}` expected `list[InputPathType] | None`')
        for e in params["ideal"]:
            if not isinstance(e, (pathlib.Path, str)):
                raise StyxValidationError(f'`ideal` has the wrong type: Received `{type(params.get("ideal", None))}` expected `list[InputPathType] | None`')
    if params.get("polref", None) is not None:
        if not isinstance(params["polref"], int):
            raise StyxValidationError(f'`polref` has the wrong type: Received `{type(params.get("polref", None))}` expected `int | None`')
    if params.get("fimfile", None) is not None:
        if not isinstance(params["fimfile"], str):
            raise StyxValidationError(f'`fimfile` has the wrong type: Received `{type(params.get("fimfile", None))}` expected `str | None`')
    if params.get("corr", False) is None:
        raise StyxValidationError("`corr` must not be None")
    if not isinstance(params["corr"], bool):
        raise StyxValidationError(f'`corr` has the wrong type: Received `{type(params.get("corr", False))}` expected `bool`')
    if params.get("corfile", None) is not None:
        if not isinstance(params["corfile"], str):
            raise StyxValidationError(f'`corfile` has the wrong type: Received `{type(params.get("corfile", None))}` expected `str | None`')
    if params.get("cnrfile", None) is not None:
        if not isinstance(params["cnrfile"], str):
            raise StyxValidationError(f'`cnrfile` has the wrong type: Received `{type(params.get("cnrfile", None))}` expected `str | None`')
    if params.get("sigfile", None) is not None:
        if not isinstance(params["sigfile"], str):
            raise StyxValidationError(f'`sigfile` has the wrong type: Received `{type(params.get("sigfile", None))}` expected `str | None`')
    if params.get("fitfile", None) is not None:
        if not isinstance(params["fitfile"], str):
            raise StyxValidationError(f'`fitfile` has the wrong type: Received `{type(params.get("fitfile", None))}` expected `str | None`')
    if params.get("subort", None) is not None:
        if not isinstance(params["subort"], str):
            raise StyxValidationError(f'`subort` has the wrong type: Received `{type(params.get("subort", None))}` expected `str | None`')
    if params.get("flim", False) is None:
        raise StyxValidationError("`flim` must not be None")
    if not isinstance(params["flim"], bool):
        raise StyxValidationError(f'`flim` has the wrong type: Received `{type(params.get("flim", False))}` expected `bool`')
    if params.get("clean", False) is None:
        raise StyxValidationError("`clean` must not be None")
    if not isinstance(params["clean"], bool):
        raise StyxValidationError(f'`clean` has the wrong type: Received `{type(params.get("clean", False))}` expected `bool`')
    if params.get("clip", False) is None:
        raise StyxValidationError("`clip` must not be None")
    if not isinstance(params["clip"], bool):
        raise StyxValidationError(f'`clip` has the wrong type: Received `{type(params.get("clip", False))}` expected `bool`')
    if params.get("q", False) is None:
        raise StyxValidationError("`q` must not be None")
    if not isinstance(params["q"], bool):
        raise StyxValidationError(f'`q` has the wrong type: Received `{type(params.get("q", False))}` expected `bool`')
    if params.get("dfspace", False) is None:
        raise StyxValidationError("`dfspace` must not be None")
    if not isinstance(params["dfspace"], bool):
        raise StyxValidationError(f'`dfspace` has the wrong type: Received `{type(params.get("dfspace", False))}` expected `bool`')
    if params.get("regbase", None) is not None:
        if not isinstance(params["regbase"], str):
            raise StyxValidationError(f'`regbase` has the wrong type: Received `{type(params.get("regbase", None))}` expected `str | None`')


def fim2_cargs(
    params: Fim2ParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("fim2")
    cargs.extend([execution.input_file(f) for f in params.get("image_files", None)])
    if params.get("pcnt", None) is not None:
        cargs.extend([
            "-pcnt",
            str(params.get("pcnt", None))
        ])
    if params.get("pcthresh", None) is not None:
        cargs.extend([
            "-pcthresh",
            str(params.get("pcthresh", None))
        ])
    if params.get("im1", None) is not None:
        cargs.extend([
            "-im1",
            str(params.get("im1", None))
        ])
    if params.get("num", None) is not None:
        cargs.extend([
            "-num",
            str(params.get("num", None))
        ])
    if params.get("non", False):
        cargs.append("-non")
    if params.get("coef", None) is not None:
        cargs.extend([
            "-coef",
            str(params.get("coef", None))
        ])
    if params.get("ort", None) is not None:
        cargs.extend([
            "-ort",
            *[execution.input_file(f) for f in params.get("ort", None)]
        ])
    if params.get("ideal", None) is not None:
        cargs.extend([
            "-ideal",
            *[execution.input_file(f) for f in params.get("ideal", None)]
        ])
    if params.get("polref", None) is not None:
        cargs.extend([
            "-polref",
            str(params.get("polref", None))
        ])
    if params.get("fimfile", None) is not None:
        cargs.extend([
            "-fimfile",
            params.get("fimfile", None)
        ])
    if params.get("corr", False):
        cargs.append("-corr")
    if params.get("corfile", None) is not None:
        cargs.extend([
            "-corfile",
            params.get("corfile", None)
        ])
    if params.get("cnrfile", None) is not None:
        cargs.extend([
            "-cnrfile",
            params.get("cnrfile", None)
        ])
    if params.get("sigfile", None) is not None:
        cargs.extend([
            "-sigfile",
            params.get("sigfile", None)
        ])
    if params.get("fitfile", None) is not None:
        cargs.extend([
            "-fitfile",
            params.get("fitfile", None)
        ])
    if params.get("subort", None) is not None:
        cargs.extend([
            "-subort",
            params.get("subort", None)
        ])
    if params.get("flim", False):
        cargs.append("-flim")
    if params.get("clean", False):
        cargs.append("-clean")
    if params.get("clip", False):
        cargs.append("-clip")
    if params.get("q", False):
        cargs.append("-q")
    if params.get("dfspace", False):
        cargs.append("-dfspace")
    if params.get("regbase", None) is not None:
        cargs.extend([
            "-regbase",
            params.get("regbase", None)
        ])
    return cargs


def fim2_outputs(
    params: Fim2ParamsDict,
    execution: Execution,
) -> Fim2Outputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = Fim2Outputs(
        root=execution.output_file("."),
        activation_magnitudes=execution.output_file(params.get("fimfile", None)) if (params.get("fimfile") is not None) else None,
        correlation_image=execution.output_file(params.get("corfile", None)) if (params.get("corfile") is not None) else None,
        contrast_to_noise_image=execution.output_file(params.get("cnrfile", None)) if (params.get("cnrfile") is not None) else None,
        std_deviation_image=execution.output_file(params.get("sigfile", None)) if (params.get("sigfile") is not None) else None,
        ls_fit_coefficients=execution.output_file(params.get("fitfile", None)) if (params.get("fitfile") is not None) else None,
        subtracted_references=execution.output_file(params.get("subort", None)) if (params.get("subort") is not None) else None,
    )
    return ret


def fim2_execute(
    params: Fim2ParamsDict,
    runner: Runner | None = None,
) -> Fim2Outputs:
    """
    fim2
    
    Functional Imaging Mapping Tool.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `Fim2Outputs`).
    """
    fim2_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(FIM2_METADATA)
    params = execution.params(params)
    cargs = fim2_cargs(params, execution)
    ret = fim2_outputs(params, execution)
    execution.run(cargs)
    return ret


def fim2(
    image_files: list[InputPathType],
    pcnt: float | None = None,
    pcthresh: float | None = None,
    im1: int | None = None,
    num: int | None = None,
    non: bool = False,
    coef: float | None = None,
    ort: list[InputPathType] | None = None,
    ideal: list[InputPathType] | None = None,
    polref: int | None = None,
    fimfile: str | None = None,
    corr: bool = False,
    corfile: str | None = None,
    cnrfile: str | None = None,
    sigfile: str | None = None,
    fitfile: str | None = None,
    subort: str | None = None,
    flim: bool = False,
    clean: bool = False,
    clip: bool = False,
    q: bool = False,
    dfspace: bool = False,
    regbase: str | None = None,
    runner: Runner | None = None,
) -> Fim2Outputs:
    """
    fim2
    
    Functional Imaging Mapping Tool.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        image_files: Input MRI image files.
        pcnt: Correlation coefficient threshold will be 1 - 0.01 * #.
        pcthresh: Correlation coefficient threshold will be #.
        im1: Index of image file to use as first in time series; default is 1.
        num: Number of images to actually use; default is to use all images.
        non: Turn off default normalization of the output activation image.
        coef: Scaling factor to convert the activation output from floats to\
            short ints.
        ort: Filename of a time series to which the image data will be\
            orthogonalized before correlations are computed.
        ideal: Filename of a time series to which the image data is to be\
            correlated.
        polref: Use polynomials of order 0..# as extra 'orts'; default is 0.
        fimfile: Filename to save activation magnitudes in.
        corr: Indicates to write correlation output to image file\
            'fimfile.CORR'.
        corfile: Filename to save correlation image in.
        cnrfile: Filename to save contrast-to-noise image in.
        sigfile: Filename to save standard deviation image in.
        fitfile: Image files of the least squares fit coefficients of all the\
            -ort and -polref time series.
        subort: Filename of the new timeseries of images with the orts and\
            polrefs subtracted out.
        flim: Write outputs in mrilib 'float' format.
        clean: Output images won't have the +/- 10000 values forced into their\
            corners for scaling purposes.
        clip: Set to zero regions of low intensity in output correlations, etc.
        q: Quiet operation mode.
        dfspace: Use the 'dfspace' filter to register the images spatially\
            before filtering.
        regbase: Read image in file 'fname' as the base image for registration.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `Fim2Outputs`).
    """
    params = fim2_params(
        image_files=image_files,
        pcnt=pcnt,
        pcthresh=pcthresh,
        im1=im1,
        num=num,
        non=non,
        coef=coef,
        ort=ort,
        ideal=ideal,
        polref=polref,
        fimfile=fimfile,
        corr=corr,
        corfile=corfile,
        cnrfile=cnrfile,
        sigfile=sigfile,
        fitfile=fitfile,
        subort=subort,
        flim=flim,
        clean=clean,
        clip=clip,
        q=q,
        dfspace=dfspace,
        regbase=regbase,
    )
    return fim2_execute(params, runner)


__all__ = [
    "FIM2_METADATA",
    "Fim2Outputs",
    "Fim2ParamsDict",
    "Fim2ParamsDictTagged",
    "fim2",
    "fim2_execute",
    "fim2_params",
]
