# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

V_3DTTEST___METADATA = Metadata(
    id="b6f6e0eb079a523b8cc03b4a1cb912072699dd19.boutiques",
    name="3dttest++",
    package="afni",
    container_image_tag="afni/afni_make_build:AFNI_24.2.06",
)


_V3dttestParamsDictNoTag = typing.TypedDict('_V3dttestParamsDictNoTag', {
    "setA": list[str],
    "setB": typing.NotRequired[list[str] | None],
    "setA_long": typing.NotRequired[list[str] | None],
    "setB_long": typing.NotRequired[list[str] | None],
    "covariates": typing.NotRequired[InputPathType | None],
    "labelA": typing.NotRequired[str | None],
    "labelB": typing.NotRequired[str | None],
    "setweightA": typing.NotRequired[InputPathType | None],
    "setweightB": typing.NotRequired[InputPathType | None],
    "prefix": typing.NotRequired[str | None],
    "resid": typing.NotRequired[str | None],
    "paired": bool,
    "unpooled": bool,
    "mask": typing.NotRequired[InputPathType | None],
    "exblur": typing.NotRequired[int | None],
    "randomsign": bool,
    "permute": bool,
    "ETAC": bool,
    "ETAC_blur": typing.NotRequired[list[float] | None],
    "ETAC_opt": typing.NotRequired[list[str] | None],
    "seed": typing.NotRequired[float | None],
})
V3dttestParamsDictTagged = typing.TypedDict('V3dttestParamsDictTagged', {
    "@type": typing.Literal["afni/3dttest++"],
    "setA": list[str],
    "setB": typing.NotRequired[list[str] | None],
    "setA_long": typing.NotRequired[list[str] | None],
    "setB_long": typing.NotRequired[list[str] | None],
    "covariates": typing.NotRequired[InputPathType | None],
    "labelA": typing.NotRequired[str | None],
    "labelB": typing.NotRequired[str | None],
    "setweightA": typing.NotRequired[InputPathType | None],
    "setweightB": typing.NotRequired[InputPathType | None],
    "prefix": typing.NotRequired[str | None],
    "resid": typing.NotRequired[str | None],
    "paired": bool,
    "unpooled": bool,
    "mask": typing.NotRequired[InputPathType | None],
    "exblur": typing.NotRequired[int | None],
    "randomsign": bool,
    "permute": bool,
    "ETAC": bool,
    "ETAC_blur": typing.NotRequired[list[float] | None],
    "ETAC_opt": typing.NotRequired[list[str] | None],
    "seed": typing.NotRequired[float | None],
})
V3dttestParamsDict = _V3dttestParamsDictNoTag | V3dttestParamsDictTagged


class V3dttestOutputs(typing.NamedTuple):
    """
    Output object returned when calling `V3dttestParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    out_file: OutputPathType | None
    """Main output dataset"""
    residuals: OutputPathType | None
    """Output residuals dataset"""


def v_3dttest___params(
    set_a: list[str],
    set_b: list[str] | None = None,
    set_a_long: list[str] | None = None,
    set_b_long: list[str] | None = None,
    covariates: InputPathType | None = None,
    label_a: str | None = None,
    label_b: str | None = None,
    setweight_a: InputPathType | None = None,
    setweight_b: InputPathType | None = None,
    prefix: str | None = None,
    resid: str | None = None,
    paired: bool = False,
    unpooled: bool = False,
    mask: InputPathType | None = None,
    exblur: int | None = None,
    randomsign: bool = False,
    permute: bool = False,
    etac: bool = False,
    etac_blur: list[float] | None = None,
    etac_opt: list[str] | None = None,
    seed: float | None = None,
) -> V3dttestParamsDictTagged:
    """
    Build parameters.
    
    Args:
        set_a: Set A in short form, e.g., 'a+tlrc[3]' b+tlrc[3] ...'.
        set_b: Set B in short form, e.g., 'x+tlrc[3]' y+tlrc[3] ...'.
        set_a_long: Specify an overall name for the set of datasets (Long\
            form). Example: -setA Green sub001 a+tlrc[3] sub002 b+tlrc[3] ...
        set_b_long: Specify an overall name for the set of datasets (Long\
            form). Example: -setB Blue sub001 x+tlrc[3] sub002 y+tlrc[3] ...
        covariates: File containing covariates.
        label_a: Label for the set (for Set A). Limited to 12 characters.
        label_b: Label for the set (for Set B). Limited to 12 characters.
        setweight_a: File with voxel-wise weights for -setA datasets.
        setweight_b: File with voxel-wise weights for -setB datasets.
        prefix: Output the prefix name of the dataset result. For surface-based\
            datasets, use -prefix p.niml.dset or -prefix p.gii.dset.
        resid: Residuals will be output into a dataset with the given prefix.
        paired: Specify to use a paired-sample t-test to compare setA and setB.\
            Both sets must have the same cardinality.
        unpooled: Specify separate variance estimates for setA and setB (not\
            pooled together).
        mask: Set mask for dataset analysis.
        exblur: Add extra Gaussian blurring kernel FWHM (mm). Example: -exblur\
            6.
        randomsign: Randomize signs of datasets. Used with output from -resid\
            to generate null hypothesis statistics.
        permute: With -randomsign, adds inter-set permutation to randomization\
            when both sets are used.
        etac: Apply the Equitable Thresholding And Clustering (ETAC) method for\
            thresholding results.
        etac_blur: List of multiple levels of spatial blurring for ETAC.\
            Example: -ETAC_blur 4 6.
        etac_opt: Specify options for ETAC. Example: -ETAC_opt\
            NN=2:sid=2:hpow=0,2:pthr=0.01,0.005,0.002,0.01:name=Fred.
        seed: Random number seed for -randomsign and -permute/ETAC.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "afni/3dttest++",
        "setA": set_a,
        "paired": paired,
        "unpooled": unpooled,
        "randomsign": randomsign,
        "permute": permute,
        "ETAC": etac,
    }
    if set_b is not None:
        params["setB"] = set_b
    if set_a_long is not None:
        params["setA_long"] = set_a_long
    if set_b_long is not None:
        params["setB_long"] = set_b_long
    if covariates is not None:
        params["covariates"] = covariates
    if label_a is not None:
        params["labelA"] = label_a
    if label_b is not None:
        params["labelB"] = label_b
    if setweight_a is not None:
        params["setweightA"] = setweight_a
    if setweight_b is not None:
        params["setweightB"] = setweight_b
    if prefix is not None:
        params["prefix"] = prefix
    if resid is not None:
        params["resid"] = resid
    if mask is not None:
        params["mask"] = mask
    if exblur is not None:
        params["exblur"] = exblur
    if etac_blur is not None:
        params["ETAC_blur"] = etac_blur
    if etac_opt is not None:
        params["ETAC_opt"] = etac_opt
    if seed is not None:
        params["seed"] = seed
    return params


def v_3dttest___validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `V3dttestParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("setA", None) is None:
        raise StyxValidationError("`setA` must not be None")
    if not isinstance(params["setA"], list):
        raise StyxValidationError(f'`setA` has the wrong type: Received `{type(params.get("setA", None))}` expected `list[str]`')
    for e in params["setA"]:
        if not isinstance(e, str):
            raise StyxValidationError(f'`setA` has the wrong type: Received `{type(params.get("setA", None))}` expected `list[str]`')
    if params.get("setB", None) is not None:
        if not isinstance(params["setB"], list):
            raise StyxValidationError(f'`setB` has the wrong type: Received `{type(params.get("setB", None))}` expected `list[str] | None`')
        for e in params["setB"]:
            if not isinstance(e, str):
                raise StyxValidationError(f'`setB` has the wrong type: Received `{type(params.get("setB", None))}` expected `list[str] | None`')
    if params.get("setA_long", None) is not None:
        if not isinstance(params["setA_long"], list):
            raise StyxValidationError(f'`setA_long` has the wrong type: Received `{type(params.get("setA_long", None))}` expected `list[str] | None`')
        for e in params["setA_long"]:
            if not isinstance(e, str):
                raise StyxValidationError(f'`setA_long` has the wrong type: Received `{type(params.get("setA_long", None))}` expected `list[str] | None`')
    if params.get("setB_long", None) is not None:
        if not isinstance(params["setB_long"], list):
            raise StyxValidationError(f'`setB_long` has the wrong type: Received `{type(params.get("setB_long", None))}` expected `list[str] | None`')
        for e in params["setB_long"]:
            if not isinstance(e, str):
                raise StyxValidationError(f'`setB_long` has the wrong type: Received `{type(params.get("setB_long", None))}` expected `list[str] | None`')
    if params.get("covariates", None) is not None:
        if not isinstance(params["covariates"], (pathlib.Path, str)):
            raise StyxValidationError(f'`covariates` has the wrong type: Received `{type(params.get("covariates", None))}` expected `InputPathType | None`')
    if params.get("labelA", None) is not None:
        if not isinstance(params["labelA"], str):
            raise StyxValidationError(f'`labelA` has the wrong type: Received `{type(params.get("labelA", None))}` expected `str | None`')
    if params.get("labelB", None) is not None:
        if not isinstance(params["labelB"], str):
            raise StyxValidationError(f'`labelB` has the wrong type: Received `{type(params.get("labelB", None))}` expected `str | None`')
    if params.get("setweightA", None) is not None:
        if not isinstance(params["setweightA"], (pathlib.Path, str)):
            raise StyxValidationError(f'`setweightA` has the wrong type: Received `{type(params.get("setweightA", None))}` expected `InputPathType | None`')
    if params.get("setweightB", None) is not None:
        if not isinstance(params["setweightB"], (pathlib.Path, str)):
            raise StyxValidationError(f'`setweightB` has the wrong type: Received `{type(params.get("setweightB", None))}` expected `InputPathType | None`')
    if params.get("prefix", None) is not None:
        if not isinstance(params["prefix"], str):
            raise StyxValidationError(f'`prefix` has the wrong type: Received `{type(params.get("prefix", None))}` expected `str | None`')
    if params.get("resid", None) is not None:
        if not isinstance(params["resid"], str):
            raise StyxValidationError(f'`resid` has the wrong type: Received `{type(params.get("resid", None))}` expected `str | None`')
    if params.get("paired", False) is None:
        raise StyxValidationError("`paired` must not be None")
    if not isinstance(params["paired"], bool):
        raise StyxValidationError(f'`paired` has the wrong type: Received `{type(params.get("paired", False))}` expected `bool`')
    if params.get("unpooled", False) is None:
        raise StyxValidationError("`unpooled` must not be None")
    if not isinstance(params["unpooled"], bool):
        raise StyxValidationError(f'`unpooled` has the wrong type: Received `{type(params.get("unpooled", False))}` expected `bool`')
    if params.get("mask", None) is not None:
        if not isinstance(params["mask"], (pathlib.Path, str)):
            raise StyxValidationError(f'`mask` has the wrong type: Received `{type(params.get("mask", None))}` expected `InputPathType | None`')
    if params.get("exblur", None) is not None:
        if not isinstance(params["exblur"], int):
            raise StyxValidationError(f'`exblur` has the wrong type: Received `{type(params.get("exblur", None))}` expected `int | None`')
        if not (0 <= params["exblur"] <= 100):
            raise StyxValidationError("Parameter `exblur` must be between 0 and 100 (inclusive)")
    if params.get("randomsign", False) is None:
        raise StyxValidationError("`randomsign` must not be None")
    if not isinstance(params["randomsign"], bool):
        raise StyxValidationError(f'`randomsign` has the wrong type: Received `{type(params.get("randomsign", False))}` expected `bool`')
    if params.get("permute", False) is None:
        raise StyxValidationError("`permute` must not be None")
    if not isinstance(params["permute"], bool):
        raise StyxValidationError(f'`permute` has the wrong type: Received `{type(params.get("permute", False))}` expected `bool`')
    if params.get("ETAC", False) is None:
        raise StyxValidationError("`ETAC` must not be None")
    if not isinstance(params["ETAC"], bool):
        raise StyxValidationError(f'`ETAC` has the wrong type: Received `{type(params.get("ETAC", False))}` expected `bool`')
    if params.get("ETAC_blur", None) is not None:
        if not isinstance(params["ETAC_blur"], list):
            raise StyxValidationError(f'`ETAC_blur` has the wrong type: Received `{type(params.get("ETAC_blur", None))}` expected `list[float] | None`')
        for e in params["ETAC_blur"]:
            if not isinstance(e, (float, int)):
                raise StyxValidationError(f'`ETAC_blur` has the wrong type: Received `{type(params.get("ETAC_blur", None))}` expected `list[float] | None`')
    if params.get("ETAC_opt", None) is not None:
        if not isinstance(params["ETAC_opt"], list):
            raise StyxValidationError(f'`ETAC_opt` has the wrong type: Received `{type(params.get("ETAC_opt", None))}` expected `list[str] | None`')
        for e in params["ETAC_opt"]:
            if not isinstance(e, str):
                raise StyxValidationError(f'`ETAC_opt` has the wrong type: Received `{type(params.get("ETAC_opt", None))}` expected `list[str] | None`')
    if params.get("seed", None) is not None:
        if not isinstance(params["seed"], (float, int)):
            raise StyxValidationError(f'`seed` has the wrong type: Received `{type(params.get("seed", None))}` expected `float | None`')


def v_3dttest___cargs(
    params: V3dttestParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("3dttest++")
    cargs.extend([
        "-setA",
        *params.get("setA", None)
    ])
    if params.get("setB", None) is not None:
        cargs.extend([
            "-setB",
            *params.get("setB", None)
        ])
    if params.get("setA_long", None) is not None:
        cargs.extend([
            "-setA",
            *params.get("setA_long", None)
        ])
    if params.get("setB_long", None) is not None:
        cargs.extend([
            "-setB",
            *params.get("setB_long", None)
        ])
    if params.get("covariates", None) is not None:
        cargs.extend([
            "-covariates",
            execution.input_file(params.get("covariates", None))
        ])
    if params.get("labelA", None) is not None:
        cargs.extend([
            "-labelA",
            params.get("labelA", None)
        ])
    if params.get("labelB", None) is not None:
        cargs.extend([
            "-labelB",
            params.get("labelB", None)
        ])
    if params.get("setweightA", None) is not None:
        cargs.extend([
            "-setweightA",
            execution.input_file(params.get("setweightA", None))
        ])
    if params.get("setweightB", None) is not None:
        cargs.extend([
            "-setweightB",
            execution.input_file(params.get("setweightB", None))
        ])
    if params.get("prefix", None) is not None:
        cargs.extend([
            "-prefix",
            params.get("prefix", None)
        ])
    if params.get("resid", None) is not None:
        cargs.extend([
            "-resid",
            params.get("resid", None)
        ])
    if params.get("paired", False):
        cargs.append("-paired")
    if params.get("unpooled", False):
        cargs.append("-unpooled")
    if params.get("mask", None) is not None:
        cargs.extend([
            "-mask",
            execution.input_file(params.get("mask", None))
        ])
    if params.get("exblur", None) is not None:
        cargs.extend([
            "-exblur",
            str(params.get("exblur", None))
        ])
    if params.get("randomsign", False):
        cargs.append("-randomsign")
    if params.get("permute", False):
        cargs.append("-permute")
    if params.get("ETAC", False):
        cargs.append("-ETAC")
    if params.get("ETAC_blur", None) is not None:
        cargs.extend([
            "-ETAC_blur",
            *map(str, params.get("ETAC_blur", None))
        ])
    if params.get("ETAC_opt", None) is not None:
        cargs.extend([
            "-ETAC_opt",
            *params.get("ETAC_opt", None)
        ])
    if params.get("seed", None) is not None:
        cargs.extend([
            "-seed",
            str(params.get("seed", None))
        ])
    return cargs


def v_3dttest___outputs(
    params: V3dttestParamsDict,
    execution: Execution,
) -> V3dttestOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = V3dttestOutputs(
        root=execution.output_file("."),
        out_file=execution.output_file(params.get("prefix", None) + ".nii.gz") if (params.get("prefix") is not None) else None,
        residuals=execution.output_file(params.get("resid", None) + ".nii.gz") if (params.get("resid") is not None) else None,
    )
    return ret


def v_3dttest___execute(
    params: V3dttestParamsDict,
    runner: Runner | None = None,
) -> V3dttestOutputs:
    """
    3dttest++
    
    Gosset (Student) t-test of sets of 3D datasets in AFNI.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `V3dttestOutputs`).
    """
    v_3dttest___validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(V_3DTTEST___METADATA)
    params = execution.params(params)
    cargs = v_3dttest___cargs(params, execution)
    ret = v_3dttest___outputs(params, execution)
    execution.run(cargs)
    return ret


def v_3dttest__(
    set_a: list[str],
    set_b: list[str] | None = None,
    set_a_long: list[str] | None = None,
    set_b_long: list[str] | None = None,
    covariates: InputPathType | None = None,
    label_a: str | None = None,
    label_b: str | None = None,
    setweight_a: InputPathType | None = None,
    setweight_b: InputPathType | None = None,
    prefix: str | None = None,
    resid: str | None = None,
    paired: bool = False,
    unpooled: bool = False,
    mask: InputPathType | None = None,
    exblur: int | None = None,
    randomsign: bool = False,
    permute: bool = False,
    etac: bool = False,
    etac_blur: list[float] | None = None,
    etac_opt: list[str] | None = None,
    seed: float | None = None,
    runner: Runner | None = None,
) -> V3dttestOutputs:
    """
    3dttest++
    
    Gosset (Student) t-test of sets of 3D datasets in AFNI.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        set_a: Set A in short form, e.g., 'a+tlrc[3]' b+tlrc[3] ...'.
        set_b: Set B in short form, e.g., 'x+tlrc[3]' y+tlrc[3] ...'.
        set_a_long: Specify an overall name for the set of datasets (Long\
            form). Example: -setA Green sub001 a+tlrc[3] sub002 b+tlrc[3] ...
        set_b_long: Specify an overall name for the set of datasets (Long\
            form). Example: -setB Blue sub001 x+tlrc[3] sub002 y+tlrc[3] ...
        covariates: File containing covariates.
        label_a: Label for the set (for Set A). Limited to 12 characters.
        label_b: Label for the set (for Set B). Limited to 12 characters.
        setweight_a: File with voxel-wise weights for -setA datasets.
        setweight_b: File with voxel-wise weights for -setB datasets.
        prefix: Output the prefix name of the dataset result. For surface-based\
            datasets, use -prefix p.niml.dset or -prefix p.gii.dset.
        resid: Residuals will be output into a dataset with the given prefix.
        paired: Specify to use a paired-sample t-test to compare setA and setB.\
            Both sets must have the same cardinality.
        unpooled: Specify separate variance estimates for setA and setB (not\
            pooled together).
        mask: Set mask for dataset analysis.
        exblur: Add extra Gaussian blurring kernel FWHM (mm). Example: -exblur\
            6.
        randomsign: Randomize signs of datasets. Used with output from -resid\
            to generate null hypothesis statistics.
        permute: With -randomsign, adds inter-set permutation to randomization\
            when both sets are used.
        etac: Apply the Equitable Thresholding And Clustering (ETAC) method for\
            thresholding results.
        etac_blur: List of multiple levels of spatial blurring for ETAC.\
            Example: -ETAC_blur 4 6.
        etac_opt: Specify options for ETAC. Example: -ETAC_opt\
            NN=2:sid=2:hpow=0,2:pthr=0.01,0.005,0.002,0.01:name=Fred.
        seed: Random number seed for -randomsign and -permute/ETAC.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `V3dttestOutputs`).
    """
    params = v_3dttest___params(
        set_a=set_a,
        set_b=set_b,
        set_a_long=set_a_long,
        set_b_long=set_b_long,
        covariates=covariates,
        label_a=label_a,
        label_b=label_b,
        setweight_a=setweight_a,
        setweight_b=setweight_b,
        prefix=prefix,
        resid=resid,
        paired=paired,
        unpooled=unpooled,
        mask=mask,
        exblur=exblur,
        randomsign=randomsign,
        permute=permute,
        etac=etac,
        etac_blur=etac_blur,
        etac_opt=etac_opt,
        seed=seed,
    )
    return v_3dttest___execute(params, runner)


__all__ = [
    "V3dttestOutputs",
    "V3dttestParamsDict",
    "V3dttestParamsDictTagged",
    "V_3DTTEST___METADATA",
    "v_3dttest__",
    "v_3dttest___execute",
    "v_3dttest___params",
]
