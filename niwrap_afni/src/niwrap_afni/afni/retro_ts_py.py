# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

RETRO_TS_PY_METADATA = Metadata(
    id="bb079d91adb04385514019ae3540d64ee4d39c7a.boutiques",
    name="RetroTS.py",
    package="afni",
    container_image_tag="afni/afni_make_build:AFNI_24.2.06",
)


_RetroTsPyParamsDictNoTag = typing.TypedDict('_RetroTsPyParamsDictNoTag', {
    "resp_file": typing.NotRequired[InputPathType | None],
    "card_file": typing.NotRequired[InputPathType | None],
    "phys_fs": typing.NotRequired[float | None],
    "num_slices": float,
    "volume_tr": float,
    "phys_file": typing.NotRequired[InputPathType | None],
    "phys_json": typing.NotRequired[InputPathType | None],
    "prefix": typing.NotRequired[str | None],
    "rvt_shifts": typing.NotRequired[str | None],
    "rvt_out": bool,
    "resp_cutoff_freq": typing.NotRequired[float | None],
    "cardiac_cutoff_freq": typing.NotRequired[float | None],
    "cardiac_out": bool,
    "respiration_out": bool,
    "interp_style": typing.NotRequired[str | None],
    "fir_order": typing.NotRequired[float | None],
    "quiet": bool,
    "demo": bool,
    "show_graphs": bool,
    "debug": bool,
    "slice_offset": typing.NotRequired[str | None],
    "slice_major": typing.NotRequired[float | None],
    "slice_order": typing.NotRequired[str | None],
    "zero_phase_offset": bool,
    "legacy_transform": typing.NotRequired[float | None],
})
RetroTsPyParamsDictTagged = typing.TypedDict('RetroTsPyParamsDictTagged', {
    "@type": typing.Literal["afni/RetroTS.py"],
    "resp_file": typing.NotRequired[InputPathType | None],
    "card_file": typing.NotRequired[InputPathType | None],
    "phys_fs": typing.NotRequired[float | None],
    "num_slices": float,
    "volume_tr": float,
    "phys_file": typing.NotRequired[InputPathType | None],
    "phys_json": typing.NotRequired[InputPathType | None],
    "prefix": typing.NotRequired[str | None],
    "rvt_shifts": typing.NotRequired[str | None],
    "rvt_out": bool,
    "resp_cutoff_freq": typing.NotRequired[float | None],
    "cardiac_cutoff_freq": typing.NotRequired[float | None],
    "cardiac_out": bool,
    "respiration_out": bool,
    "interp_style": typing.NotRequired[str | None],
    "fir_order": typing.NotRequired[float | None],
    "quiet": bool,
    "demo": bool,
    "show_graphs": bool,
    "debug": bool,
    "slice_offset": typing.NotRequired[str | None],
    "slice_major": typing.NotRequired[float | None],
    "slice_order": typing.NotRequired[str | None],
    "zero_phase_offset": bool,
    "legacy_transform": typing.NotRequired[float | None],
})
RetroTsPyParamsDict = _RetroTsPyParamsDictNoTag | RetroTsPyParamsDictTagged


class RetroTsPyOutputs(typing.NamedTuple):
    """
    Output object returned when calling `RetroTsPyParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    output_file: OutputPathType | None
    """Output file containing respiratory and cardiac regressors"""


def retro_ts_py_params(
    num_slices: float,
    volume_tr: float,
    resp_file: InputPathType | None = None,
    card_file: InputPathType | None = None,
    phys_fs: float | None = None,
    phys_file: InputPathType | None = None,
    phys_json: InputPathType | None = None,
    prefix: str | None = None,
    rvt_shifts: str | None = None,
    rvt_out: bool = False,
    resp_cutoff_freq: float | None = None,
    cardiac_cutoff_freq: float | None = None,
    cardiac_out: bool = False,
    respiration_out: bool = False,
    interp_style: str | None = None,
    fir_order: float | None = None,
    quiet: bool = False,
    demo: bool = False,
    show_graphs: bool = False,
    debug: bool = False,
    slice_offset: str | None = None,
    slice_major: float | None = None,
    slice_order: str | None = None,
    zero_phase_offset: bool = False,
    legacy_transform: float | None = None,
) -> RetroTsPyParamsDictTagged:
    """
    Build parameters.
    
    Args:
        num_slices: Number of slices.
        volume_tr: Volume TR in seconds.
        resp_file: Respiration data file.
        card_file: Cardiac data file.
        phys_fs: Physiological signal sampling frequency in Hz.
        phys_file: BIDS formatted physio file in tab-separated format, can be\
            gzipped.
        phys_json: BIDS formatted physio metadata json file. If not specified,\
            the json corresponding to the phys_file will be loaded.
        prefix: Prefix of output file.
        rvt_shifts: Vector of shifts in seconds of RVT signal. (default is\
            [0:5:20]).
        rvt_out: Flag for writing RVT regressors (default is 1).
        resp_cutoff_freq: Cut-off frequency in Hz for respiratory lowpass\
            filter (default 3 Hz).
        cardiac_cutoff_freq: Cut-off frequency in Hz for cardiac lowpass filter\
            (default 3 Hz).
        cardiac_out: Flag for writing Cardiac regressors (default is 1).
        respiration_out: Flag for writing Respiratory regressors (default is 1).
        interp_style: Resampling kernel (default is 'linear').
        fir_order: Order of FIR filter (default is 40).
        quiet: Show talkative progress as the program runs (default is 1).
        demo: Run demonstration of RetroTS (default is 0).
        show_graphs: Show graphs (default is unset; set with any parameter to\
            view).
        debug: Drop into pdb upon an exception (default is False).
        slice_offset: Vector of slice acquisition time offsets in seconds\
            (default is equivalent of alt+z).
        slice_major: Unknown parameter (default is 1).
        slice_order: Slice timing information in seconds. (default is alt+z).
        zero_phase_offset: Zero phase offset flag.
        legacy_transform: Specify the version of the original Matlab code's\
            transformation (default is 0).
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "afni/RetroTS.py",
        "num_slices": num_slices,
        "volume_tr": volume_tr,
        "rvt_out": rvt_out,
        "cardiac_out": cardiac_out,
        "respiration_out": respiration_out,
        "quiet": quiet,
        "demo": demo,
        "show_graphs": show_graphs,
        "debug": debug,
        "zero_phase_offset": zero_phase_offset,
    }
    if resp_file is not None:
        params["resp_file"] = resp_file
    if card_file is not None:
        params["card_file"] = card_file
    if phys_fs is not None:
        params["phys_fs"] = phys_fs
    if phys_file is not None:
        params["phys_file"] = phys_file
    if phys_json is not None:
        params["phys_json"] = phys_json
    if prefix is not None:
        params["prefix"] = prefix
    if rvt_shifts is not None:
        params["rvt_shifts"] = rvt_shifts
    if resp_cutoff_freq is not None:
        params["resp_cutoff_freq"] = resp_cutoff_freq
    if cardiac_cutoff_freq is not None:
        params["cardiac_cutoff_freq"] = cardiac_cutoff_freq
    if interp_style is not None:
        params["interp_style"] = interp_style
    if fir_order is not None:
        params["fir_order"] = fir_order
    if slice_offset is not None:
        params["slice_offset"] = slice_offset
    if slice_major is not None:
        params["slice_major"] = slice_major
    if slice_order is not None:
        params["slice_order"] = slice_order
    if legacy_transform is not None:
        params["legacy_transform"] = legacy_transform
    return params


def retro_ts_py_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `RetroTsPyParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("resp_file", None) is not None:
        if not isinstance(params["resp_file"], (pathlib.Path, str)):
            raise StyxValidationError(f'`resp_file` has the wrong type: Received `{type(params.get("resp_file", None))}` expected `InputPathType | None`')
    if params.get("card_file", None) is not None:
        if not isinstance(params["card_file"], (pathlib.Path, str)):
            raise StyxValidationError(f'`card_file` has the wrong type: Received `{type(params.get("card_file", None))}` expected `InputPathType | None`')
    if params.get("phys_fs", None) is not None:
        if not isinstance(params["phys_fs"], (float, int)):
            raise StyxValidationError(f'`phys_fs` has the wrong type: Received `{type(params.get("phys_fs", None))}` expected `float | None`')
    if params.get("num_slices", None) is None:
        raise StyxValidationError("`num_slices` must not be None")
    if not isinstance(params["num_slices"], (float, int)):
        raise StyxValidationError(f'`num_slices` has the wrong type: Received `{type(params.get("num_slices", None))}` expected `float`')
    if params.get("volume_tr", None) is None:
        raise StyxValidationError("`volume_tr` must not be None")
    if not isinstance(params["volume_tr"], (float, int)):
        raise StyxValidationError(f'`volume_tr` has the wrong type: Received `{type(params.get("volume_tr", None))}` expected `float`')
    if params.get("phys_file", None) is not None:
        if not isinstance(params["phys_file"], (pathlib.Path, str)):
            raise StyxValidationError(f'`phys_file` has the wrong type: Received `{type(params.get("phys_file", None))}` expected `InputPathType | None`')
    if params.get("phys_json", None) is not None:
        if not isinstance(params["phys_json"], (pathlib.Path, str)):
            raise StyxValidationError(f'`phys_json` has the wrong type: Received `{type(params.get("phys_json", None))}` expected `InputPathType | None`')
    if params.get("prefix", None) is not None:
        if not isinstance(params["prefix"], str):
            raise StyxValidationError(f'`prefix` has the wrong type: Received `{type(params.get("prefix", None))}` expected `str | None`')
    if params.get("rvt_shifts", None) is not None:
        if not isinstance(params["rvt_shifts"], str):
            raise StyxValidationError(f'`rvt_shifts` has the wrong type: Received `{type(params.get("rvt_shifts", None))}` expected `str | None`')
    if params.get("rvt_out", False) is None:
        raise StyxValidationError("`rvt_out` must not be None")
    if not isinstance(params["rvt_out"], bool):
        raise StyxValidationError(f'`rvt_out` has the wrong type: Received `{type(params.get("rvt_out", False))}` expected `bool`')
    if params.get("resp_cutoff_freq", None) is not None:
        if not isinstance(params["resp_cutoff_freq"], (float, int)):
            raise StyxValidationError(f'`resp_cutoff_freq` has the wrong type: Received `{type(params.get("resp_cutoff_freq", None))}` expected `float | None`')
    if params.get("cardiac_cutoff_freq", None) is not None:
        if not isinstance(params["cardiac_cutoff_freq"], (float, int)):
            raise StyxValidationError(f'`cardiac_cutoff_freq` has the wrong type: Received `{type(params.get("cardiac_cutoff_freq", None))}` expected `float | None`')
    if params.get("cardiac_out", False) is None:
        raise StyxValidationError("`cardiac_out` must not be None")
    if not isinstance(params["cardiac_out"], bool):
        raise StyxValidationError(f'`cardiac_out` has the wrong type: Received `{type(params.get("cardiac_out", False))}` expected `bool`')
    if params.get("respiration_out", False) is None:
        raise StyxValidationError("`respiration_out` must not be None")
    if not isinstance(params["respiration_out"], bool):
        raise StyxValidationError(f'`respiration_out` has the wrong type: Received `{type(params.get("respiration_out", False))}` expected `bool`')
    if params.get("interp_style", None) is not None:
        if not isinstance(params["interp_style"], str):
            raise StyxValidationError(f'`interp_style` has the wrong type: Received `{type(params.get("interp_style", None))}` expected `str | None`')
    if params.get("fir_order", None) is not None:
        if not isinstance(params["fir_order"], (float, int)):
            raise StyxValidationError(f'`fir_order` has the wrong type: Received `{type(params.get("fir_order", None))}` expected `float | None`')
    if params.get("quiet", False) is None:
        raise StyxValidationError("`quiet` must not be None")
    if not isinstance(params["quiet"], bool):
        raise StyxValidationError(f'`quiet` has the wrong type: Received `{type(params.get("quiet", False))}` expected `bool`')
    if params.get("demo", False) is None:
        raise StyxValidationError("`demo` must not be None")
    if not isinstance(params["demo"], bool):
        raise StyxValidationError(f'`demo` has the wrong type: Received `{type(params.get("demo", False))}` expected `bool`')
    if params.get("show_graphs", False) is None:
        raise StyxValidationError("`show_graphs` must not be None")
    if not isinstance(params["show_graphs"], bool):
        raise StyxValidationError(f'`show_graphs` has the wrong type: Received `{type(params.get("show_graphs", False))}` expected `bool`')
    if params.get("debug", False) is None:
        raise StyxValidationError("`debug` must not be None")
    if not isinstance(params["debug"], bool):
        raise StyxValidationError(f'`debug` has the wrong type: Received `{type(params.get("debug", False))}` expected `bool`')
    if params.get("slice_offset", None) is not None:
        if not isinstance(params["slice_offset"], str):
            raise StyxValidationError(f'`slice_offset` has the wrong type: Received `{type(params.get("slice_offset", None))}` expected `str | None`')
    if params.get("slice_major", None) is not None:
        if not isinstance(params["slice_major"], (float, int)):
            raise StyxValidationError(f'`slice_major` has the wrong type: Received `{type(params.get("slice_major", None))}` expected `float | None`')
    if params.get("slice_order", None) is not None:
        if not isinstance(params["slice_order"], str):
            raise StyxValidationError(f'`slice_order` has the wrong type: Received `{type(params.get("slice_order", None))}` expected `str | None`')
    if params.get("zero_phase_offset", False) is None:
        raise StyxValidationError("`zero_phase_offset` must not be None")
    if not isinstance(params["zero_phase_offset"], bool):
        raise StyxValidationError(f'`zero_phase_offset` has the wrong type: Received `{type(params.get("zero_phase_offset", False))}` expected `bool`')
    if params.get("legacy_transform", None) is not None:
        if not isinstance(params["legacy_transform"], (float, int)):
            raise StyxValidationError(f'`legacy_transform` has the wrong type: Received `{type(params.get("legacy_transform", None))}` expected `float | None`')


def retro_ts_py_cargs(
    params: RetroTsPyParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("RetroTS.py")
    if params.get("resp_file", None) is not None:
        cargs.extend([
            "-r",
            execution.input_file(params.get("resp_file", None))
        ])
    if params.get("card_file", None) is not None:
        cargs.extend([
            "-c",
            execution.input_file(params.get("card_file", None))
        ])
    if params.get("phys_fs", None) is not None:
        cargs.extend([
            "-p",
            str(params.get("phys_fs", None))
        ])
    cargs.extend([
        "-n",
        str(params.get("num_slices", None))
    ])
    cargs.extend([
        "-v",
        str(params.get("volume_tr", None))
    ])
    if params.get("phys_file", None) is not None:
        cargs.extend([
            "-phys_file",
            execution.input_file(params.get("phys_file", None))
        ])
    if params.get("phys_json", None) is not None:
        cargs.extend([
            "-phys_json",
            execution.input_file(params.get("phys_json", None))
        ])
    if params.get("prefix", None) is not None:
        cargs.extend([
            "-prefix",
            params.get("prefix", None)
        ])
    if params.get("rvt_shifts", None) is not None:
        cargs.extend([
            "-rvt_shifts",
            params.get("rvt_shifts", None)
        ])
    if params.get("rvt_out", False):
        cargs.append("-rvt_out")
    if params.get("resp_cutoff_freq", None) is not None:
        cargs.extend([
            "-respiration_cutoff_frequency",
            str(params.get("resp_cutoff_freq", None))
        ])
    if params.get("cardiac_cutoff_freq", None) is not None:
        cargs.extend([
            "-cardiac_cutoff_frequency",
            str(params.get("cardiac_cutoff_freq", None))
        ])
    if params.get("cardiac_out", False):
        cargs.append("-cardiac_out")
    if params.get("respiration_out", False):
        cargs.append("-respiration_out")
    if params.get("interp_style", None) is not None:
        cargs.extend([
            "-interpolation_style",
            params.get("interp_style", None)
        ])
    if params.get("fir_order", None) is not None:
        cargs.extend([
            "-fir_order",
            str(params.get("fir_order", None))
        ])
    if params.get("quiet", False):
        cargs.append("-quiet")
    if params.get("demo", False):
        cargs.append("-demo")
    if params.get("show_graphs", False):
        cargs.append("-show_graphs")
    if params.get("debug", False):
        cargs.append("-debug")
    if params.get("slice_offset", None) is not None:
        cargs.extend([
            "-slice_offset",
            params.get("slice_offset", None)
        ])
    if params.get("slice_major", None) is not None:
        cargs.extend([
            "-slice_major",
            str(params.get("slice_major", None))
        ])
    if params.get("slice_order", None) is not None:
        cargs.extend([
            "-slice_order",
            params.get("slice_order", None)
        ])
    if params.get("zero_phase_offset", False):
        cargs.append("-zero_phase_offset")
    if params.get("legacy_transform", None) is not None:
        cargs.extend([
            "-legacy_transform",
            str(params.get("legacy_transform", None))
        ])
    return cargs


def retro_ts_py_outputs(
    params: RetroTsPyParamsDict,
    execution: Execution,
) -> RetroTsPyOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = RetroTsPyOutputs(
        root=execution.output_file("."),
        output_file=execution.output_file(params.get("prefix", None) + ".slibase.1D") if (params.get("prefix") is not None) else None,
    )
    return ret


def retro_ts_py_execute(
    params: RetroTsPyParamsDict,
    runner: Runner | None = None,
) -> RetroTsPyOutputs:
    """
    RetroTS.py
    
    Creates slice-based regressors for regressing out components of heart rate,
    respiration, and respiration volume per time using independent data files or
    BIDS formatted files.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `RetroTsPyOutputs`).
    """
    retro_ts_py_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(RETRO_TS_PY_METADATA)
    params = execution.params(params)
    cargs = retro_ts_py_cargs(params, execution)
    ret = retro_ts_py_outputs(params, execution)
    execution.run(cargs)
    return ret


def retro_ts_py(
    num_slices: float,
    volume_tr: float,
    resp_file: InputPathType | None = None,
    card_file: InputPathType | None = None,
    phys_fs: float | None = None,
    phys_file: InputPathType | None = None,
    phys_json: InputPathType | None = None,
    prefix: str | None = None,
    rvt_shifts: str | None = None,
    rvt_out: bool = False,
    resp_cutoff_freq: float | None = None,
    cardiac_cutoff_freq: float | None = None,
    cardiac_out: bool = False,
    respiration_out: bool = False,
    interp_style: str | None = None,
    fir_order: float | None = None,
    quiet: bool = False,
    demo: bool = False,
    show_graphs: bool = False,
    debug: bool = False,
    slice_offset: str | None = None,
    slice_major: float | None = None,
    slice_order: str | None = None,
    zero_phase_offset: bool = False,
    legacy_transform: float | None = None,
    runner: Runner | None = None,
) -> RetroTsPyOutputs:
    """
    RetroTS.py
    
    Creates slice-based regressors for regressing out components of heart rate,
    respiration, and respiration volume per time using independent data files or
    BIDS formatted files.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        num_slices: Number of slices.
        volume_tr: Volume TR in seconds.
        resp_file: Respiration data file.
        card_file: Cardiac data file.
        phys_fs: Physiological signal sampling frequency in Hz.
        phys_file: BIDS formatted physio file in tab-separated format, can be\
            gzipped.
        phys_json: BIDS formatted physio metadata json file. If not specified,\
            the json corresponding to the phys_file will be loaded.
        prefix: Prefix of output file.
        rvt_shifts: Vector of shifts in seconds of RVT signal. (default is\
            [0:5:20]).
        rvt_out: Flag for writing RVT regressors (default is 1).
        resp_cutoff_freq: Cut-off frequency in Hz for respiratory lowpass\
            filter (default 3 Hz).
        cardiac_cutoff_freq: Cut-off frequency in Hz for cardiac lowpass filter\
            (default 3 Hz).
        cardiac_out: Flag for writing Cardiac regressors (default is 1).
        respiration_out: Flag for writing Respiratory regressors (default is 1).
        interp_style: Resampling kernel (default is 'linear').
        fir_order: Order of FIR filter (default is 40).
        quiet: Show talkative progress as the program runs (default is 1).
        demo: Run demonstration of RetroTS (default is 0).
        show_graphs: Show graphs (default is unset; set with any parameter to\
            view).
        debug: Drop into pdb upon an exception (default is False).
        slice_offset: Vector of slice acquisition time offsets in seconds\
            (default is equivalent of alt+z).
        slice_major: Unknown parameter (default is 1).
        slice_order: Slice timing information in seconds. (default is alt+z).
        zero_phase_offset: Zero phase offset flag.
        legacy_transform: Specify the version of the original Matlab code's\
            transformation (default is 0).
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `RetroTsPyOutputs`).
    """
    params = retro_ts_py_params(
        resp_file=resp_file,
        card_file=card_file,
        phys_fs=phys_fs,
        num_slices=num_slices,
        volume_tr=volume_tr,
        phys_file=phys_file,
        phys_json=phys_json,
        prefix=prefix,
        rvt_shifts=rvt_shifts,
        rvt_out=rvt_out,
        resp_cutoff_freq=resp_cutoff_freq,
        cardiac_cutoff_freq=cardiac_cutoff_freq,
        cardiac_out=cardiac_out,
        respiration_out=respiration_out,
        interp_style=interp_style,
        fir_order=fir_order,
        quiet=quiet,
        demo=demo,
        show_graphs=show_graphs,
        debug=debug,
        slice_offset=slice_offset,
        slice_major=slice_major,
        slice_order=slice_order,
        zero_phase_offset=zero_phase_offset,
        legacy_transform=legacy_transform,
    )
    return retro_ts_py_execute(params, runner)


__all__ = [
    "RETRO_TS_PY_METADATA",
    "RetroTsPyOutputs",
    "RetroTsPyParamsDict",
    "RetroTsPyParamsDictTagged",
    "retro_ts_py",
    "retro_ts_py_execute",
    "retro_ts_py_params",
]
