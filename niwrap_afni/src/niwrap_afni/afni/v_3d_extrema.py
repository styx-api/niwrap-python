# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

V_3D_EXTREMA_METADATA = Metadata(
    id="1b4e88acaad15e743886a4b6ef801e6fd7558f48.boutiques",
    name="3dExtrema",
    package="afni",
    container_image_tag="afni/afni_make_build:AFNI_24.2.06",
)


_V3dExtremaParamsDictNoTag = typing.TypedDict('_V3dExtremaParamsDictNoTag', {
    "input_dataset": InputPathType,
    "output_prefix": typing.NotRequired[str | None],
    "output_session": typing.NotRequired[str | None],
    "quiet": bool,
    "mask_file": typing.NotRequired[InputPathType | None],
    "mask_threshold": typing.NotRequired[float | None],
    "data_threshold": typing.NotRequired[float | None],
    "n_best": typing.NotRequired[float | None],
    "separation_distance": typing.NotRequired[float | None],
    "minima": bool,
    "maxima": bool,
    "strict": bool,
    "partial": bool,
    "interior": bool,
    "closure": bool,
    "slice": bool,
    "volume": bool,
    "remove": bool,
    "average": bool,
    "weight": bool,
})
V3dExtremaParamsDictTagged = typing.TypedDict('V3dExtremaParamsDictTagged', {
    "@type": typing.Literal["afni/3dExtrema"],
    "input_dataset": InputPathType,
    "output_prefix": typing.NotRequired[str | None],
    "output_session": typing.NotRequired[str | None],
    "quiet": bool,
    "mask_file": typing.NotRequired[InputPathType | None],
    "mask_threshold": typing.NotRequired[float | None],
    "data_threshold": typing.NotRequired[float | None],
    "n_best": typing.NotRequired[float | None],
    "separation_distance": typing.NotRequired[float | None],
    "minima": bool,
    "maxima": bool,
    "strict": bool,
    "partial": bool,
    "interior": bool,
    "closure": bool,
    "slice": bool,
    "volume": bool,
    "remove": bool,
    "average": bool,
    "weight": bool,
})
V3dExtremaParamsDict = _V3dExtremaParamsDictNoTag | V3dExtremaParamsDictTagged


class V3dExtremaOutputs(typing.NamedTuple):
    """
    Output object returned when calling `V3dExtremaParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    output_head_file: OutputPathType | None
    """Output HEAD file"""
    output_brik_file: OutputPathType | None
    """Output BRIK file"""


def v_3d_extrema_params(
    input_dataset: InputPathType,
    output_prefix: str | None = None,
    output_session: str | None = None,
    quiet: bool = False,
    mask_file: InputPathType | None = None,
    mask_threshold: float | None = None,
    data_threshold: float | None = None,
    n_best: float | None = None,
    separation_distance: float | None = None,
    minima: bool = False,
    maxima: bool = False,
    strict: bool = False,
    partial: bool = False,
    interior: bool = False,
    closure: bool = False,
    slice_: bool = False,
    volume: bool = False,
    remove: bool = False,
    average: bool = False,
    weight: bool = False,
) -> V3dExtremaParamsDictTagged:
    """
    Build parameters.
    
    Args:
        input_dataset: Input dataset (e.g. dataset+tlrc'[sub-brick]').
        output_prefix: Prefix for the output dataset name.
        output_session: Directory for the output dataset session.
        quiet: Suppress screen output.
        mask_file: Mask statistic from file.
        mask_threshold: Only voxels whose mask statistic is >= m in absolute\
            value will be considered.
        data_threshold: Only voxels whose value (intensity) is greater than d\
            in absolute value will be considered.
        n_best: Only print the first N extrema.
        separation_distance: Minimum separation distance (in mm) for distinct\
            extrema.
        minima: Find local minima.
        maxima: Find local maxima (default).
        strict: Use strict inequality for extrema (default).
        partial: Use partial inequality for extrema.
        interior: Extrema must be interior points (default).
        closure: Extrema may be boundary points.
        slice_: Consider each slice separately (default).
        volume: Consider the volume as a whole.
        remove: Remove all but strongest of neighboring extrema (default).
        average: Replace neighboring extrema by average.
        weight: Replace neighboring extrema by weighted average.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "afni/3dExtrema",
        "input_dataset": input_dataset,
        "quiet": quiet,
        "minima": minima,
        "maxima": maxima,
        "strict": strict,
        "partial": partial,
        "interior": interior,
        "closure": closure,
        "slice": slice_,
        "volume": volume,
        "remove": remove,
        "average": average,
        "weight": weight,
    }
    if output_prefix is not None:
        params["output_prefix"] = output_prefix
    if output_session is not None:
        params["output_session"] = output_session
    if mask_file is not None:
        params["mask_file"] = mask_file
    if mask_threshold is not None:
        params["mask_threshold"] = mask_threshold
    if data_threshold is not None:
        params["data_threshold"] = data_threshold
    if n_best is not None:
        params["n_best"] = n_best
    if separation_distance is not None:
        params["separation_distance"] = separation_distance
    return params


def v_3d_extrema_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `V3dExtremaParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("input_dataset", None) is None:
        raise StyxValidationError("`input_dataset` must not be None")
    if not isinstance(params["input_dataset"], (pathlib.Path, str)):
        raise StyxValidationError(f'`input_dataset` has the wrong type: Received `{type(params.get("input_dataset", None))}` expected `InputPathType`')
    if params.get("output_prefix", None) is not None:
        if not isinstance(params["output_prefix"], str):
            raise StyxValidationError(f'`output_prefix` has the wrong type: Received `{type(params.get("output_prefix", None))}` expected `str | None`')
    if params.get("output_session", None) is not None:
        if not isinstance(params["output_session"], str):
            raise StyxValidationError(f'`output_session` has the wrong type: Received `{type(params.get("output_session", None))}` expected `str | None`')
    if params.get("quiet", False) is None:
        raise StyxValidationError("`quiet` must not be None")
    if not isinstance(params["quiet"], bool):
        raise StyxValidationError(f'`quiet` has the wrong type: Received `{type(params.get("quiet", False))}` expected `bool`')
    if params.get("mask_file", None) is not None:
        if not isinstance(params["mask_file"], (pathlib.Path, str)):
            raise StyxValidationError(f'`mask_file` has the wrong type: Received `{type(params.get("mask_file", None))}` expected `InputPathType | None`')
    if params.get("mask_threshold", None) is not None:
        if not isinstance(params["mask_threshold"], (float, int)):
            raise StyxValidationError(f'`mask_threshold` has the wrong type: Received `{type(params.get("mask_threshold", None))}` expected `float | None`')
    if params.get("data_threshold", None) is not None:
        if not isinstance(params["data_threshold"], (float, int)):
            raise StyxValidationError(f'`data_threshold` has the wrong type: Received `{type(params.get("data_threshold", None))}` expected `float | None`')
    if params.get("n_best", None) is not None:
        if not isinstance(params["n_best"], (float, int)):
            raise StyxValidationError(f'`n_best` has the wrong type: Received `{type(params.get("n_best", None))}` expected `float | None`')
    if params.get("separation_distance", None) is not None:
        if not isinstance(params["separation_distance"], (float, int)):
            raise StyxValidationError(f'`separation_distance` has the wrong type: Received `{type(params.get("separation_distance", None))}` expected `float | None`')
    if params.get("minima", False) is None:
        raise StyxValidationError("`minima` must not be None")
    if not isinstance(params["minima"], bool):
        raise StyxValidationError(f'`minima` has the wrong type: Received `{type(params.get("minima", False))}` expected `bool`')
    if params.get("maxima", False) is None:
        raise StyxValidationError("`maxima` must not be None")
    if not isinstance(params["maxima"], bool):
        raise StyxValidationError(f'`maxima` has the wrong type: Received `{type(params.get("maxima", False))}` expected `bool`')
    if params.get("strict", False) is None:
        raise StyxValidationError("`strict` must not be None")
    if not isinstance(params["strict"], bool):
        raise StyxValidationError(f'`strict` has the wrong type: Received `{type(params.get("strict", False))}` expected `bool`')
    if params.get("partial", False) is None:
        raise StyxValidationError("`partial` must not be None")
    if not isinstance(params["partial"], bool):
        raise StyxValidationError(f'`partial` has the wrong type: Received `{type(params.get("partial", False))}` expected `bool`')
    if params.get("interior", False) is None:
        raise StyxValidationError("`interior` must not be None")
    if not isinstance(params["interior"], bool):
        raise StyxValidationError(f'`interior` has the wrong type: Received `{type(params.get("interior", False))}` expected `bool`')
    if params.get("closure", False) is None:
        raise StyxValidationError("`closure` must not be None")
    if not isinstance(params["closure"], bool):
        raise StyxValidationError(f'`closure` has the wrong type: Received `{type(params.get("closure", False))}` expected `bool`')
    if params.get("slice", False) is None:
        raise StyxValidationError("`slice` must not be None")
    if not isinstance(params["slice"], bool):
        raise StyxValidationError(f'`slice` has the wrong type: Received `{type(params.get("slice", False))}` expected `bool`')
    if params.get("volume", False) is None:
        raise StyxValidationError("`volume` must not be None")
    if not isinstance(params["volume"], bool):
        raise StyxValidationError(f'`volume` has the wrong type: Received `{type(params.get("volume", False))}` expected `bool`')
    if params.get("remove", False) is None:
        raise StyxValidationError("`remove` must not be None")
    if not isinstance(params["remove"], bool):
        raise StyxValidationError(f'`remove` has the wrong type: Received `{type(params.get("remove", False))}` expected `bool`')
    if params.get("average", False) is None:
        raise StyxValidationError("`average` must not be None")
    if not isinstance(params["average"], bool):
        raise StyxValidationError(f'`average` has the wrong type: Received `{type(params.get("average", False))}` expected `bool`')
    if params.get("weight", False) is None:
        raise StyxValidationError("`weight` must not be None")
    if not isinstance(params["weight"], bool):
        raise StyxValidationError(f'`weight` has the wrong type: Received `{type(params.get("weight", False))}` expected `bool`')


def v_3d_extrema_cargs(
    params: V3dExtremaParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("3dExtrema")
    cargs.append(execution.input_file(params.get("input_dataset", None)))
    if params.get("output_prefix", None) is not None:
        cargs.extend([
            "-prefix",
            params.get("output_prefix", None)
        ])
    if params.get("output_session", None) is not None:
        cargs.extend([
            "-session",
            params.get("output_session", None)
        ])
    if params.get("quiet", False):
        cargs.append("-quiet")
    if params.get("mask_file", None) is not None:
        cargs.extend([
            "-mask_file",
            execution.input_file(params.get("mask_file", None))
        ])
    if params.get("mask_threshold", None) is not None:
        cargs.extend([
            "-mask_thr",
            str(params.get("mask_threshold", None))
        ])
    if params.get("data_threshold", None) is not None:
        cargs.extend([
            "-data_thr",
            str(params.get("data_threshold", None))
        ])
    if params.get("n_best", None) is not None:
        cargs.extend([
            "-nbest",
            str(params.get("n_best", None))
        ])
    if params.get("separation_distance", None) is not None:
        cargs.extend([
            "-sep_dist",
            str(params.get("separation_distance", None))
        ])
    if params.get("minima", False):
        cargs.append("-minima")
    if params.get("maxima", False):
        cargs.append("-maxima")
    if params.get("strict", False):
        cargs.append("-strict")
    if params.get("partial", False):
        cargs.append("-partial")
    if params.get("interior", False):
        cargs.append("-interior")
    if params.get("closure", False):
        cargs.append("-closure")
    if params.get("slice", False):
        cargs.append("-slice")
    if params.get("volume", False):
        cargs.append("-volume")
    if params.get("remove", False):
        cargs.append("-remove")
    if params.get("average", False):
        cargs.append("-average")
    if params.get("weight", False):
        cargs.append("-weight")
    return cargs


def v_3d_extrema_outputs(
    params: V3dExtremaParamsDict,
    execution: Execution,
) -> V3dExtremaOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = V3dExtremaOutputs(
        root=execution.output_file("."),
        output_head_file=execution.output_file(params.get("output_prefix", None) + ".HEAD") if (params.get("output_prefix") is not None) else None,
        output_brik_file=execution.output_file(params.get("output_prefix", None) + ".BRIK") if (params.get("output_prefix") is not None) else None,
    )
    return ret


def v_3d_extrema_execute(
    params: V3dExtremaParamsDict,
    runner: Runner | None = None,
) -> V3dExtremaOutputs:
    """
    3dExtrema
    
    Find local extrema (minima or maxima) in 3D datasets.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `V3dExtremaOutputs`).
    """
    v_3d_extrema_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(V_3D_EXTREMA_METADATA)
    params = execution.params(params)
    cargs = v_3d_extrema_cargs(params, execution)
    ret = v_3d_extrema_outputs(params, execution)
    execution.run(cargs)
    return ret


def v_3d_extrema(
    input_dataset: InputPathType,
    output_prefix: str | None = None,
    output_session: str | None = None,
    quiet: bool = False,
    mask_file: InputPathType | None = None,
    mask_threshold: float | None = None,
    data_threshold: float | None = None,
    n_best: float | None = None,
    separation_distance: float | None = None,
    minima: bool = False,
    maxima: bool = False,
    strict: bool = False,
    partial: bool = False,
    interior: bool = False,
    closure: bool = False,
    slice_: bool = False,
    volume: bool = False,
    remove: bool = False,
    average: bool = False,
    weight: bool = False,
    runner: Runner | None = None,
) -> V3dExtremaOutputs:
    """
    3dExtrema
    
    Find local extrema (minima or maxima) in 3D datasets.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        input_dataset: Input dataset (e.g. dataset+tlrc'[sub-brick]').
        output_prefix: Prefix for the output dataset name.
        output_session: Directory for the output dataset session.
        quiet: Suppress screen output.
        mask_file: Mask statistic from file.
        mask_threshold: Only voxels whose mask statistic is >= m in absolute\
            value will be considered.
        data_threshold: Only voxels whose value (intensity) is greater than d\
            in absolute value will be considered.
        n_best: Only print the first N extrema.
        separation_distance: Minimum separation distance (in mm) for distinct\
            extrema.
        minima: Find local minima.
        maxima: Find local maxima (default).
        strict: Use strict inequality for extrema (default).
        partial: Use partial inequality for extrema.
        interior: Extrema must be interior points (default).
        closure: Extrema may be boundary points.
        slice_: Consider each slice separately (default).
        volume: Consider the volume as a whole.
        remove: Remove all but strongest of neighboring extrema (default).
        average: Replace neighboring extrema by average.
        weight: Replace neighboring extrema by weighted average.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `V3dExtremaOutputs`).
    """
    params = v_3d_extrema_params(
        input_dataset=input_dataset,
        output_prefix=output_prefix,
        output_session=output_session,
        quiet=quiet,
        mask_file=mask_file,
        mask_threshold=mask_threshold,
        data_threshold=data_threshold,
        n_best=n_best,
        separation_distance=separation_distance,
        minima=minima,
        maxima=maxima,
        strict=strict,
        partial=partial,
        interior=interior,
        closure=closure,
        slice_=slice_,
        volume=volume,
        remove=remove,
        average=average,
        weight=weight,
    )
    return v_3d_extrema_execute(params, runner)


__all__ = [
    "V3dExtremaOutputs",
    "V3dExtremaParamsDict",
    "V3dExtremaParamsDictTagged",
    "V_3D_EXTREMA_METADATA",
    "v_3d_extrema",
    "v_3d_extrema_execute",
    "v_3d_extrema_params",
]
