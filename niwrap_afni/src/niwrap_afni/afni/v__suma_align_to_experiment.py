# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

V__SUMA_ALIGN_TO_EXPERIMENT_METADATA = Metadata(
    id="759a36ef356f1ca0b7e7edac35edf0400e398072.boutiques",
    name="@SUMA_AlignToExperiment",
    package="afni",
    container_image_tag="afni/afni_make_build:AFNI_24.2.06",
)


_VSumaAlignToExperimentParamsDictNoTag = typing.TypedDict('_VSumaAlignToExperimentParamsDictNoTag', {
    "exp_anat": InputPathType,
    "surf_anat": InputPathType,
    "dxyz": typing.NotRequired[float | None],
    "out_dxyz": typing.NotRequired[float | None],
    "wd": bool,
    "al": bool,
    "al_opt": typing.NotRequired[str | None],
    "ok_change_view": bool,
    "strip_skull": typing.NotRequired[str | None],
    "skull_strip_opt": typing.NotRequired[str | None],
    "align_centers": bool,
    "init_xform": typing.NotRequired[InputPathType | None],
    "EA_clip_below": typing.NotRequired[float | None],
    "prefix": typing.NotRequired[str | None],
    "surf_anat_followers": typing.NotRequired[str | None],
    "followers_interp": typing.NotRequired[str | None],
    "atlas_followers": bool,
    "echo": bool,
    "keep_tmp": bool,
    "overwrite_resp": typing.NotRequired[str | None],
})
VSumaAlignToExperimentParamsDictTagged = typing.TypedDict('VSumaAlignToExperimentParamsDictTagged', {
    "@type": typing.Literal["afni/@SUMA_AlignToExperiment"],
    "exp_anat": InputPathType,
    "surf_anat": InputPathType,
    "dxyz": typing.NotRequired[float | None],
    "out_dxyz": typing.NotRequired[float | None],
    "wd": bool,
    "al": bool,
    "al_opt": typing.NotRequired[str | None],
    "ok_change_view": bool,
    "strip_skull": typing.NotRequired[str | None],
    "skull_strip_opt": typing.NotRequired[str | None],
    "align_centers": bool,
    "init_xform": typing.NotRequired[InputPathType | None],
    "EA_clip_below": typing.NotRequired[float | None],
    "prefix": typing.NotRequired[str | None],
    "surf_anat_followers": typing.NotRequired[str | None],
    "followers_interp": typing.NotRequired[str | None],
    "atlas_followers": bool,
    "echo": bool,
    "keep_tmp": bool,
    "overwrite_resp": typing.NotRequired[str | None],
})
VSumaAlignToExperimentParamsDict = _VSumaAlignToExperimentParamsDictNoTag | VSumaAlignToExperimentParamsDictTagged


class VSumaAlignToExperimentOutputs(typing.NamedTuple):
    """
    Output object returned when calling `VSumaAlignToExperimentParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    aligned_volume: OutputPathType | None
    """Output volume after alignment."""
    additional_followers: OutputPathType | None
    """Output followers dataset after transforming."""


def v__suma_align_to_experiment_params(
    exp_anat: InputPathType,
    surf_anat: InputPathType,
    dxyz: float | None = None,
    out_dxyz: float | None = None,
    wd: bool = False,
    al: bool = False,
    al_opt: str | None = None,
    ok_change_view: bool = False,
    strip_skull: str | None = None,
    skull_strip_opt: str | None = None,
    align_centers: bool = False,
    init_xform: InputPathType | None = None,
    ea_clip_below: float | None = None,
    prefix: str | None = None,
    surf_anat_followers: str | None = None,
    followers_interp: str | None = None,
    atlas_followers: bool = False,
    echo: bool = False,
    keep_tmp: bool = False,
    overwrite_resp: str | None = None,
) -> VSumaAlignToExperimentParamsDictTagged:
    """
    Build parameters.
    
    Args:
        exp_anat: Name of high resolution anatomical data set in register with\
            experimental data.
        surf_anat: Path and name of high resolution antomical data set used to\
            create the surface.
        dxyz: Optional parameter to downsample anatomical volumes to dxyz mm\
            voxel resolution before registration.
        out_dxyz: Output the final aligned volume at a cubic voxelsize of\
            DXYZmm.
        wd: Use 3dWarpDrive's general affine transform (12 param) instead of\
            3dvolreg's 6 parameters.
        al: Use 3dAllineate to do the 12 parameter alignment. Cost function is\
            'lpa'.
        al_opt: Specify set of options to pass to 3dAllineate.
        ok_change_view: Be quiet when view of registered volume is changed to\
            match that of the Experiment_Anatomy.
        strip_skull: Use 3dSkullStrip to remove non-brain tissue.
        skull_strip_opt: Pass the options to 3dSkullStrip.
        align_centers: Add an additional transformation to align the volume\
            centers.
        init_xform: Apply affine transform file to Surface_Anatomy before\
            beginning registration.
        ea_clip_below: Set slices below CLPmm in 'Experiment Anatomy' to zero.
        prefix: Prefix for the output volume.
        surf_anat_followers: Apply the same alignment transform to additional\
            datasets.
        followers_interp: Set the interpolation mode for the follower datasets.
        atlas_followers: Automatically set the followers to be atlases in the\
            directory of -surf_anat.
        echo: Echo all commands to terminal for debugging.
        keep_tmp: Keep temporary files for debugging.
        overwrite_resp: Answer 'overwrite' questions automatically.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "afni/@SUMA_AlignToExperiment",
        "exp_anat": exp_anat,
        "surf_anat": surf_anat,
        "wd": wd,
        "al": al,
        "ok_change_view": ok_change_view,
        "align_centers": align_centers,
        "atlas_followers": atlas_followers,
        "echo": echo,
        "keep_tmp": keep_tmp,
    }
    if dxyz is not None:
        params["dxyz"] = dxyz
    if out_dxyz is not None:
        params["out_dxyz"] = out_dxyz
    if al_opt is not None:
        params["al_opt"] = al_opt
    if strip_skull is not None:
        params["strip_skull"] = strip_skull
    if skull_strip_opt is not None:
        params["skull_strip_opt"] = skull_strip_opt
    if init_xform is not None:
        params["init_xform"] = init_xform
    if ea_clip_below is not None:
        params["EA_clip_below"] = ea_clip_below
    if prefix is not None:
        params["prefix"] = prefix
    if surf_anat_followers is not None:
        params["surf_anat_followers"] = surf_anat_followers
    if followers_interp is not None:
        params["followers_interp"] = followers_interp
    if overwrite_resp is not None:
        params["overwrite_resp"] = overwrite_resp
    return params


def v__suma_align_to_experiment_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `VSumaAlignToExperimentParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("exp_anat", None) is None:
        raise StyxValidationError("`exp_anat` must not be None")
    if not isinstance(params["exp_anat"], (pathlib.Path, str)):
        raise StyxValidationError(f'`exp_anat` has the wrong type: Received `{type(params.get("exp_anat", None))}` expected `InputPathType`')
    if params.get("surf_anat", None) is None:
        raise StyxValidationError("`surf_anat` must not be None")
    if not isinstance(params["surf_anat"], (pathlib.Path, str)):
        raise StyxValidationError(f'`surf_anat` has the wrong type: Received `{type(params.get("surf_anat", None))}` expected `InputPathType`')
    if params.get("dxyz", None) is not None:
        if not isinstance(params["dxyz"], (float, int)):
            raise StyxValidationError(f'`dxyz` has the wrong type: Received `{type(params.get("dxyz", None))}` expected `float | None`')
    if params.get("out_dxyz", None) is not None:
        if not isinstance(params["out_dxyz"], (float, int)):
            raise StyxValidationError(f'`out_dxyz` has the wrong type: Received `{type(params.get("out_dxyz", None))}` expected `float | None`')
    if params.get("wd", False) is None:
        raise StyxValidationError("`wd` must not be None")
    if not isinstance(params["wd"], bool):
        raise StyxValidationError(f'`wd` has the wrong type: Received `{type(params.get("wd", False))}` expected `bool`')
    if params.get("al", False) is None:
        raise StyxValidationError("`al` must not be None")
    if not isinstance(params["al"], bool):
        raise StyxValidationError(f'`al` has the wrong type: Received `{type(params.get("al", False))}` expected `bool`')
    if params.get("al_opt", None) is not None:
        if not isinstance(params["al_opt"], str):
            raise StyxValidationError(f'`al_opt` has the wrong type: Received `{type(params.get("al_opt", None))}` expected `str | None`')
    if params.get("ok_change_view", False) is None:
        raise StyxValidationError("`ok_change_view` must not be None")
    if not isinstance(params["ok_change_view"], bool):
        raise StyxValidationError(f'`ok_change_view` has the wrong type: Received `{type(params.get("ok_change_view", False))}` expected `bool`')
    if params.get("strip_skull", None) is not None:
        if not isinstance(params["strip_skull"], str):
            raise StyxValidationError(f'`strip_skull` has the wrong type: Received `{type(params.get("strip_skull", None))}` expected `str | None`')
    if params.get("skull_strip_opt", None) is not None:
        if not isinstance(params["skull_strip_opt"], str):
            raise StyxValidationError(f'`skull_strip_opt` has the wrong type: Received `{type(params.get("skull_strip_opt", None))}` expected `str | None`')
    if params.get("align_centers", False) is None:
        raise StyxValidationError("`align_centers` must not be None")
    if not isinstance(params["align_centers"], bool):
        raise StyxValidationError(f'`align_centers` has the wrong type: Received `{type(params.get("align_centers", False))}` expected `bool`')
    if params.get("init_xform", None) is not None:
        if not isinstance(params["init_xform"], (pathlib.Path, str)):
            raise StyxValidationError(f'`init_xform` has the wrong type: Received `{type(params.get("init_xform", None))}` expected `InputPathType | None`')
    if params.get("EA_clip_below", None) is not None:
        if not isinstance(params["EA_clip_below"], (float, int)):
            raise StyxValidationError(f'`EA_clip_below` has the wrong type: Received `{type(params.get("EA_clip_below", None))}` expected `float | None`')
    if params.get("prefix", None) is not None:
        if not isinstance(params["prefix"], str):
            raise StyxValidationError(f'`prefix` has the wrong type: Received `{type(params.get("prefix", None))}` expected `str | None`')
    if params.get("surf_anat_followers", None) is not None:
        if not isinstance(params["surf_anat_followers"], str):
            raise StyxValidationError(f'`surf_anat_followers` has the wrong type: Received `{type(params.get("surf_anat_followers", None))}` expected `str | None`')
    if params.get("followers_interp", None) is not None:
        if not isinstance(params["followers_interp"], str):
            raise StyxValidationError(f'`followers_interp` has the wrong type: Received `{type(params.get("followers_interp", None))}` expected `str | None`')
    if params.get("atlas_followers", False) is None:
        raise StyxValidationError("`atlas_followers` must not be None")
    if not isinstance(params["atlas_followers"], bool):
        raise StyxValidationError(f'`atlas_followers` has the wrong type: Received `{type(params.get("atlas_followers", False))}` expected `bool`')
    if params.get("echo", False) is None:
        raise StyxValidationError("`echo` must not be None")
    if not isinstance(params["echo"], bool):
        raise StyxValidationError(f'`echo` has the wrong type: Received `{type(params.get("echo", False))}` expected `bool`')
    if params.get("keep_tmp", False) is None:
        raise StyxValidationError("`keep_tmp` must not be None")
    if not isinstance(params["keep_tmp"], bool):
        raise StyxValidationError(f'`keep_tmp` has the wrong type: Received `{type(params.get("keep_tmp", False))}` expected `bool`')
    if params.get("overwrite_resp", None) is not None:
        if not isinstance(params["overwrite_resp"], str):
            raise StyxValidationError(f'`overwrite_resp` has the wrong type: Received `{type(params.get("overwrite_resp", None))}` expected `str | None`')


def v__suma_align_to_experiment_cargs(
    params: VSumaAlignToExperimentParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("@SUMA_AlignToExperiment")
    cargs.extend([
        "-exp_anat",
        execution.input_file(params.get("exp_anat", None))
    ])
    cargs.extend([
        "-surf_anat",
        execution.input_file(params.get("surf_anat", None))
    ])
    if params.get("dxyz", None) is not None:
        cargs.extend([
            "-dxyz",
            str(params.get("dxyz", None))
        ])
    if params.get("out_dxyz", None) is not None:
        cargs.extend([
            "-out_dxyz",
            str(params.get("out_dxyz", None))
        ])
    if params.get("wd", False):
        cargs.append("-wd")
    if params.get("al", False):
        cargs.append("-al")
    if params.get("al_opt", None) is not None:
        cargs.extend([
            "-al_opt",
            params.get("al_opt", None)
        ])
    if params.get("ok_change_view", False):
        cargs.append("-ok_change_view")
    if params.get("strip_skull", None) is not None:
        cargs.extend([
            "-strip_skull",
            params.get("strip_skull", None)
        ])
    if params.get("skull_strip_opt", None) is not None:
        cargs.extend([
            "-skull_strip_opt",
            params.get("skull_strip_opt", None)
        ])
    if params.get("align_centers", False):
        cargs.append("-align_centers")
    if params.get("init_xform", None) is not None:
        cargs.extend([
            "-init_xform",
            execution.input_file(params.get("init_xform", None))
        ])
    if params.get("EA_clip_below", None) is not None:
        cargs.extend([
            "-EA_clip_below",
            str(params.get("EA_clip_below", None))
        ])
    if params.get("prefix", None) is not None:
        cargs.extend([
            "-prefix",
            params.get("prefix", None)
        ])
    if params.get("surf_anat_followers", None) is not None:
        cargs.extend([
            "-surf_anat_followers",
            params.get("surf_anat_followers", None)
        ])
    if params.get("followers_interp", None) is not None:
        cargs.extend([
            "-followers_interp",
            params.get("followers_interp", None)
        ])
    if params.get("atlas_followers", False):
        cargs.append("-atlas_followers")
    if params.get("echo", False):
        cargs.append("-echo")
    if params.get("keep_tmp", False):
        cargs.append("-keep_tmp")
    if params.get("overwrite_resp", None) is not None:
        cargs.extend([
            "-overwrite_resp",
            params.get("overwrite_resp", None)
        ])
    return cargs


def v__suma_align_to_experiment_outputs(
    params: VSumaAlignToExperimentParamsDict,
    execution: Execution,
) -> VSumaAlignToExperimentOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = VSumaAlignToExperimentOutputs(
        root=execution.output_file("."),
        aligned_volume=execution.output_file(params.get("prefix", None) + "_Alnd_Exp.nii.gz") if (params.get("prefix") is not None) else None,
        additional_followers=execution.output_file(params.get("prefix", None) + "_Alnd_Exp_Fdset.nii.gz") if (params.get("prefix") is not None) else None,
    )
    return ret


def v__suma_align_to_experiment_execute(
    params: VSumaAlignToExperimentParamsDict,
    runner: Runner | None = None,
) -> VSumaAlignToExperimentOutputs:
    """
    @SUMA_AlignToExperiment
    
    Creates a version of Surface Anatomy that is registered to Experiment
    Anatomy.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `VSumaAlignToExperimentOutputs`).
    """
    v__suma_align_to_experiment_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(V__SUMA_ALIGN_TO_EXPERIMENT_METADATA)
    params = execution.params(params)
    cargs = v__suma_align_to_experiment_cargs(params, execution)
    ret = v__suma_align_to_experiment_outputs(params, execution)
    execution.run(cargs)
    return ret


def v__suma_align_to_experiment(
    exp_anat: InputPathType,
    surf_anat: InputPathType,
    dxyz: float | None = None,
    out_dxyz: float | None = None,
    wd: bool = False,
    al: bool = False,
    al_opt: str | None = None,
    ok_change_view: bool = False,
    strip_skull: str | None = None,
    skull_strip_opt: str | None = None,
    align_centers: bool = False,
    init_xform: InputPathType | None = None,
    ea_clip_below: float | None = None,
    prefix: str | None = None,
    surf_anat_followers: str | None = None,
    followers_interp: str | None = None,
    atlas_followers: bool = False,
    echo: bool = False,
    keep_tmp: bool = False,
    overwrite_resp: str | None = None,
    runner: Runner | None = None,
) -> VSumaAlignToExperimentOutputs:
    """
    @SUMA_AlignToExperiment
    
    Creates a version of Surface Anatomy that is registered to Experiment
    Anatomy.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        exp_anat: Name of high resolution anatomical data set in register with\
            experimental data.
        surf_anat: Path and name of high resolution antomical data set used to\
            create the surface.
        dxyz: Optional parameter to downsample anatomical volumes to dxyz mm\
            voxel resolution before registration.
        out_dxyz: Output the final aligned volume at a cubic voxelsize of\
            DXYZmm.
        wd: Use 3dWarpDrive's general affine transform (12 param) instead of\
            3dvolreg's 6 parameters.
        al: Use 3dAllineate to do the 12 parameter alignment. Cost function is\
            'lpa'.
        al_opt: Specify set of options to pass to 3dAllineate.
        ok_change_view: Be quiet when view of registered volume is changed to\
            match that of the Experiment_Anatomy.
        strip_skull: Use 3dSkullStrip to remove non-brain tissue.
        skull_strip_opt: Pass the options to 3dSkullStrip.
        align_centers: Add an additional transformation to align the volume\
            centers.
        init_xform: Apply affine transform file to Surface_Anatomy before\
            beginning registration.
        ea_clip_below: Set slices below CLPmm in 'Experiment Anatomy' to zero.
        prefix: Prefix for the output volume.
        surf_anat_followers: Apply the same alignment transform to additional\
            datasets.
        followers_interp: Set the interpolation mode for the follower datasets.
        atlas_followers: Automatically set the followers to be atlases in the\
            directory of -surf_anat.
        echo: Echo all commands to terminal for debugging.
        keep_tmp: Keep temporary files for debugging.
        overwrite_resp: Answer 'overwrite' questions automatically.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `VSumaAlignToExperimentOutputs`).
    """
    params = v__suma_align_to_experiment_params(
        exp_anat=exp_anat,
        surf_anat=surf_anat,
        dxyz=dxyz,
        out_dxyz=out_dxyz,
        wd=wd,
        al=al,
        al_opt=al_opt,
        ok_change_view=ok_change_view,
        strip_skull=strip_skull,
        skull_strip_opt=skull_strip_opt,
        align_centers=align_centers,
        init_xform=init_xform,
        ea_clip_below=ea_clip_below,
        prefix=prefix,
        surf_anat_followers=surf_anat_followers,
        followers_interp=followers_interp,
        atlas_followers=atlas_followers,
        echo=echo,
        keep_tmp=keep_tmp,
        overwrite_resp=overwrite_resp,
    )
    return v__suma_align_to_experiment_execute(params, runner)


__all__ = [
    "VSumaAlignToExperimentOutputs",
    "VSumaAlignToExperimentParamsDict",
    "VSumaAlignToExperimentParamsDictTagged",
    "V__SUMA_ALIGN_TO_EXPERIMENT_METADATA",
    "v__suma_align_to_experiment",
    "v__suma_align_to_experiment_execute",
    "v__suma_align_to_experiment_params",
]
