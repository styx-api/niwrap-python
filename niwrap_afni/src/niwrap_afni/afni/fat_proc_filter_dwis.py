# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

FAT_PROC_FILTER_DWIS_METADATA = Metadata(
    id="9978a84be8a7011c9a5406c54e68397255149cfc.boutiques",
    name="fat_proc_filter_dwis",
    package="afni",
    container_image_tag="afni/afni_make_build:AFNI_24.2.06",
)


_FatProcFilterDwisParamsDictNoTag = typing.TypedDict('_FatProcFilterDwisParamsDictNoTag', {
    "input_dwi": InputPathType,
    "input_gradient": InputPathType,
    "select_string": str,
    "select_file": typing.NotRequired[InputPathType | None],
    "output_prefix": str,
    "input_bvals": typing.NotRequired[InputPathType | None],
    "unit_mag_out": bool,
    "qc_prefix": typing.NotRequired[str | None],
    "no_qc_view": bool,
    "no_cmd_out": bool,
    "do_movie": typing.NotRequired[typing.Literal["AGIF", "MPEG"] | None],
})
FatProcFilterDwisParamsDictTagged = typing.TypedDict('FatProcFilterDwisParamsDictTagged', {
    "@type": typing.Literal["afni/fat_proc_filter_dwis"],
    "input_dwi": InputPathType,
    "input_gradient": InputPathType,
    "select_string": str,
    "select_file": typing.NotRequired[InputPathType | None],
    "output_prefix": str,
    "input_bvals": typing.NotRequired[InputPathType | None],
    "unit_mag_out": bool,
    "qc_prefix": typing.NotRequired[str | None],
    "no_qc_view": bool,
    "no_cmd_out": bool,
    "do_movie": typing.NotRequired[typing.Literal["AGIF", "MPEG"] | None],
})
FatProcFilterDwisParamsDict = _FatProcFilterDwisParamsDictNoTag | FatProcFilterDwisParamsDictTagged


class FatProcFilterDwisOutputs(typing.NamedTuple):
    """
    Output object returned when calling `FatProcFilterDwisParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    filtered_dwi: OutputPathType
    """Filtered 4D DWI dataset."""
    filtered_bvecs: OutputPathType
    """Filtered gradient file matching input format."""
    filtered_bvals: OutputPathType
    """Filtered b-values file, if provided."""


def fat_proc_filter_dwis_params(
    input_dwi: InputPathType,
    input_gradient: InputPathType,
    select_string: str,
    output_prefix: str,
    select_file: InputPathType | None = None,
    input_bvals: InputPathType | None = None,
    unit_mag_out: bool = False,
    qc_prefix: str | None = None,
    no_qc_view: bool = False,
    no_cmd_out: bool = False,
    do_movie: typing.Literal["AGIF", "MPEG"] | None = None,
) -> FatProcFilterDwisParamsDictTagged:
    """
    Build parameters.
    
    Args:
        input_dwi: Name of a 4D file of DWIs (required).
        input_gradient: Bvec/bmat file from the gradients. Required. One of\
            these options must be used: -in_col_matA, -in_col_matT, -in_col_vec,\
            -in_row_vec.
        select_string: A string of indices and index ranges for selecting which\
            volumes/grads/bvals to keep. This string gets applied to the volume,\
            bval|bvec|bmat files for an input set. Either this or -select_file is\
            required.
        output_prefix: Output prefix for all the volumes and text files.\
            Required.
        select_file: A file containing a string of indices and index ranges for\
            selecting which volumes/grads/bvals to keep. This string gets applied\
            to the volume, bval|bvec|bmat files for an input set. Either this or\
            -select is required.
        input_bvals: If the bvec/bmat is a file of unit-magnitude values, then\
            the bvalues can be input.
        unit_mag_out: Ensure that the output grad information is unit\
            magnitude.
        qc_prefix: Set the prefix of the QC image files separately.
        no_qc_view: Turn off generating QC image files.
        no_cmd_out: Don't save the command line call of this program and the\
            location where it was run.
        do_movie: Output a movie of the newly created dataset (AGIF or MPEG).
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "afni/fat_proc_filter_dwis",
        "input_dwi": input_dwi,
        "input_gradient": input_gradient,
        "select_string": select_string,
        "output_prefix": output_prefix,
        "unit_mag_out": unit_mag_out,
        "no_qc_view": no_qc_view,
        "no_cmd_out": no_cmd_out,
    }
    if select_file is not None:
        params["select_file"] = select_file
    if input_bvals is not None:
        params["input_bvals"] = input_bvals
    if qc_prefix is not None:
        params["qc_prefix"] = qc_prefix
    if do_movie is not None:
        params["do_movie"] = do_movie
    return params


def fat_proc_filter_dwis_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `FatProcFilterDwisParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("input_dwi", None) is None:
        raise StyxValidationError("`input_dwi` must not be None")
    if not isinstance(params["input_dwi"], (pathlib.Path, str)):
        raise StyxValidationError(f'`input_dwi` has the wrong type: Received `{type(params.get("input_dwi", None))}` expected `InputPathType`')
    if params.get("input_gradient", None) is None:
        raise StyxValidationError("`input_gradient` must not be None")
    if not isinstance(params["input_gradient"], (pathlib.Path, str)):
        raise StyxValidationError(f'`input_gradient` has the wrong type: Received `{type(params.get("input_gradient", None))}` expected `InputPathType`')
    if params.get("select_string", None) is None:
        raise StyxValidationError("`select_string` must not be None")
    if not isinstance(params["select_string"], str):
        raise StyxValidationError(f'`select_string` has the wrong type: Received `{type(params.get("select_string", None))}` expected `str`')
    if params.get("select_file", None) is not None:
        if not isinstance(params["select_file"], (pathlib.Path, str)):
            raise StyxValidationError(f'`select_file` has the wrong type: Received `{type(params.get("select_file", None))}` expected `InputPathType | None`')
    if params.get("output_prefix", None) is None:
        raise StyxValidationError("`output_prefix` must not be None")
    if not isinstance(params["output_prefix"], str):
        raise StyxValidationError(f'`output_prefix` has the wrong type: Received `{type(params.get("output_prefix", None))}` expected `str`')
    if params.get("input_bvals", None) is not None:
        if not isinstance(params["input_bvals"], (pathlib.Path, str)):
            raise StyxValidationError(f'`input_bvals` has the wrong type: Received `{type(params.get("input_bvals", None))}` expected `InputPathType | None`')
    if params.get("unit_mag_out", False) is None:
        raise StyxValidationError("`unit_mag_out` must not be None")
    if not isinstance(params["unit_mag_out"], bool):
        raise StyxValidationError(f'`unit_mag_out` has the wrong type: Received `{type(params.get("unit_mag_out", False))}` expected `bool`')
    if params.get("qc_prefix", None) is not None:
        if not isinstance(params["qc_prefix"], str):
            raise StyxValidationError(f'`qc_prefix` has the wrong type: Received `{type(params.get("qc_prefix", None))}` expected `str | None`')
    if params.get("no_qc_view", False) is None:
        raise StyxValidationError("`no_qc_view` must not be None")
    if not isinstance(params["no_qc_view"], bool):
        raise StyxValidationError(f'`no_qc_view` has the wrong type: Received `{type(params.get("no_qc_view", False))}` expected `bool`')
    if params.get("no_cmd_out", False) is None:
        raise StyxValidationError("`no_cmd_out` must not be None")
    if not isinstance(params["no_cmd_out"], bool):
        raise StyxValidationError(f'`no_cmd_out` has the wrong type: Received `{type(params.get("no_cmd_out", False))}` expected `bool`')
    if params.get("do_movie", None) is not None:
        if not isinstance(params["do_movie"], str):
            raise StyxValidationError(f'`do_movie` has the wrong type: Received `{type(params.get("do_movie", None))}` expected `typing.Literal["AGIF", "MPEG"] | None`')
        if params["do_movie"] not in ["AGIF", "MPEG"]:
            raise StyxValidationError("Parameter `do_movie` must be one of [\"AGIF\", \"MPEG\"]")


def fat_proc_filter_dwis_cargs(
    params: FatProcFilterDwisParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("fat_proc_filter_dwis")
    cargs.extend([
        "-in_dwi",
        execution.input_file(params.get("input_dwi", None))
    ])
    cargs.extend([
        "-in_col_matA|-in_col_matT|-in_col_vec|-in_row_vec",
        execution.input_file(params.get("input_gradient", None))
    ])
    cargs.extend([
        "-select",
        params.get("select_string", None)
    ])
    if params.get("select_file", None) is not None:
        cargs.extend([
            "-select_file",
            execution.input_file(params.get("select_file", None))
        ])
    cargs.extend([
        "-prefix",
        params.get("output_prefix", None)
    ])
    if params.get("input_bvals", None) is not None:
        cargs.extend([
            "-in_bvals",
            execution.input_file(params.get("input_bvals", None))
        ])
    if params.get("unit_mag_out", False):
        cargs.append("-unit_mag_out")
    if params.get("qc_prefix", None) is not None:
        cargs.extend([
            "-qc_prefix",
            params.get("qc_prefix", None)
        ])
    if params.get("no_qc_view", False):
        cargs.append("-no_qc_view")
    if params.get("no_cmd_out", False):
        cargs.append("-no_cmd_out")
    if params.get("do_movie", None) is not None:
        cargs.extend([
            "-do_movie",
            params.get("do_movie", None)
        ])
    return cargs


def fat_proc_filter_dwis_outputs(
    params: FatProcFilterDwisParamsDict,
    execution: Execution,
) -> FatProcFilterDwisOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = FatProcFilterDwisOutputs(
        root=execution.output_file("."),
        filtered_dwi=execution.output_file(params.get("output_prefix", None) + "_filtered.nii.gz"),
        filtered_bvecs=execution.output_file(params.get("output_prefix", None) + "_filtered.bvecs"),
        filtered_bvals=execution.output_file(params.get("output_prefix", None) + "_filtered.bvals"),
    )
    return ret


def fat_proc_filter_dwis_execute(
    params: FatProcFilterDwisParamsDict,
    runner: Runner | None = None,
) -> FatProcFilterDwisOutputs:
    """
    fat_proc_filter_dwis
    
    Filter out user-found and user-defined bad volumes from DWI data sets.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `FatProcFilterDwisOutputs`).
    """
    fat_proc_filter_dwis_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(FAT_PROC_FILTER_DWIS_METADATA)
    params = execution.params(params)
    cargs = fat_proc_filter_dwis_cargs(params, execution)
    ret = fat_proc_filter_dwis_outputs(params, execution)
    execution.run(cargs)
    return ret


def fat_proc_filter_dwis(
    input_dwi: InputPathType,
    input_gradient: InputPathType,
    select_string: str,
    output_prefix: str,
    select_file: InputPathType | None = None,
    input_bvals: InputPathType | None = None,
    unit_mag_out: bool = False,
    qc_prefix: str | None = None,
    no_qc_view: bool = False,
    no_cmd_out: bool = False,
    do_movie: typing.Literal["AGIF", "MPEG"] | None = None,
    runner: Runner | None = None,
) -> FatProcFilterDwisOutputs:
    """
    fat_proc_filter_dwis
    
    Filter out user-found and user-defined bad volumes from DWI data sets.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        input_dwi: Name of a 4D file of DWIs (required).
        input_gradient: Bvec/bmat file from the gradients. Required. One of\
            these options must be used: -in_col_matA, -in_col_matT, -in_col_vec,\
            -in_row_vec.
        select_string: A string of indices and index ranges for selecting which\
            volumes/grads/bvals to keep. This string gets applied to the volume,\
            bval|bvec|bmat files for an input set. Either this or -select_file is\
            required.
        output_prefix: Output prefix for all the volumes and text files.\
            Required.
        select_file: A file containing a string of indices and index ranges for\
            selecting which volumes/grads/bvals to keep. This string gets applied\
            to the volume, bval|bvec|bmat files for an input set. Either this or\
            -select is required.
        input_bvals: If the bvec/bmat is a file of unit-magnitude values, then\
            the bvalues can be input.
        unit_mag_out: Ensure that the output grad information is unit\
            magnitude.
        qc_prefix: Set the prefix of the QC image files separately.
        no_qc_view: Turn off generating QC image files.
        no_cmd_out: Don't save the command line call of this program and the\
            location where it was run.
        do_movie: Output a movie of the newly created dataset (AGIF or MPEG).
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `FatProcFilterDwisOutputs`).
    """
    params = fat_proc_filter_dwis_params(
        input_dwi=input_dwi,
        input_gradient=input_gradient,
        select_string=select_string,
        select_file=select_file,
        output_prefix=output_prefix,
        input_bvals=input_bvals,
        unit_mag_out=unit_mag_out,
        qc_prefix=qc_prefix,
        no_qc_view=no_qc_view,
        no_cmd_out=no_cmd_out,
        do_movie=do_movie,
    )
    return fat_proc_filter_dwis_execute(params, runner)


__all__ = [
    "FAT_PROC_FILTER_DWIS_METADATA",
    "FatProcFilterDwisOutputs",
    "FatProcFilterDwisParamsDict",
    "FatProcFilterDwisParamsDictTagged",
    "fat_proc_filter_dwis",
    "fat_proc_filter_dwis_execute",
    "fat_proc_filter_dwis_params",
]
