# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

V_3DCLUST_METADATA = Metadata(
    id="bb71dd389ead7c86b04372e27cd788efc250aed1.boutiques",
    name="3dclust",
    package="afni",
    container_image_tag="afni/afni_make_build:AFNI_24.2.06",
)


_V3dclustParamsDictNoTag = typing.TypedDict('_V3dclustParamsDictNoTag', {
    "rmm": typing.NotRequired[float | None],
    "vmul": typing.NotRequired[float | None],
    "datasets": list[InputPathType],
    "nn1": bool,
    "nn2": bool,
    "nn3": bool,
    "noabs": bool,
    "summarize": bool,
    "nosum": bool,
    "verb": bool,
    "oned_format": bool,
    "no_oned_format": bool,
    "quiet": bool,
    "mni": bool,
    "isovalue": bool,
    "isomerge": bool,
    "inmask": bool,
    "prefix": typing.NotRequired[str | None],
    "savemask": typing.NotRequired[str | None],
    "binary": bool,
})
V3dclustParamsDictTagged = typing.TypedDict('V3dclustParamsDictTagged', {
    "@type": typing.Literal["afni/3dclust"],
    "rmm": typing.NotRequired[float | None],
    "vmul": typing.NotRequired[float | None],
    "datasets": list[InputPathType],
    "nn1": bool,
    "nn2": bool,
    "nn3": bool,
    "noabs": bool,
    "summarize": bool,
    "nosum": bool,
    "verb": bool,
    "oned_format": bool,
    "no_oned_format": bool,
    "quiet": bool,
    "mni": bool,
    "isovalue": bool,
    "isomerge": bool,
    "inmask": bool,
    "prefix": typing.NotRequired[str | None],
    "savemask": typing.NotRequired[str | None],
    "binary": bool,
})
V3dclustParamsDict = _V3dclustParamsDictNoTag | V3dclustParamsDictTagged


class V3dclustOutputs(typing.NamedTuple):
    """
    Output object returned when calling `V3dclustParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    prefixed_output: OutputPathType | None
    """New dataset with clusters set to zero based on prefix."""
    ordered_mask_output: OutputPathType | None
    """Ordered mask dataset based on savemask prefix."""


def v_3dclust_params(
    datasets: list[InputPathType],
    rmm: float | None = None,
    vmul: float | None = None,
    nn1: bool = False,
    nn2: bool = False,
    nn3: bool = False,
    noabs: bool = False,
    summarize: bool = False,
    nosum: bool = False,
    verb: bool = False,
    oned_format: bool = False,
    no_oned_format: bool = False,
    quiet: bool = False,
    mni: bool = False,
    isovalue: bool = False,
    isomerge: bool = False,
    inmask: bool = False,
    prefix: str | None = None,
    savemask: str | None = None,
    binary: bool = False,
) -> V3dclustParamsDictTagged:
    """
    Build parameters.
    
    Args:
        datasets: Input dataset(s). More than one allowed, but only the first\
            sub-brick of the dataset.
        rmm: Cluster connection radius in millimeters.
        vmul: Minimum cluster volume in micro-liters or minimum number of\
            voxels if negative.
        nn1: 1st nearest-neighbor clustering (faces touching).
        nn2: 2nd nearest-neighbor clustering (edges touching).
        nn3: 3rd nearest-neighbor clustering (corners touching).
        noabs: Use the signed voxel intensities for calculations.
        summarize: Write out only the total nonzero voxel count and volume for\
            each dataset.
        nosum: Suppress printout of the totals.
        verb: Print out a progress report to stderr as computations proceed.
        oned_format: Write output in 1D format (default).
        no_oned_format: Do not write output in 1D format.
        quiet: Suppress all non-essential output.
        mni: Transform output xyz-coordinates from TLRC to MNI space if the\
            input dataset has the +tlrc view.
        isovalue: Clusters will be formed only from contiguous voxels that also\
            have the same value.
        isomerge: Clusters will be formed from each distinct value in the\
            dataset; spatial contiguity will not be used.
        inmask: Use an internal mask from the dataset to eliminate voxels\
            before clustering.
        prefix: Write a new dataset that is a copy of the input, but with all\
            voxels not in a cluster set to zero; provide a prefix for the new\
            dataset.
        savemask: Write a new dataset that is an ordered mask where the largest\
            cluster is labeled '1', the next largest '2', and so forth.
        binary: Turn the output of '-savemask' into a binary (0 or 1) mask.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "afni/3dclust",
        "datasets": datasets,
        "nn1": nn1,
        "nn2": nn2,
        "nn3": nn3,
        "noabs": noabs,
        "summarize": summarize,
        "nosum": nosum,
        "verb": verb,
        "oned_format": oned_format,
        "no_oned_format": no_oned_format,
        "quiet": quiet,
        "mni": mni,
        "isovalue": isovalue,
        "isomerge": isomerge,
        "inmask": inmask,
        "binary": binary,
    }
    if rmm is not None:
        params["rmm"] = rmm
    if vmul is not None:
        params["vmul"] = vmul
    if prefix is not None:
        params["prefix"] = prefix
    if savemask is not None:
        params["savemask"] = savemask
    return params


def v_3dclust_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `V3dclustParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("rmm", None) is not None:
        if not isinstance(params["rmm"], (float, int)):
            raise StyxValidationError(f'`rmm` has the wrong type: Received `{type(params.get("rmm", None))}` expected `float | None`')
    if params.get("vmul", None) is not None:
        if not isinstance(params["vmul"], (float, int)):
            raise StyxValidationError(f'`vmul` has the wrong type: Received `{type(params.get("vmul", None))}` expected `float | None`')
    if params.get("datasets", None) is None:
        raise StyxValidationError("`datasets` must not be None")
    if not isinstance(params["datasets"], list):
        raise StyxValidationError(f'`datasets` has the wrong type: Received `{type(params.get("datasets", None))}` expected `list[InputPathType]`')
    for e in params["datasets"]:
        if not isinstance(e, (pathlib.Path, str)):
            raise StyxValidationError(f'`datasets` has the wrong type: Received `{type(params.get("datasets", None))}` expected `list[InputPathType]`')
    if params.get("nn1", False) is None:
        raise StyxValidationError("`nn1` must not be None")
    if not isinstance(params["nn1"], bool):
        raise StyxValidationError(f'`nn1` has the wrong type: Received `{type(params.get("nn1", False))}` expected `bool`')
    if params.get("nn2", False) is None:
        raise StyxValidationError("`nn2` must not be None")
    if not isinstance(params["nn2"], bool):
        raise StyxValidationError(f'`nn2` has the wrong type: Received `{type(params.get("nn2", False))}` expected `bool`')
    if params.get("nn3", False) is None:
        raise StyxValidationError("`nn3` must not be None")
    if not isinstance(params["nn3"], bool):
        raise StyxValidationError(f'`nn3` has the wrong type: Received `{type(params.get("nn3", False))}` expected `bool`')
    if params.get("noabs", False) is None:
        raise StyxValidationError("`noabs` must not be None")
    if not isinstance(params["noabs"], bool):
        raise StyxValidationError(f'`noabs` has the wrong type: Received `{type(params.get("noabs", False))}` expected `bool`')
    if params.get("summarize", False) is None:
        raise StyxValidationError("`summarize` must not be None")
    if not isinstance(params["summarize"], bool):
        raise StyxValidationError(f'`summarize` has the wrong type: Received `{type(params.get("summarize", False))}` expected `bool`')
    if params.get("nosum", False) is None:
        raise StyxValidationError("`nosum` must not be None")
    if not isinstance(params["nosum"], bool):
        raise StyxValidationError(f'`nosum` has the wrong type: Received `{type(params.get("nosum", False))}` expected `bool`')
    if params.get("verb", False) is None:
        raise StyxValidationError("`verb` must not be None")
    if not isinstance(params["verb"], bool):
        raise StyxValidationError(f'`verb` has the wrong type: Received `{type(params.get("verb", False))}` expected `bool`')
    if params.get("oned_format", False) is None:
        raise StyxValidationError("`oned_format` must not be None")
    if not isinstance(params["oned_format"], bool):
        raise StyxValidationError(f'`oned_format` has the wrong type: Received `{type(params.get("oned_format", False))}` expected `bool`')
    if params.get("no_oned_format", False) is None:
        raise StyxValidationError("`no_oned_format` must not be None")
    if not isinstance(params["no_oned_format"], bool):
        raise StyxValidationError(f'`no_oned_format` has the wrong type: Received `{type(params.get("no_oned_format", False))}` expected `bool`')
    if params.get("quiet", False) is None:
        raise StyxValidationError("`quiet` must not be None")
    if not isinstance(params["quiet"], bool):
        raise StyxValidationError(f'`quiet` has the wrong type: Received `{type(params.get("quiet", False))}` expected `bool`')
    if params.get("mni", False) is None:
        raise StyxValidationError("`mni` must not be None")
    if not isinstance(params["mni"], bool):
        raise StyxValidationError(f'`mni` has the wrong type: Received `{type(params.get("mni", False))}` expected `bool`')
    if params.get("isovalue", False) is None:
        raise StyxValidationError("`isovalue` must not be None")
    if not isinstance(params["isovalue"], bool):
        raise StyxValidationError(f'`isovalue` has the wrong type: Received `{type(params.get("isovalue", False))}` expected `bool`')
    if params.get("isomerge", False) is None:
        raise StyxValidationError("`isomerge` must not be None")
    if not isinstance(params["isomerge"], bool):
        raise StyxValidationError(f'`isomerge` has the wrong type: Received `{type(params.get("isomerge", False))}` expected `bool`')
    if params.get("inmask", False) is None:
        raise StyxValidationError("`inmask` must not be None")
    if not isinstance(params["inmask"], bool):
        raise StyxValidationError(f'`inmask` has the wrong type: Received `{type(params.get("inmask", False))}` expected `bool`')
    if params.get("prefix", None) is not None:
        if not isinstance(params["prefix"], str):
            raise StyxValidationError(f'`prefix` has the wrong type: Received `{type(params.get("prefix", None))}` expected `str | None`')
    if params.get("savemask", None) is not None:
        if not isinstance(params["savemask"], str):
            raise StyxValidationError(f'`savemask` has the wrong type: Received `{type(params.get("savemask", None))}` expected `str | None`')
    if params.get("binary", False) is None:
        raise StyxValidationError("`binary` must not be None")
    if not isinstance(params["binary"], bool):
        raise StyxValidationError(f'`binary` has the wrong type: Received `{type(params.get("binary", False))}` expected `bool`')


def v_3dclust_cargs(
    params: V3dclustParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("3dclust")
    if params.get("rmm", None) is not None:
        cargs.append(str(params.get("rmm", None)))
    if params.get("vmul", None) is not None:
        cargs.append(str(params.get("vmul", None)))
    cargs.extend([execution.input_file(f) for f in params.get("datasets", None)])
    if params.get("nn1", False):
        cargs.append("-NN1")
    if params.get("nn2", False):
        cargs.append("-NN2")
    if params.get("nn3", False):
        cargs.append("-NN3")
    if params.get("noabs", False):
        cargs.append("-noabs")
    if params.get("summarize", False):
        cargs.append("-summarize")
    if params.get("nosum", False):
        cargs.append("-nosum")
    if params.get("verb", False):
        cargs.append("-verb")
    if params.get("oned_format", False):
        cargs.append("-1Dformat")
    if params.get("no_oned_format", False):
        cargs.append("-no_1Dformat")
    if params.get("quiet", False):
        cargs.append("-quiet")
    if params.get("mni", False):
        cargs.append("-mni")
    if params.get("isovalue", False):
        cargs.append("-isovalue")
    if params.get("isomerge", False):
        cargs.append("-isomerge")
    if params.get("inmask", False):
        cargs.append("-inmask")
    if params.get("prefix", None) is not None:
        cargs.extend([
            "-prefix",
            params.get("prefix", None)
        ])
    if params.get("savemask", None) is not None:
        cargs.extend([
            "-savemask",
            params.get("savemask", None)
        ])
    if params.get("binary", False):
        cargs.append("-binary")
    return cargs


def v_3dclust_outputs(
    params: V3dclustParamsDict,
    execution: Execution,
) -> V3dclustOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = V3dclustOutputs(
        root=execution.output_file("."),
        prefixed_output=execution.output_file(params.get("prefix", None) + ".nii.gz") if (params.get("prefix") is not None) else None,
        ordered_mask_output=execution.output_file(params.get("savemask", None) + ".nii.gz") if (params.get("savemask") is not None) else None,
    )
    return ret


def v_3dclust_execute(
    params: V3dclustParamsDict,
    runner: Runner | None = None,
) -> V3dclustOutputs:
    """
    3dclust
    
    Performs simple-minded cluster detection in 3D datasets.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `V3dclustOutputs`).
    """
    v_3dclust_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(V_3DCLUST_METADATA)
    params = execution.params(params)
    cargs = v_3dclust_cargs(params, execution)
    ret = v_3dclust_outputs(params, execution)
    execution.run(cargs)
    return ret


def v_3dclust(
    datasets: list[InputPathType],
    rmm: float | None = None,
    vmul: float | None = None,
    nn1: bool = False,
    nn2: bool = False,
    nn3: bool = False,
    noabs: bool = False,
    summarize: bool = False,
    nosum: bool = False,
    verb: bool = False,
    oned_format: bool = False,
    no_oned_format: bool = False,
    quiet: bool = False,
    mni: bool = False,
    isovalue: bool = False,
    isomerge: bool = False,
    inmask: bool = False,
    prefix: str | None = None,
    savemask: str | None = None,
    binary: bool = False,
    runner: Runner | None = None,
) -> V3dclustOutputs:
    """
    3dclust
    
    Performs simple-minded cluster detection in 3D datasets.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        datasets: Input dataset(s). More than one allowed, but only the first\
            sub-brick of the dataset.
        rmm: Cluster connection radius in millimeters.
        vmul: Minimum cluster volume in micro-liters or minimum number of\
            voxels if negative.
        nn1: 1st nearest-neighbor clustering (faces touching).
        nn2: 2nd nearest-neighbor clustering (edges touching).
        nn3: 3rd nearest-neighbor clustering (corners touching).
        noabs: Use the signed voxel intensities for calculations.
        summarize: Write out only the total nonzero voxel count and volume for\
            each dataset.
        nosum: Suppress printout of the totals.
        verb: Print out a progress report to stderr as computations proceed.
        oned_format: Write output in 1D format (default).
        no_oned_format: Do not write output in 1D format.
        quiet: Suppress all non-essential output.
        mni: Transform output xyz-coordinates from TLRC to MNI space if the\
            input dataset has the +tlrc view.
        isovalue: Clusters will be formed only from contiguous voxels that also\
            have the same value.
        isomerge: Clusters will be formed from each distinct value in the\
            dataset; spatial contiguity will not be used.
        inmask: Use an internal mask from the dataset to eliminate voxels\
            before clustering.
        prefix: Write a new dataset that is a copy of the input, but with all\
            voxels not in a cluster set to zero; provide a prefix for the new\
            dataset.
        savemask: Write a new dataset that is an ordered mask where the largest\
            cluster is labeled '1', the next largest '2', and so forth.
        binary: Turn the output of '-savemask' into a binary (0 or 1) mask.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `V3dclustOutputs`).
    """
    params = v_3dclust_params(
        rmm=rmm,
        vmul=vmul,
        datasets=datasets,
        nn1=nn1,
        nn2=nn2,
        nn3=nn3,
        noabs=noabs,
        summarize=summarize,
        nosum=nosum,
        verb=verb,
        oned_format=oned_format,
        no_oned_format=no_oned_format,
        quiet=quiet,
        mni=mni,
        isovalue=isovalue,
        isomerge=isomerge,
        inmask=inmask,
        prefix=prefix,
        savemask=savemask,
        binary=binary,
    )
    return v_3dclust_execute(params, runner)


__all__ = [
    "V3dclustOutputs",
    "V3dclustParamsDict",
    "V3dclustParamsDictTagged",
    "V_3DCLUST_METADATA",
    "v_3dclust",
    "v_3dclust_execute",
    "v_3dclust_params",
]
