# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

V_3D_RETINO_PHASE_METADATA = Metadata(
    id="6034f5fb3167fcd5bd50da0a1b2a534f011a35b2.boutiques",
    name="3dRetinoPhase",
    package="afni",
    container_image_tag="afni/afni_make_build:AFNI_24.2.06",
)


_V3dRetinoPhaseParamsDictNoTag = typing.TypedDict('_V3dRetinoPhaseParamsDictNoTag', {
    "prefix": str,
    "dataset": InputPathType,
    "exp": typing.NotRequired[str | None],
    "con": typing.NotRequired[str | None],
    "clw": typing.NotRequired[str | None],
    "ccw": typing.NotRequired[str | None],
    "spectra": bool,
    "tstim": typing.NotRequired[float | None],
    "nrings": typing.NotRequired[float | None],
    "nwedges": typing.NotRequired[float | None],
    "ort_adjust": typing.NotRequired[float | None],
    "pre_stim": typing.NotRequired[float | None],
    "sum_adjust": typing.NotRequired[str | None],
    "phase_estimate": typing.NotRequired[str | None],
    "ref_ts": typing.NotRequired[InputPathType | None],
    "multi_ref_ts": typing.NotRequired[InputPathType | None],
})
V3dRetinoPhaseParamsDictTagged = typing.TypedDict('V3dRetinoPhaseParamsDictTagged', {
    "@type": typing.Literal["afni/3dRetinoPhase"],
    "prefix": str,
    "dataset": InputPathType,
    "exp": typing.NotRequired[str | None],
    "con": typing.NotRequired[str | None],
    "clw": typing.NotRequired[str | None],
    "ccw": typing.NotRequired[str | None],
    "spectra": bool,
    "tstim": typing.NotRequired[float | None],
    "nrings": typing.NotRequired[float | None],
    "nwedges": typing.NotRequired[float | None],
    "ort_adjust": typing.NotRequired[float | None],
    "pre_stim": typing.NotRequired[float | None],
    "sum_adjust": typing.NotRequired[str | None],
    "phase_estimate": typing.NotRequired[str | None],
    "ref_ts": typing.NotRequired[InputPathType | None],
    "multi_ref_ts": typing.NotRequired[InputPathType | None],
})
V3dRetinoPhaseParamsDict = _V3dRetinoPhaseParamsDictNoTag | V3dRetinoPhaseParamsDictTagged


class V3dRetinoPhaseOutputs(typing.NamedTuple):
    """
    Output object returned when calling `V3dRetinoPhaseParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    ecc_plus: OutputPathType
    """Output file for positive (expanding) eccentricity"""
    ecc_minus: OutputPathType
    """Output file for negative (contracting) eccentricity"""
    pol_plus: OutputPathType
    """Output file for clockwise polar angle mapping"""
    pol_minus: OutputPathType
    """Output file for counterclockwise polar angle mapping"""


def v_3d_retino_phase_params(
    prefix: str,
    dataset: InputPathType,
    exp: str | None = None,
    con: str | None = None,
    clw: str | None = None,
    ccw: str | None = None,
    spectra: bool = False,
    tstim: float | None = None,
    nrings: float | None = None,
    nwedges: float | None = None,
    ort_adjust: float | None = None,
    pre_stim: float | None = None,
    sum_adjust: str | None = None,
    phase_estimate: str | None = None,
    ref_ts: InputPathType | None = None,
    multi_ref_ts: InputPathType | None = None,
) -> V3dRetinoPhaseParamsDictTagged:
    """
    Build parameters.
    
    Args:
        prefix: Prefix of output datasets.
        dataset: Time series from a retinotopy stimulus.
        exp: Expanding rings stimulus.
        con: Contracting rings stimulus.
        clw: Clockwise moving polar angle mapping stimulus.
        ccw: Counterclockwise moving polar angle mapping stimulus.
        spectra: Output amplitude and phase spectra datasets.
        tstim: Period of stimulus in seconds.
        nrings: Number of rings in the stimulus. Default is 1.
        nwedges: Number of wedges in the stimulus. Default is 1.
        ort_adjust: Number of DOF lost in detrending outside of this program.
        pre_stim: Blank period, in seconds, before stimulus began.
        sum_adjust: Adjust sum of angles for wrapping based on the angle\
            difference. Default is 'y'.
        phase_estimate: Method of phase estimation.
        ref_ts: 0 lag reference time series of response for DELAY phase\
            estimation method.
        multi_ref_ts: Multiple 0 lag reference time series. This allows you to\
            test multiple regressors.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "afni/3dRetinoPhase",
        "prefix": prefix,
        "dataset": dataset,
        "spectra": spectra,
    }
    if exp is not None:
        params["exp"] = exp
    if con is not None:
        params["con"] = con
    if clw is not None:
        params["clw"] = clw
    if ccw is not None:
        params["ccw"] = ccw
    if tstim is not None:
        params["tstim"] = tstim
    if nrings is not None:
        params["nrings"] = nrings
    if nwedges is not None:
        params["nwedges"] = nwedges
    if ort_adjust is not None:
        params["ort_adjust"] = ort_adjust
    if pre_stim is not None:
        params["pre_stim"] = pre_stim
    if sum_adjust is not None:
        params["sum_adjust"] = sum_adjust
    if phase_estimate is not None:
        params["phase_estimate"] = phase_estimate
    if ref_ts is not None:
        params["ref_ts"] = ref_ts
    if multi_ref_ts is not None:
        params["multi_ref_ts"] = multi_ref_ts
    return params


def v_3d_retino_phase_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `V3dRetinoPhaseParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("prefix", None) is None:
        raise StyxValidationError("`prefix` must not be None")
    if not isinstance(params["prefix"], str):
        raise StyxValidationError(f'`prefix` has the wrong type: Received `{type(params.get("prefix", None))}` expected `str`')
    if params.get("dataset", None) is None:
        raise StyxValidationError("`dataset` must not be None")
    if not isinstance(params["dataset"], (pathlib.Path, str)):
        raise StyxValidationError(f'`dataset` has the wrong type: Received `{type(params.get("dataset", None))}` expected `InputPathType`')
    if params.get("exp", None) is not None:
        if not isinstance(params["exp"], str):
            raise StyxValidationError(f'`exp` has the wrong type: Received `{type(params.get("exp", None))}` expected `str | None`')
    if params.get("con", None) is not None:
        if not isinstance(params["con"], str):
            raise StyxValidationError(f'`con` has the wrong type: Received `{type(params.get("con", None))}` expected `str | None`')
    if params.get("clw", None) is not None:
        if not isinstance(params["clw"], str):
            raise StyxValidationError(f'`clw` has the wrong type: Received `{type(params.get("clw", None))}` expected `str | None`')
    if params.get("ccw", None) is not None:
        if not isinstance(params["ccw"], str):
            raise StyxValidationError(f'`ccw` has the wrong type: Received `{type(params.get("ccw", None))}` expected `str | None`')
    if params.get("spectra", False) is None:
        raise StyxValidationError("`spectra` must not be None")
    if not isinstance(params["spectra"], bool):
        raise StyxValidationError(f'`spectra` has the wrong type: Received `{type(params.get("spectra", False))}` expected `bool`')
    if params.get("tstim", None) is not None:
        if not isinstance(params["tstim"], (float, int)):
            raise StyxValidationError(f'`tstim` has the wrong type: Received `{type(params.get("tstim", None))}` expected `float | None`')
    if params.get("nrings", None) is not None:
        if not isinstance(params["nrings"], (float, int)):
            raise StyxValidationError(f'`nrings` has the wrong type: Received `{type(params.get("nrings", None))}` expected `float | None`')
    if params.get("nwedges", None) is not None:
        if not isinstance(params["nwedges"], (float, int)):
            raise StyxValidationError(f'`nwedges` has the wrong type: Received `{type(params.get("nwedges", None))}` expected `float | None`')
    if params.get("ort_adjust", None) is not None:
        if not isinstance(params["ort_adjust"], (float, int)):
            raise StyxValidationError(f'`ort_adjust` has the wrong type: Received `{type(params.get("ort_adjust", None))}` expected `float | None`')
    if params.get("pre_stim", None) is not None:
        if not isinstance(params["pre_stim"], (float, int)):
            raise StyxValidationError(f'`pre_stim` has the wrong type: Received `{type(params.get("pre_stim", None))}` expected `float | None`')
    if params.get("sum_adjust", None) is not None:
        if not isinstance(params["sum_adjust"], str):
            raise StyxValidationError(f'`sum_adjust` has the wrong type: Received `{type(params.get("sum_adjust", None))}` expected `str | None`')
    if params.get("phase_estimate", None) is not None:
        if not isinstance(params["phase_estimate"], str):
            raise StyxValidationError(f'`phase_estimate` has the wrong type: Received `{type(params.get("phase_estimate", None))}` expected `str | None`')
    if params.get("ref_ts", None) is not None:
        if not isinstance(params["ref_ts"], (pathlib.Path, str)):
            raise StyxValidationError(f'`ref_ts` has the wrong type: Received `{type(params.get("ref_ts", None))}` expected `InputPathType | None`')
    if params.get("multi_ref_ts", None) is not None:
        if not isinstance(params["multi_ref_ts"], (pathlib.Path, str)):
            raise StyxValidationError(f'`multi_ref_ts` has the wrong type: Received `{type(params.get("multi_ref_ts", None))}` expected `InputPathType | None`')


def v_3d_retino_phase_cargs(
    params: V3dRetinoPhaseParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("3dRetinoPhase")
    cargs.append(params.get("prefix", None))
    cargs.append(execution.input_file(params.get("dataset", None)))
    if params.get("exp", None) is not None:
        cargs.extend([
            "-exp",
            params.get("exp", None)
        ])
    if params.get("con", None) is not None:
        cargs.extend([
            "-con",
            params.get("con", None)
        ])
    if params.get("clw", None) is not None:
        cargs.extend([
            "-clw",
            params.get("clw", None)
        ])
    if params.get("ccw", None) is not None:
        cargs.extend([
            "-ccw",
            params.get("ccw", None)
        ])
    if params.get("spectra", False):
        cargs.append("-spectra")
    if params.get("tstim", None) is not None:
        cargs.extend([
            "-Tstim",
            str(params.get("tstim", None))
        ])
    if params.get("nrings", None) is not None:
        cargs.extend([
            "-nrings",
            str(params.get("nrings", None))
        ])
    if params.get("nwedges", None) is not None:
        cargs.extend([
            "-nwedges",
            str(params.get("nwedges", None))
        ])
    if params.get("ort_adjust", None) is not None:
        cargs.extend([
            "-ort_adjust",
            str(params.get("ort_adjust", None))
        ])
    if params.get("pre_stim", None) is not None:
        cargs.extend([
            "-pre_stim",
            str(params.get("pre_stim", None))
        ])
    if params.get("sum_adjust", None) is not None:
        cargs.extend([
            "-sum_adjust",
            params.get("sum_adjust", None)
        ])
    if params.get("phase_estimate", None) is not None:
        cargs.extend([
            "-phase_estimate",
            params.get("phase_estimate", None)
        ])
    if params.get("ref_ts", None) is not None:
        cargs.extend([
            "-ref_ts",
            execution.input_file(params.get("ref_ts", None))
        ])
    if params.get("multi_ref_ts", None) is not None:
        cargs.extend([
            "-multi_ref_ts",
            execution.input_file(params.get("multi_ref_ts", None))
        ])
    return cargs


def v_3d_retino_phase_outputs(
    params: V3dRetinoPhaseParamsDict,
    execution: Execution,
) -> V3dRetinoPhaseOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = V3dRetinoPhaseOutputs(
        root=execution.output_file("."),
        ecc_plus=execution.output_file(params.get("prefix", None) + ".ecc+"),
        ecc_minus=execution.output_file(params.get("prefix", None) + ".ecc-"),
        pol_plus=execution.output_file(params.get("prefix", None) + ".pol+"),
        pol_minus=execution.output_file(params.get("prefix", None) + ".pol-"),
    )
    return ret


def v_3d_retino_phase_execute(
    params: V3dRetinoPhaseParamsDict,
    runner: Runner | None = None,
) -> V3dRetinoPhaseOutputs:
    """
    3dRetinoPhase
    
    Process time series from retinotopy stimuli to create phase datasets and
    visual field angle datasets.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `V3dRetinoPhaseOutputs`).
    """
    v_3d_retino_phase_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(V_3D_RETINO_PHASE_METADATA)
    params = execution.params(params)
    cargs = v_3d_retino_phase_cargs(params, execution)
    ret = v_3d_retino_phase_outputs(params, execution)
    execution.run(cargs)
    return ret


def v_3d_retino_phase(
    prefix: str,
    dataset: InputPathType,
    exp: str | None = None,
    con: str | None = None,
    clw: str | None = None,
    ccw: str | None = None,
    spectra: bool = False,
    tstim: float | None = None,
    nrings: float | None = None,
    nwedges: float | None = None,
    ort_adjust: float | None = None,
    pre_stim: float | None = None,
    sum_adjust: str | None = None,
    phase_estimate: str | None = None,
    ref_ts: InputPathType | None = None,
    multi_ref_ts: InputPathType | None = None,
    runner: Runner | None = None,
) -> V3dRetinoPhaseOutputs:
    """
    3dRetinoPhase
    
    Process time series from retinotopy stimuli to create phase datasets and
    visual field angle datasets.
    
    Author: AFNI Developers
    
    URL: https://afni.nimh.nih.gov/
    
    Args:
        prefix: Prefix of output datasets.
        dataset: Time series from a retinotopy stimulus.
        exp: Expanding rings stimulus.
        con: Contracting rings stimulus.
        clw: Clockwise moving polar angle mapping stimulus.
        ccw: Counterclockwise moving polar angle mapping stimulus.
        spectra: Output amplitude and phase spectra datasets.
        tstim: Period of stimulus in seconds.
        nrings: Number of rings in the stimulus. Default is 1.
        nwedges: Number of wedges in the stimulus. Default is 1.
        ort_adjust: Number of DOF lost in detrending outside of this program.
        pre_stim: Blank period, in seconds, before stimulus began.
        sum_adjust: Adjust sum of angles for wrapping based on the angle\
            difference. Default is 'y'.
        phase_estimate: Method of phase estimation.
        ref_ts: 0 lag reference time series of response for DELAY phase\
            estimation method.
        multi_ref_ts: Multiple 0 lag reference time series. This allows you to\
            test multiple regressors.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `V3dRetinoPhaseOutputs`).
    """
    params = v_3d_retino_phase_params(
        prefix=prefix,
        dataset=dataset,
        exp=exp,
        con=con,
        clw=clw,
        ccw=ccw,
        spectra=spectra,
        tstim=tstim,
        nrings=nrings,
        nwedges=nwedges,
        ort_adjust=ort_adjust,
        pre_stim=pre_stim,
        sum_adjust=sum_adjust,
        phase_estimate=phase_estimate,
        ref_ts=ref_ts,
        multi_ref_ts=multi_ref_ts,
    )
    return v_3d_retino_phase_execute(params, runner)


__all__ = [
    "V3dRetinoPhaseOutputs",
    "V3dRetinoPhaseParamsDict",
    "V3dRetinoPhaseParamsDictTagged",
    "V_3D_RETINO_PHASE_METADATA",
    "v_3d_retino_phase",
    "v_3d_retino_phase_execute",
    "v_3d_retino_phase_params",
]
