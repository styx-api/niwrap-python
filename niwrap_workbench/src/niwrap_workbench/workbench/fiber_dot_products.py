# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

FIBER_DOT_PRODUCTS_METADATA = Metadata(
    id="59c62ac73c0dcf4d07840b26ea3183b46e8c89ab.workbench",
    name="fiber-dot-products",
    package="workbench",
    container_image_tag="nx10x/workbench:2.1.0",
)


_FiberDotProductsParamsDictNoTag = typing.TypedDict('_FiberDotProductsParamsDictNoTag', {
    "white-surf": InputPathType,
    "fiber-file": InputPathType,
    "max-dist": float,
    "direction": str,
    "dot-metric": str,
    "f-metric": str,
})
FiberDotProductsParamsDictTagged = typing.TypedDict('FiberDotProductsParamsDictTagged', {
    "@type": typing.Literal["workbench/fiber-dot-products"],
    "white-surf": InputPathType,
    "fiber-file": InputPathType,
    "max-dist": float,
    "direction": str,
    "dot-metric": str,
    "f-metric": str,
})
FiberDotProductsParamsDict = _FiberDotProductsParamsDictNoTag | FiberDotProductsParamsDictTagged


class FiberDotProductsOutputs(typing.NamedTuple):
    """
    Output object returned when calling `FiberDotProductsParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    dot_metric: OutputPathType
    """the metric of dot products"""
    f_metric: OutputPathType
    """a metric of the f values of the fiber distributions"""


def fiber_dot_products_params(
    white_surf: InputPathType,
    fiber_file: InputPathType,
    max_dist: float,
    direction: str,
    dot_metric: str,
    f_metric: str,
) -> FiberDotProductsParamsDictTagged:
    """
    Build parameters.
    
    Args:
        white_surf: the white/gray boundary surface.
        fiber_file: the fiber orientation file.
        max_dist: the maximum distance from any surface vertex a fiber\
            population may be, in mm.
        direction: test against surface for whether a fiber population should\
            be used.
        dot_metric: the metric of dot products.
        f_metric: a metric of the f values of the fiber distributions.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "workbench/fiber-dot-products",
        "white-surf": white_surf,
        "fiber-file": fiber_file,
        "max-dist": max_dist,
        "direction": direction,
        "dot-metric": dot_metric,
        "f-metric": f_metric,
    }
    return params


def fiber_dot_products_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `FiberDotProductsParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("white-surf", None) is None:
        raise StyxValidationError("`white-surf` must not be None")
    if not isinstance(params["white-surf"], (pathlib.Path, str)):
        raise StyxValidationError(f'`white-surf` has the wrong type: Received `{type(params.get("white-surf", None))}` expected `InputPathType`')
    if params.get("fiber-file", None) is None:
        raise StyxValidationError("`fiber-file` must not be None")
    if not isinstance(params["fiber-file"], (pathlib.Path, str)):
        raise StyxValidationError(f'`fiber-file` has the wrong type: Received `{type(params.get("fiber-file", None))}` expected `InputPathType`')
    if params.get("max-dist", None) is None:
        raise StyxValidationError("`max-dist` must not be None")
    if not isinstance(params["max-dist"], (float, int)):
        raise StyxValidationError(f'`max-dist` has the wrong type: Received `{type(params.get("max-dist", None))}` expected `float`')
    if params.get("direction", None) is None:
        raise StyxValidationError("`direction` must not be None")
    if not isinstance(params["direction"], str):
        raise StyxValidationError(f'`direction` has the wrong type: Received `{type(params.get("direction", None))}` expected `str`')
    if params.get("dot-metric", None) is None:
        raise StyxValidationError("`dot-metric` must not be None")
    if not isinstance(params["dot-metric"], str):
        raise StyxValidationError(f'`dot-metric` has the wrong type: Received `{type(params.get("dot-metric", None))}` expected `str`')
    if params.get("f-metric", None) is None:
        raise StyxValidationError("`f-metric` must not be None")
    if not isinstance(params["f-metric"], str):
        raise StyxValidationError(f'`f-metric` has the wrong type: Received `{type(params.get("f-metric", None))}` expected `str`')


def fiber_dot_products_cargs(
    params: FiberDotProductsParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.extend([
        "wb_command",
        "-fiber-dot-products"
    ])
    cargs.append(execution.input_file(params.get("white-surf", None)))
    cargs.append(execution.input_file(params.get("fiber-file", None)))
    cargs.append(str(params.get("max-dist", None)))
    cargs.append(params.get("direction", None))
    cargs.append(params.get("dot-metric", None))
    cargs.append(params.get("f-metric", None))
    return cargs


def fiber_dot_products_outputs(
    params: FiberDotProductsParamsDict,
    execution: Execution,
) -> FiberDotProductsOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = FiberDotProductsOutputs(
        root=execution.output_file("."),
        dot_metric=execution.output_file(params.get("dot-metric", None)),
        f_metric=execution.output_file(params.get("f-metric", None)),
    )
    return ret


def fiber_dot_products_execute(
    params: FiberDotProductsParamsDict,
    runner: Runner | None = None,
) -> FiberDotProductsOutputs:
    """
    COMPUTE DOT PRODUCTS OF FIBER ORIENTATIONS WITH SURFACE NORMALS.
    
    For each vertex, this command finds the closest fiber population that
    satisfies the <direction> test, and computes the absolute value of the dot
    product of the surface normal and the normalized mean direction of each
    fiber. The <direction> test must be one of INSIDE, OUTSIDE, or ANY, which
    causes the command to only use fiber populations that are inside the
    surface, outside the surface, or to not care which direction it is from the
    surface. Each fiber population is output in a separate metric column.
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `FiberDotProductsOutputs`).
    """
    fiber_dot_products_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(FIBER_DOT_PRODUCTS_METADATA)
    params = execution.params(params)
    cargs = fiber_dot_products_cargs(params, execution)
    ret = fiber_dot_products_outputs(params, execution)
    execution.run(cargs)
    return ret


def fiber_dot_products(
    white_surf: InputPathType,
    fiber_file: InputPathType,
    max_dist: float,
    direction: str,
    dot_metric: str,
    f_metric: str,
    runner: Runner | None = None,
) -> FiberDotProductsOutputs:
    """
    COMPUTE DOT PRODUCTS OF FIBER ORIENTATIONS WITH SURFACE NORMALS.
    
    For each vertex, this command finds the closest fiber population that
    satisfies the <direction> test, and computes the absolute value of the dot
    product of the surface normal and the normalized mean direction of each
    fiber. The <direction> test must be one of INSIDE, OUTSIDE, or ANY, which
    causes the command to only use fiber populations that are inside the
    surface, outside the surface, or to not care which direction it is from the
    surface. Each fiber population is output in a separate metric column.
    
    Args:
        white_surf: the white/gray boundary surface.
        fiber_file: the fiber orientation file.
        max_dist: the maximum distance from any surface vertex a fiber\
            population may be, in mm.
        direction: test against surface for whether a fiber population should\
            be used.
        dot_metric: the metric of dot products.
        f_metric: a metric of the f values of the fiber distributions.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `FiberDotProductsOutputs`).
    """
    params = fiber_dot_products_params(
        white_surf=white_surf,
        fiber_file=fiber_file,
        max_dist=max_dist,
        direction=direction,
        dot_metric=dot_metric,
        f_metric=f_metric,
    )
    return fiber_dot_products_execute(params, runner)


__all__ = [
    "FIBER_DOT_PRODUCTS_METADATA",
    "FiberDotProductsOutputs",
    "FiberDotProductsParamsDict",
    "FiberDotProductsParamsDictTagged",
    "fiber_dot_products",
    "fiber_dot_products_execute",
    "fiber_dot_products_params",
]
