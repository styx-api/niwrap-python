# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

VOLUME_GRADIENT_METADATA = Metadata(
    id="5a5d7ede042330cd65eec319159b5ecf75f94aed.workbench",
    name="volume-gradient",
    package="workbench",
    container_image_tag="nx10x/workbench:2.1.0",
)


_VolumeGradientPresmoothParamsDictNoTag = typing.TypedDict('_VolumeGradientPresmoothParamsDictNoTag', {
    "kernel": float,
    "fwhm": bool,
})
VolumeGradientPresmoothParamsDictTagged = typing.TypedDict('VolumeGradientPresmoothParamsDictTagged', {
    "@type": typing.Literal["presmooth"],
    "kernel": float,
    "fwhm": bool,
})
VolumeGradientPresmoothParamsDict = _VolumeGradientPresmoothParamsDictNoTag | VolumeGradientPresmoothParamsDictTagged


_VolumeGradientParamsDictNoTag = typing.TypedDict('_VolumeGradientParamsDictNoTag', {
    "volume-out": str,
    "presmooth": typing.NotRequired[VolumeGradientPresmoothParamsDict | None],
    "roi-volume": typing.NotRequired[InputPathType | None],
    "vector-volume-out": typing.NotRequired[str | None],
    "subvol": typing.NotRequired[str | None],
    "volume-in": InputPathType,
})
VolumeGradientParamsDictTagged = typing.TypedDict('VolumeGradientParamsDictTagged', {
    "@type": typing.Literal["workbench/volume-gradient"],
    "volume-out": str,
    "presmooth": typing.NotRequired[VolumeGradientPresmoothParamsDict | None],
    "roi-volume": typing.NotRequired[InputPathType | None],
    "vector-volume-out": typing.NotRequired[str | None],
    "subvol": typing.NotRequired[str | None],
    "volume-in": InputPathType,
})
VolumeGradientParamsDict = _VolumeGradientParamsDictNoTag | VolumeGradientParamsDictTagged


def volume_gradient_presmooth(
    kernel: float,
    fwhm: bool = False,
) -> VolumeGradientPresmoothParamsDictTagged:
    """
    Build parameters.
    
    Args:
        kernel: the size of the gaussian smoothing kernel in mm, as sigma by\
            default.
        fwhm: kernel size is FWHM, not sigma.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "presmooth",
        "kernel": kernel,
        "fwhm": fwhm,
    }
    return params


def volume_gradient_presmooth_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `VolumeGradientPresmoothParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("kernel", None) is None:
        raise StyxValidationError("`kernel` must not be None")
    if not isinstance(params["kernel"], (float, int)):
        raise StyxValidationError(f'`kernel` has the wrong type: Received `{type(params.get("kernel", None))}` expected `float`')
    if params.get("fwhm", False) is None:
        raise StyxValidationError("`fwhm` must not be None")
    if not isinstance(params["fwhm"], bool):
        raise StyxValidationError(f'`fwhm` has the wrong type: Received `{type(params.get("fwhm", False))}` expected `bool`')


def volume_gradient_presmooth_cargs(
    params: VolumeGradientPresmoothParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    if params.get("fwhm", False):
        cargs.extend([
            "-presmooth",
            str(params.get("kernel", None)),
            "-fwhm"
        ])
    return cargs


class VolumeGradientOutputs(typing.NamedTuple):
    """
    Output object returned when calling `VolumeGradientParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    volume_out: OutputPathType
    """the output gradient magnitude volume"""


def volume_gradient_params(
    volume_out: str,
    volume_in: InputPathType,
    presmooth: VolumeGradientPresmoothParamsDict | None = None,
    roi_volume: InputPathType | None = None,
    vector_volume_out: str | None = None,
    subvol: str | None = None,
) -> VolumeGradientParamsDictTagged:
    """
    Build parameters.
    
    Args:
        volume_out: the output gradient magnitude volume.
        volume_in: the input volume.
        presmooth: smooth the volume before computing the gradient.
        roi_volume: select a region of interest to take the gradient of\
            \
            the region to take the gradient within.
        vector_volume_out: output vectors\
            \
            the vectors as a volume file.
        subvol: select a single subvolume to take the gradient of\
            \
            the subvolume number or name.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "workbench/volume-gradient",
        "volume-out": volume_out,
        "volume-in": volume_in,
    }
    if presmooth is not None:
        params["presmooth"] = presmooth
    if roi_volume is not None:
        params["roi-volume"] = roi_volume
    if vector_volume_out is not None:
        params["vector-volume-out"] = vector_volume_out
    if subvol is not None:
        params["subvol"] = subvol
    return params


def volume_gradient_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `VolumeGradientParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("volume-out", None) is None:
        raise StyxValidationError("`volume-out` must not be None")
    if not isinstance(params["volume-out"], str):
        raise StyxValidationError(f'`volume-out` has the wrong type: Received `{type(params.get("volume-out", None))}` expected `str`')
    if params.get("presmooth", None) is not None:
        volume_gradient_presmooth_validate(params["presmooth"])
    if params.get("roi-volume", None) is not None:
        if not isinstance(params["roi-volume"], (pathlib.Path, str)):
            raise StyxValidationError(f'`roi-volume` has the wrong type: Received `{type(params.get("roi-volume", None))}` expected `InputPathType | None`')
    if params.get("vector-volume-out", None) is not None:
        if not isinstance(params["vector-volume-out"], str):
            raise StyxValidationError(f'`vector-volume-out` has the wrong type: Received `{type(params.get("vector-volume-out", None))}` expected `str | None`')
    if params.get("subvol", None) is not None:
        if not isinstance(params["subvol"], str):
            raise StyxValidationError(f'`subvol` has the wrong type: Received `{type(params.get("subvol", None))}` expected `str | None`')
    if params.get("volume-in", None) is None:
        raise StyxValidationError("`volume-in` must not be None")
    if not isinstance(params["volume-in"], (pathlib.Path, str)):
        raise StyxValidationError(f'`volume-in` has the wrong type: Received `{type(params.get("volume-in", None))}` expected `InputPathType`')


def volume_gradient_cargs(
    params: VolumeGradientParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    if params.get("presmooth", None) is not None or params.get("roi-volume", None) is not None or params.get("vector-volume-out", None) is not None or params.get("subvol", None) is not None:
        cargs.extend([
            "wb_command",
            "-volume-gradient",
            params.get("volume-out", None),
            *(volume_gradient_presmooth_cargs(params.get("presmooth", None), execution) if (params.get("presmooth", None) is not None) else []),
            "-roi",
            (execution.input_file(params.get("roi-volume", None)) if (params.get("roi-volume", None) is not None) else ""),
            "-vectors",
            (params.get("vector-volume-out", None) if (params.get("vector-volume-out", None) is not None) else ""),
            "-subvolume",
            (params.get("subvol", None) if (params.get("subvol", None) is not None) else "")
        ])
    cargs.append(execution.input_file(params.get("volume-in", None)))
    return cargs


def volume_gradient_outputs(
    params: VolumeGradientParamsDict,
    execution: Execution,
) -> VolumeGradientOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = VolumeGradientOutputs(
        root=execution.output_file("."),
        volume_out=execution.output_file(params.get("volume-out", None)),
    )
    return ret


def volume_gradient_execute(
    params: VolumeGradientParamsDict,
    runner: Runner | None = None,
) -> VolumeGradientOutputs:
    """
    GRADIENT OF A VOLUME FILE.
    
    Computes the gradient of the volume by doing linear regressions for each
    voxel, considering only its face neighbors unless too few face neighbors
    exist. The gradient vector is constructed from the partial derivatives of
    the resulting linear function, and the magnitude of this vector is the
    output. If specified, the volume vector output is arranged with the x, y,
    and z components from a subvolume as consecutive subvolumes.
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `VolumeGradientOutputs`).
    """
    volume_gradient_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(VOLUME_GRADIENT_METADATA)
    params = execution.params(params)
    cargs = volume_gradient_cargs(params, execution)
    ret = volume_gradient_outputs(params, execution)
    execution.run(cargs)
    return ret


def volume_gradient(
    volume_out: str,
    volume_in: InputPathType,
    presmooth: VolumeGradientPresmoothParamsDict | None = None,
    roi_volume: InputPathType | None = None,
    vector_volume_out: str | None = None,
    subvol: str | None = None,
    runner: Runner | None = None,
) -> VolumeGradientOutputs:
    """
    GRADIENT OF A VOLUME FILE.
    
    Computes the gradient of the volume by doing linear regressions for each
    voxel, considering only its face neighbors unless too few face neighbors
    exist. The gradient vector is constructed from the partial derivatives of
    the resulting linear function, and the magnitude of this vector is the
    output. If specified, the volume vector output is arranged with the x, y,
    and z components from a subvolume as consecutive subvolumes.
    
    Args:
        volume_out: the output gradient magnitude volume.
        volume_in: the input volume.
        presmooth: smooth the volume before computing the gradient.
        roi_volume: select a region of interest to take the gradient of\
            \
            the region to take the gradient within.
        vector_volume_out: output vectors\
            \
            the vectors as a volume file.
        subvol: select a single subvolume to take the gradient of\
            \
            the subvolume number or name.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `VolumeGradientOutputs`).
    """
    params = volume_gradient_params(
        volume_out=volume_out,
        presmooth=presmooth,
        roi_volume=roi_volume,
        vector_volume_out=vector_volume_out,
        subvol=subvol,
        volume_in=volume_in,
    )
    return volume_gradient_execute(params, runner)


__all__ = [
    "VOLUME_GRADIENT_METADATA",
    "VolumeGradientOutputs",
    "VolumeGradientParamsDict",
    "VolumeGradientParamsDictTagged",
    "VolumeGradientPresmoothParamsDict",
    "VolumeGradientPresmoothParamsDictTagged",
    "volume_gradient",
    "volume_gradient_execute",
    "volume_gradient_params",
    "volume_gradient_presmooth",
]
