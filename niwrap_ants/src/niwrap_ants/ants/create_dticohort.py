# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

CREATE_DTICOHORT_METADATA = Metadata(
    id="0a48870c7e3e938710c4728fa63461cde729e48a.boutiques",
    name="CreateDTICohort",
    package="ants",
    container_image_tag="antsx/ants:v2.5.3",
)


_CreateDticohortParamsDictNoTag = typing.TypedDict('_CreateDticohortParamsDictNoTag', {
    "image_dimensionality": typing.NotRequired[typing.Literal[2, 3] | None],
    "dti_atlas": InputPathType,
    "label_mask_image": typing.NotRequired[str | None],
    "noise_sigma": typing.NotRequired[float | None],
    "pathology": typing.NotRequired[str | None],
    "dwi_parameters": str,
    "registered_population": typing.NotRequired[InputPathType | None],
    "output": str,
})
CreateDticohortParamsDictTagged = typing.TypedDict('CreateDticohortParamsDictTagged', {
    "@type": typing.Literal["ants/CreateDTICohort"],
    "image_dimensionality": typing.NotRequired[typing.Literal[2, 3] | None],
    "dti_atlas": InputPathType,
    "label_mask_image": typing.NotRequired[str | None],
    "noise_sigma": typing.NotRequired[float | None],
    "pathology": typing.NotRequired[str | None],
    "dwi_parameters": str,
    "registered_population": typing.NotRequired[InputPathType | None],
    "output": str,
})
CreateDticohortParamsDict = _CreateDticohortParamsDictNoTag | CreateDticohortParamsDictTagged


class CreateDticohortOutputs(typing.NamedTuple):
    """
    Output object returned when calling `CreateDticohortParamsDict(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    output_directory: OutputPathType
    """The directory where the output data will be stored."""


def create_dticohort_params(
    dti_atlas: InputPathType,
    dwi_parameters: str,
    output: str,
    image_dimensionality: typing.Literal[2, 3] | None = None,
    label_mask_image: str | None = None,
    noise_sigma: float | None = None,
    pathology: str | None = None,
    registered_population: InputPathType | None = None,
) -> CreateDticohortParamsDictTagged:
    """
    Build parameters.
    
    Args:
        dti_atlas: A diffusion tensor atlas image is required input for\
            creating the cohort.
        dwi_parameters: This option specifies the parameters of the output\
            diffusion-weighted images, including the directions and b-values.\
            Directions can be specified using a direction file or scheme file.
        output: The output consists of a set of diffusion-weighted images for\
            each subject. Control and experimental subject numbers can be\
            specified.
        image_dimensionality: This option forces the image to be treated as a\
            specified-dimensional image. If not specified, the program tries to\
            infer the dimensionality from the input image.
        label_mask_image: A mask image can be specified which determines the\
            region(s) to which the simulated pathology operations are applied. If\
            no mask is specified one is created by thresholding the atlas FA map at\
            0.2 unless a lower threshold is specified.
        noise_sigma: This parameter characterizes the Rician noise in the\
            original DWI images. Default value is 18.
        pathology: The user can specify the simulated pathology in a given area\
            using a label mask. Pathology is simulated by changing the eigenvalues.\
            One can specify the number of voxels affected in each region or the\
            proportion of voxels affected. Change is specified as a proportion of\
            the current eigenvalues.
        registered_population: To introduce inter-subject variability, a\
            registered DTI population to the DTI atlas is required. This is modeled\
            by PCA decomposition.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "ants/CreateDTICohort",
        "dti_atlas": dti_atlas,
        "dwi_parameters": dwi_parameters,
        "output": output,
    }
    if image_dimensionality is not None:
        params["image_dimensionality"] = image_dimensionality
    if label_mask_image is not None:
        params["label_mask_image"] = label_mask_image
    if noise_sigma is not None:
        params["noise_sigma"] = noise_sigma
    if pathology is not None:
        params["pathology"] = pathology
    if registered_population is not None:
        params["registered_population"] = registered_population
    return params


def create_dticohort_validate(
    params: typing.Any,
) -> None:
    """
    Validate parameters. Throws an error if `params` is not a valid
    `CreateDticohortParamsDict` object.
    
    Args:
        params: The parameters object to validate.
    """
    if params is None or not isinstance(params, dict):
        raise StyxValidationError(f'Params object has the wrong type \'{type(params)}\'')
    if params.get("image_dimensionality", None) is not None:
        if not isinstance(params["image_dimensionality"], int):
            raise StyxValidationError(f'`image_dimensionality` has the wrong type: Received `{type(params.get("image_dimensionality", None))}` expected `typing.Literal[2, 3] | None`')
        if params["image_dimensionality"] not in [2, 3]:
            raise StyxValidationError("Parameter `image_dimensionality` must be one of [2, 3]")
    if params.get("dti_atlas", None) is None:
        raise StyxValidationError("`dti_atlas` must not be None")
    if not isinstance(params["dti_atlas"], (pathlib.Path, str)):
        raise StyxValidationError(f'`dti_atlas` has the wrong type: Received `{type(params.get("dti_atlas", None))}` expected `InputPathType`')
    if params.get("label_mask_image", None) is not None:
        if not isinstance(params["label_mask_image"], str):
            raise StyxValidationError(f'`label_mask_image` has the wrong type: Received `{type(params.get("label_mask_image", None))}` expected `str | None`')
    if params.get("noise_sigma", None) is not None:
        if not isinstance(params["noise_sigma"], (float, int)):
            raise StyxValidationError(f'`noise_sigma` has the wrong type: Received `{type(params.get("noise_sigma", None))}` expected `float | None`')
    if params.get("pathology", None) is not None:
        if not isinstance(params["pathology"], str):
            raise StyxValidationError(f'`pathology` has the wrong type: Received `{type(params.get("pathology", None))}` expected `str | None`')
    if params.get("dwi_parameters", None) is None:
        raise StyxValidationError("`dwi_parameters` must not be None")
    if not isinstance(params["dwi_parameters"], str):
        raise StyxValidationError(f'`dwi_parameters` has the wrong type: Received `{type(params.get("dwi_parameters", None))}` expected `str`')
    if params.get("registered_population", None) is not None:
        if not isinstance(params["registered_population"], (pathlib.Path, str)):
            raise StyxValidationError(f'`registered_population` has the wrong type: Received `{type(params.get("registered_population", None))}` expected `InputPathType | None`')
    if params.get("output", None) is None:
        raise StyxValidationError("`output` must not be None")
    if not isinstance(params["output"], str):
        raise StyxValidationError(f'`output` has the wrong type: Received `{type(params.get("output", None))}` expected `str`')


def create_dticohort_cargs(
    params: CreateDticohortParamsDict,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("CreateDTICohort")
    if params.get("image_dimensionality", None) is not None:
        cargs.extend([
            "--image-dimensionality",
            str(params.get("image_dimensionality", None))
        ])
    cargs.extend([
        "--dti-atlas",
        execution.input_file(params.get("dti_atlas", None))
    ])
    if params.get("label_mask_image", None) is not None:
        cargs.extend([
            "--label-mask-image",
            params.get("label_mask_image", None)
        ])
    if params.get("noise_sigma", None) is not None:
        cargs.extend([
            "--noise-sigma",
            str(params.get("noise_sigma", None))
        ])
    if params.get("pathology", None) is not None:
        cargs.extend([
            "--pathology",
            params.get("pathology", None)
        ])
    cargs.extend([
        "--dwi-parameters",
        params.get("dwi_parameters", None)
    ])
    if params.get("registered_population", None) is not None:
        cargs.extend([
            "--registered-population",
            execution.input_file(params.get("registered_population", None))
        ])
    cargs.extend([
        "--output",
        params.get("output", None)
    ])
    return cargs


def create_dticohort_outputs(
    params: CreateDticohortParamsDict,
    execution: Execution,
) -> CreateDticohortOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = CreateDticohortOutputs(
        root=execution.output_file("."),
        output_directory=execution.output_file("[OUTPUT_DIRECTORY]"),
    )
    return ret


def create_dticohort_execute(
    params: CreateDticohortParamsDict,
    runner: Runner | None = None,
) -> CreateDticohortOutputs:
    """
    CreateDTICohort
    
    CreateDTICohort implements the work of Van Hecke et al. to create simulated
    DTI data sets. The only difference is that all registrations (both for the
    input population and for the output population) are assumed to take place
    outside of this program.
    
    Author: ANTs Developers
    
    URL: https://github.com/ANTsX/ANTs
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `CreateDticohortOutputs`).
    """
    create_dticohort_validate(params)
    runner = runner or get_global_runner()
    execution = runner.start_execution(CREATE_DTICOHORT_METADATA)
    params = execution.params(params)
    cargs = create_dticohort_cargs(params, execution)
    ret = create_dticohort_outputs(params, execution)
    execution.run(cargs)
    return ret


def create_dticohort(
    dti_atlas: InputPathType,
    dwi_parameters: str,
    output: str,
    image_dimensionality: typing.Literal[2, 3] | None = None,
    label_mask_image: str | None = None,
    noise_sigma: float | None = None,
    pathology: str | None = None,
    registered_population: InputPathType | None = None,
    runner: Runner | None = None,
) -> CreateDticohortOutputs:
    """
    CreateDTICohort
    
    CreateDTICohort implements the work of Van Hecke et al. to create simulated
    DTI data sets. The only difference is that all registrations (both for the
    input population and for the output population) are assumed to take place
    outside of this program.
    
    Author: ANTs Developers
    
    URL: https://github.com/ANTsX/ANTs
    
    Args:
        dti_atlas: A diffusion tensor atlas image is required input for\
            creating the cohort.
        dwi_parameters: This option specifies the parameters of the output\
            diffusion-weighted images, including the directions and b-values.\
            Directions can be specified using a direction file or scheme file.
        output: The output consists of a set of diffusion-weighted images for\
            each subject. Control and experimental subject numbers can be\
            specified.
        image_dimensionality: This option forces the image to be treated as a\
            specified-dimensional image. If not specified, the program tries to\
            infer the dimensionality from the input image.
        label_mask_image: A mask image can be specified which determines the\
            region(s) to which the simulated pathology operations are applied. If\
            no mask is specified one is created by thresholding the atlas FA map at\
            0.2 unless a lower threshold is specified.
        noise_sigma: This parameter characterizes the Rician noise in the\
            original DWI images. Default value is 18.
        pathology: The user can specify the simulated pathology in a given area\
            using a label mask. Pathology is simulated by changing the eigenvalues.\
            One can specify the number of voxels affected in each region or the\
            proportion of voxels affected. Change is specified as a proportion of\
            the current eigenvalues.
        registered_population: To introduce inter-subject variability, a\
            registered DTI population to the DTI atlas is required. This is modeled\
            by PCA decomposition.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `CreateDticohortOutputs`).
    """
    params = create_dticohort_params(
        image_dimensionality=image_dimensionality,
        dti_atlas=dti_atlas,
        label_mask_image=label_mask_image,
        noise_sigma=noise_sigma,
        pathology=pathology,
        dwi_parameters=dwi_parameters,
        registered_population=registered_population,
        output=output,
    )
    return create_dticohort_execute(params, runner)


__all__ = [
    "CREATE_DTICOHORT_METADATA",
    "CreateDticohortOutputs",
    "CreateDticohortParamsDict",
    "CreateDticohortParamsDictTagged",
    "create_dticohort",
    "create_dticohort_execute",
    "create_dticohort_params",
]
